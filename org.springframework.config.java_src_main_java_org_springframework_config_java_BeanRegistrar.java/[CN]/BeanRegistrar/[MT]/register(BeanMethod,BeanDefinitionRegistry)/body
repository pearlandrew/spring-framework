{
  RootBeanDefinition beanDef=new ConfigurationClassBeanDefinition();
  ConfigurationClass configClass=method.getDeclaringClass();
  beanDef.setFactoryBeanName(configClass.getBeanName());
  beanDef.setFactoryMethodName(method.getName());
  Bean bean=method.getRequiredAnnotation(Bean.class);
  Scope scope=method.getAnnotation(Scope.class);
  if (scope != null)   beanDef.setScope(scope.value());
  ArrayList<String> names=new ArrayList<String>(Arrays.asList(bean.name()));
  String beanName=(names.size() > 0) ? names.remove(0) : method.getName();
  for (  String alias : bean.name())   registry.registerAlias(beanName,alias);
  if (containsBeanDefinitionIncludingAncestry(beanName,registry)) {
    BeanDefinition existingBeanDef=getBeanDefinitionIncludingAncestry(beanName,registry);
    if (!(existingBeanDef instanceof ConfigurationClassBeanDefinition)) {
      logger.info(format("Skipping loading bean definition for %s: a definition for bean " + "'%s' already exists. This is likely due to an override in XML.",method,beanName));
      return;
    }
  }
  String initMethodName=bean.initMethod();
  if (hasText(initMethodName))   beanDef.setInitMethodName(initMethodName);
  String destroyMethodName=bean.destroyMethod();
  if (hasText(destroyMethodName))   beanDef.setDestroyMethodName(destroyMethodName);
  ScopedProxy scopedProxy=method.getAnnotation(ScopedProxy.class);
  if (scopedProxy != null) {
    RootBeanDefinition targetDef=beanDef;
    String targetBeanName=ScopedProxy.Util.resolveHiddenScopedProxyBeanName(beanName);
    RootBeanDefinition scopedProxyDefinition=new RootBeanDefinition(ScopedProxyFactoryBean.class);
    scopedProxyDefinition.getPropertyValues().addPropertyValue("targetBeanName",targetBeanName);
    if (scopedProxy.proxyTargetClass())     targetDef.setAttribute(AutoProxyUtils.PRESERVE_TARGET_CLASS_ATTRIBUTE,Boolean.TRUE);
 else     scopedProxyDefinition.getPropertyValues().addPropertyValue("proxyTargetClass",Boolean.FALSE);
    targetDef.setAutowireCandidate(false);
    registry.registerBeanDefinition(targetBeanName,targetDef);
    beanDef=scopedProxyDefinition;
  }
  if (bean.dependsOn().length > 0)   beanDef.setDependsOn(bean.dependsOn());
  logger.info(format("Registering bean definition for @Bean method %s.%s()",configClass.getName(),beanName));
  registry.registerBeanDefinition(beanName,beanDef);
}
