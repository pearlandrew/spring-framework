{
  if (scope == SCOPE_REQUEST) {
    if (!isRequestActive()) {
      throw new IllegalStateException("Cannot ask for request attribute - request is not active anymore!");
    }
    return this.request.getAttribute(name);
  }
 else {
    PortletSession session=getSession(false);
    if (session != null) {
      if (scope == SCOPE_GLOBAL_SESSION) {
        Object value=session.getAttribute(name,PortletSession.APPLICATION_SCOPE);
        if (value != null) {
synchronized (this.globalSessionAttributesToUpdate) {
            this.globalSessionAttributesToUpdate.put(name,value);
          }
        }
        return value;
      }
 else {
        Object value=session.getAttribute(name);
        if (value != null) {
synchronized (this.sessionAttributesToUpdate) {
            this.sessionAttributesToUpdate.put(name,value);
          }
        }
        return value;
      }
    }
 else {
      return null;
    }
  }
}
