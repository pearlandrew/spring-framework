{
  TypedValue contextObject=state.getActiveContextObject();
  EvaluationContext eContext=state.getEvaluationContext();
  PropertyAccessor accessorToUse=this.cachedWriteAccessor;
  if (accessorToUse != null) {
    try {
      accessorToUse.write(state.getEvaluationContext(),contextObject.getValue(),name,newValue);
      return;
    }
 catch (    AccessException ae) {
      this.cachedWriteAccessor=null;
    }
  }
  Class<?> contextObjectClass=getObjectClass(contextObject.getValue());
  List<PropertyAccessor> accessorsToTry=getPropertyAccessorsToTry(contextObjectClass,state);
  if (accessorsToTry != null) {
    try {
      for (      PropertyAccessor accessor : accessorsToTry) {
        if (accessor.canWrite(eContext,contextObject.getValue(),name)) {
          this.cachedWriteAccessor=accessor;
          accessor.write(eContext,contextObject.getValue(),name,newValue);
          return;
        }
      }
    }
 catch (    AccessException ae) {
      throw new SpelException(getCharPositionInLine(),ae,SpelMessages.EXCEPTION_DURING_PROPERTY_WRITE,name,ae.getMessage());
    }
  }
  if (contextObject.getValue() == null) {
    throw new SpelException(SpelMessages.PROPERTY_OR_FIELD_NOT_WRITABLE_ON_NULL,name);
  }
 else {
    throw new SpelException(SpelMessages.PROPERTY_OR_FIELD_NOT_WRITABLE,name,FormatHelper.formatClassNameForMessage(contextObjectClass));
  }
}
