{
  Object contextObject=state.getActiveContextObject();
  EvaluationContext eContext=state.getEvaluationContext();
  PropertyAccessor accessorToUse=this.cachedWriteAccessor;
  if (accessorToUse != null) {
    try {
      Object possiblyConvertedValue=newValue;
      if (cachedTypeDescriptor == null) {
        cachedTypeDescriptor=accessorToUse.getTypeDescriptor(eContext,contextObject,name);
      }
      if (cachedTypeDescriptor != null) {
        try {
          possiblyConvertedValue=state.convertValue(newValue,cachedTypeDescriptor.getType());
        }
 catch (        EvaluationException evaluationException) {
          throw new SpelException(getCharPositionInLine(),evaluationException,SpelMessages.TYPE_CONVERSION_ERROR,newValue.getClass(),cachedTypeDescriptor.getType());
        }
      }
      accessorToUse.write(state.getEvaluationContext(),contextObject,name,possiblyConvertedValue);
      return;
    }
 catch (    AccessException ae) {
      this.cachedWriteAccessor=null;
    }
  }
  Class<?> contextObjectClass=getObjectClass(contextObject);
  List<PropertyAccessor> accessorsToTry=getPropertyAccessorsToTry(contextObjectClass,state);
  if (accessorsToTry != null) {
    try {
      for (      PropertyAccessor accessor : accessorsToTry) {
        if (accessor.canWrite(eContext,contextObject,name)) {
          this.cachedWriteAccessor=accessor;
          Object possiblyConvertedValue=newValue;
          if (cachedTypeDescriptor == null) {
            cachedTypeDescriptor=accessor.getTypeDescriptor(eContext,contextObject,name);
          }
          if (cachedTypeDescriptor != null) {
            try {
              possiblyConvertedValue=state.convertValue(newValue,cachedTypeDescriptor);
            }
 catch (            EvaluationException evaluationException) {
              throw new SpelException(getCharPositionInLine(),evaluationException,SpelMessages.TYPE_CONVERSION_ERROR,newValue.getClass(),cachedTypeDescriptor.getType());
            }
          }
          accessor.write(eContext,contextObject,name,possiblyConvertedValue);
          return;
        }
      }
    }
 catch (    AccessException ae) {
      throw new SpelException(getCharPositionInLine(),ae,SpelMessages.EXCEPTION_DURING_PROPERTY_WRITE,name,ae.getMessage());
    }
  }
  throw new SpelException(SpelMessages.PROPERTY_OR_FIELD_SETTER_NOT_FOUND,name,FormatHelper.formatClassNameForMessage(contextObjectClass));
}
