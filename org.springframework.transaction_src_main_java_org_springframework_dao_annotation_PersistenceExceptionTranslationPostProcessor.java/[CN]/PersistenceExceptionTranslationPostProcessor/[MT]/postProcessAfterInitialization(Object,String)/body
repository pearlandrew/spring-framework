{
  Class<?> targetClass=(bean instanceof Advised ? ((Advised)bean).getTargetSource().getTargetClass() : bean.getClass());
  if (targetClass == null) {
    return bean;
  }
  if (AopUtils.canApply(this.persistenceExceptionTranslationAdvisor,targetClass)) {
    if (bean instanceof Advised) {
      ((Advised)bean).addAdvisor(this.persistenceExceptionTranslationAdvisor);
      return bean;
    }
 else {
      ProxyFactory proxyFactory=new ProxyFactory(bean);
      proxyFactory.copyFrom(this);
      proxyFactory.addAdvisor(this.persistenceExceptionTranslationAdvisor);
      return proxyFactory.getProxy(this.beanClassLoader);
    }
  }
 else {
    return bean;
  }
}
