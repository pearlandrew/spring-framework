{
  Class<?> targetClass=AopUtils.getTargetClass(bean);
  if (targetClass != bean.getClass()) {
    Class<Object> ifc=(Class<Object>)JmxUtils.getMXBeanInterface(targetClass);
    if (ifc != null) {
      if (!(ifc.isInstance(bean))) {
        throw new NotCompliantMBeanException("Managed bean [" + bean + "] has a target class with an MXBean interface but does not expose it in the proxy");
      }
      return new StandardMBean(bean,ifc,true);
    }
 else {
      ifc=(Class<Object>)JmxUtils.getMBeanInterface(targetClass);
      if (ifc != null) {
        if (!(ifc.isInstance(bean))) {
          throw new NotCompliantMBeanException("Managed bean [" + bean + "] has a target class with an MBean interface but does not expose it in the proxy");
        }
        return new StandardMBean(bean,ifc);
      }
    }
  }
  return null;
}
