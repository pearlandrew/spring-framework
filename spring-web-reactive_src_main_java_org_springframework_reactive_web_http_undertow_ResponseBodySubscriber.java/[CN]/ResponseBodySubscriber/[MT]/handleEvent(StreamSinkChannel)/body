{
  try {
    int c;
    do {
      ByteBuffer buffer=buffers.peek().getBuffer();
      do {
        c=channel.write(buffer);
      }
 while (buffer.hasRemaining() && c > 0);
      if (!buffer.hasRemaining()) {
        safeClose(buffers.remove());
      }
    }
 while (!buffers.isEmpty() && c > 0);
    if (!buffers.isEmpty()) {
      channel.resumeWrites();
    }
 else {
      writing.decrementAndGet();
      if (closing.get()) {
        closeIfDone();
      }
 else {
        subscription.request(1);
      }
    }
  }
 catch (  IOException ex) {
    onError(ex);
  }
}
