{
  JdoDialect dialect=mock(JdoDialect.class);
  final JDOException ex=new JDOException();
  given(dialect.translateException(ex)).willReturn(new DataIntegrityViolationException("test",ex));
  try {
    JdoTemplate template=createTemplate();
    template.setJdoDialect(dialect);
    template.execute(new JdoCallback(){
      @Override public Object doInJdo(      PersistenceManager pm){
        throw ex;
      }
    }
);
    fail("Should have thrown DataIntegrityViolationException");
  }
 catch (  DataIntegrityViolationException dive) {
  }
}
