{
  MockControl dialectControl=MockControl.createControl(JdoDialect.class);
  JdoDialect dialect=(JdoDialect)dialectControl.getMock();
  final JDOException ex=new JDOException();
  dialect.translateException(ex);
  dialectControl.setReturnValue(new DataIntegrityViolationException("test",ex));
  dialectControl.replay();
  try {
    JdoTemplate template=createTemplate();
    template.setJdoDialect(dialect);
    template.execute(new JdoCallback(){
      @Override public Object doInJdo(      PersistenceManager pm){
        throw ex;
      }
    }
);
    fail("Should have thrown DataIntegrityViolationException");
  }
 catch (  DataIntegrityViolationException dive) {
  }
  dialectControl.verify();
}
