{
  TypedValue currentContext=state.getActiveContextObject();
  Object[] arguments=new Object[getChildCount()];
  for (int i=0; i < arguments.length; i++) {
    try {
      state.pushActiveContextObject(state.getRootContextObject());
      arguments[i]=children[i].getValueInternal(state).getValue();
    }
  finally {
      state.popActiveContextObject();
    }
  }
  if (currentContext.getValue() == null) {
    if (nullSafe) {
      return ValueRef.NullValueRef.instance;
    }
 else {
      throw new SpelEvaluationException(getStartPosition(),SpelMessage.METHOD_CALL_ON_NULL_OBJECT_NOT_ALLOWED,FormatHelper.formatMethodForMessage(name,getTypes(arguments)));
    }
  }
  return new MethodValueRef(state,state.getEvaluationContext(),state.getActiveContextObject().getValue(),arguments);
}
