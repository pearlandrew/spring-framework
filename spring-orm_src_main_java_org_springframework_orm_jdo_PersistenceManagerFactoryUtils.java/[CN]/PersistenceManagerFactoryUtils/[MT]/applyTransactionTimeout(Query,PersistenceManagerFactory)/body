{
  Assert.notNull(query,"No Query object specified");
  PersistenceManagerHolder pmHolder=(PersistenceManagerHolder)TransactionSynchronizationManager.getResource(pmf);
  if (pmHolder != null && pmHolder.hasTimeout() && pmf.supportedOptions().contains("javax.jdo.option.DatastoreTimeout")) {
    int timeout=(int)pmHolder.getTimeToLiveInMillis();
    query.setDatastoreReadTimeoutMillis(timeout);
    query.setDatastoreWriteTimeoutMillis(timeout);
  }
}
