{
  DataSource ds=mock(DataSource.class);
  Connection con=mock(Connection.class);
  SqlMapClient client=mock(SqlMapClient.class);
  SqlMapSession session=mock(SqlMapSession.class);
  given(ds.getConnection()).willReturn(con);
  given(client.getDataSource()).willReturn(ds);
  given(client.openSession()).willReturn(session);
  given(session.queryForObject("myStatement","myParameter")).willReturn("myResult");
  SqlMapClientTemplate template=new SqlMapClientTemplate();
  template.setSqlMapClient(client);
  template.afterPropertiesSet();
  assertEquals("myResult",template.queryForObject("myStatement","myParameter"));
  verify(con).close();
  verify(session).setUserConnection(con);
  verify(session).close();
}
