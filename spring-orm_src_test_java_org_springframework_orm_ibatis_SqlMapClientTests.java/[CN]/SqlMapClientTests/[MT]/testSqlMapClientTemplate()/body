{
  DataSource ds=mock(DataSource.class);
  Connection con=mock(Connection.class);
  final SqlMapSession session=mock(SqlMapSession.class);
  SqlMapClient client=mock(SqlMapClient.class);
  given(ds.getConnection()).willReturn(con);
  given(client.openSession()).willReturn(session);
  SqlMapClientTemplate template=new SqlMapClientTemplate();
  template.setDataSource(ds);
  template.setSqlMapClient(client);
  template.afterPropertiesSet();
  Object result=template.execute(new SqlMapClientCallback(){
    @Override public Object doInSqlMapClient(    SqlMapExecutor executor){
      assertTrue(executor == session);
      return "done";
    }
  }
);
  assertEquals("done",result);
  verify(con).close();
  verify(session).setUserConnection(con);
  verify(session).close();
}
