{
  XmlBeanDefinitionReader reader=new XmlBeanDefinitionReader(appContext);
  reader.loadBeanDefinitions(new ClassPathResource("mvc-config-view-controllers.xml",getClass()));
  assertEquals(12,appContext.getBeanDefinitionCount());
  appContext.refresh();
  DefaultAnnotationHandlerMapping mapping=appContext.getBean(DefaultAnnotationHandlerMapping.class);
  assertNotNull(mapping);
  mapping.setDefaultHandler(new TestController());
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setMethod("GET");
  HandlerExecutionChain chain=mapping.getHandler(request);
  assertEquals(4,chain.getInterceptors().length);
  assertTrue(chain.getInterceptors()[1] instanceof ConversionServiceExposingInterceptor);
  assertTrue(chain.getInterceptors()[2] instanceof LocaleChangeInterceptor);
  assertTrue(chain.getInterceptors()[3] instanceof ThemeChangeInterceptor);
  SimpleUrlHandlerMapping mapping2=appContext.getBean(SimpleUrlHandlerMapping.class);
  assertNotNull(mapping2);
  SimpleControllerHandlerAdapter adapter=appContext.getBean(SimpleControllerHandlerAdapter.class);
  assertNotNull(adapter);
  request.setRequestURI("/foo");
  chain=mapping2.getHandler(request);
  assertEquals(4,chain.getInterceptors().length);
  assertTrue(chain.getInterceptors()[1] instanceof ConversionServiceExposingInterceptor);
  assertTrue(chain.getInterceptors()[2] instanceof LocaleChangeInterceptor);
  assertTrue(chain.getInterceptors()[3] instanceof ThemeChangeInterceptor);
  ModelAndView mv=adapter.handle(request,new MockHttpServletResponse(),chain.getHandler());
  assertNull(mv.getViewName());
  request.setRequestURI("/myapp/app/bar");
  request.setContextPath("/myapp");
  request.setServletPath("/app");
  chain=mapping2.getHandler(request);
  assertEquals(4,chain.getInterceptors().length);
  assertTrue(chain.getInterceptors()[1] instanceof ConversionServiceExposingInterceptor);
  assertTrue(chain.getInterceptors()[2] instanceof LocaleChangeInterceptor);
  assertTrue(chain.getInterceptors()[3] instanceof ThemeChangeInterceptor);
  ModelAndView mv2=adapter.handle(request,new MockHttpServletResponse(),chain.getHandler());
  assertEquals("baz",mv2.getViewName());
  request.setRequestURI("/myapp/app/");
  request.setContextPath("/myapp");
  request.setServletPath("/app");
  chain=mapping2.getHandler(request);
  assertEquals(4,chain.getInterceptors().length);
  assertTrue(chain.getInterceptors()[1] instanceof ConversionServiceExposingInterceptor);
  assertTrue(chain.getInterceptors()[2] instanceof LocaleChangeInterceptor);
  assertTrue(chain.getInterceptors()[3] instanceof ThemeChangeInterceptor);
  ModelAndView mv3=adapter.handle(request,new MockHttpServletResponse(),chain.getHandler());
  assertEquals("root",mv3.getViewName());
}
