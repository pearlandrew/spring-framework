{
  XmlBeanDefinitionReader reader=new XmlBeanDefinitionReader(appContext);
  reader.loadBeanDefinitions(new ClassPathResource("mvc-config.xml",getClass()));
  assertEquals(4,appContext.getBeanDefinitionCount());
  appContext.refresh();
  DefaultAnnotationHandlerMapping mapping=appContext.getBean(DefaultAnnotationHandlerMapping.class);
  assertNotNull(mapping);
  assertEquals(0,mapping.getOrder());
  AnnotationMethodHandlerAdapter adapter=appContext.getBean(AnnotationMethodHandlerAdapter.class);
  assertNotNull(adapter);
  HttpMessageConverter[] messageConverters=adapter.getMessageConverters();
  assertNotNull(messageConverters);
  assertEquals(6,messageConverters.length);
  assertTrue(ByteArrayHttpMessageConverter.class.equals(messageConverters[0].getClass()));
  assertTrue(StringHttpMessageConverter.class.equals(messageConverters[1].getClass()));
  assertTrue(FormHttpMessageConverter.class.equals(messageConverters[2].getClass()));
  assertTrue(SourceHttpMessageConverter.class.equals(messageConverters[3].getClass()));
  assertTrue(Jaxb2RootElementHttpMessageConverter.class.equals(messageConverters[4].getClass()));
  assertTrue(MappingJacksonHttpMessageConverter.class.equals(messageConverters[5].getClass()));
  assertNotNull(appContext.getBean(FormattingConversionServiceFactoryBean.class));
  assertNotNull(appContext.getBean(ConversionService.class));
  assertNotNull(appContext.getBean(LocalValidatorFactoryBean.class));
  assertNotNull(appContext.getBean(Validator.class));
  TestController handler=new TestController();
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.addParameter("date","2009-10-31");
  MockHttpServletResponse response=new MockHttpServletResponse();
  adapter.handle(request,response,handler);
  assertTrue(handler.recordedValidationError);
}
