{
  String scheme=request.getScheme();
  int port=request.getServerPort();
  ServletUriComponentsBuilder builder=new ServletUriComponentsBuilder();
  builder.scheme(scheme);
  builder.host(request.getServerName());
  if ((scheme.equals("http") && port != 80) || (scheme.equals("https") && port != 443)) {
    builder.port(port);
  }
  builder.path(new UrlPathHelper().getRequestUri(request));
  builder.query(request.getQueryString());
  return builder;
}
