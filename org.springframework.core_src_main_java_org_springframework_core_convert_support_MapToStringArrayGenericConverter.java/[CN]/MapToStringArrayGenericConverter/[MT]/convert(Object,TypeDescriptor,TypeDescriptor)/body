{
  Map sourceMap=(Map)source;
  TypeDescriptor sourceKeyType=sourceType.getMapKeyTypeDescriptor();
  TypeDescriptor sourceValueType=sourceType.getMapValueTypeDescriptor();
  TypeDescriptor targetElementType=targetType.getElementTypeDescriptor();
  boolean keysCompatible=false;
  if (sourceKeyType.isAssignableTo(targetElementType)) {
    keysCompatible=true;
  }
  boolean valuesCompatible=false;
  if (sourceValueType.isAssignableTo(targetElementType)) {
    valuesCompatible=true;
  }
  Object array=Array.newInstance(targetElementType.getType(),sourceMap.size());
  MapEntryConverter converter=new MapEntryConverter(sourceKeyType,sourceValueType,targetElementType,targetElementType,keysCompatible,valuesCompatible,conversionService);
  int i=0;
  for (  Object entry : sourceMap.entrySet()) {
    Map.Entry mapEntry=(Map.Entry)entry;
    Object key=mapEntry.getKey();
    Object value=mapEntry.getValue();
    String property=converter.convertKey(key) + "=" + converter.convertValue(value);
    Array.set(array,i,property);
    i++;
  }
  return array;
}
