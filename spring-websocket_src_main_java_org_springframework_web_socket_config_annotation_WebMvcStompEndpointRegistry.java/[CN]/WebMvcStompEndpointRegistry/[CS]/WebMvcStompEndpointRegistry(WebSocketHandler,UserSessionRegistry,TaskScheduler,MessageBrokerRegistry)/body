{
  Assert.notNull(webSocketHandler);
  Assert.notNull(userSessionRegistry);
  this.webSocketHandler=webSocketHandler;
  this.subProtocolWebSocketHandler=unwrapSubProtocolWebSocketHandler(webSocketHandler);
  this.stompHandler=new StompSubProtocolHandler();
  this.stompHandler.setUserSessionRegistry(userSessionRegistry);
  this.sockJsScheduler=defaultSockJsTaskScheduler;
  if (brokerRegistry.getMessageBufferSizeLimit() != null) {
    this.stompHandler.setMessageBufferSizeLimit(brokerRegistry.getMessageBufferSizeLimit());
  }
}
