{
  Assert.notNull(webSocketHandler,"'webSocketHandler' is required ");
  Assert.notNull(transportRegistration,"'transportRegistration' is required");
  this.webSocketHandler=webSocketHandler;
  this.subProtocolWebSocketHandler=unwrapSubProtocolWebSocketHandler(webSocketHandler);
  if (transportRegistration.getSendTimeLimit() != null) {
    this.subProtocolWebSocketHandler.setSendTimeLimit(transportRegistration.getSendTimeLimit());
  }
  if (transportRegistration.getSendBufferSizeLimit() != null) {
    this.subProtocolWebSocketHandler.setSendBufferSizeLimit(transportRegistration.getSendBufferSizeLimit());
  }
  this.stompHandler=new StompSubProtocolHandler();
  this.stompHandler.setUserSessionRegistry(userSessionRegistry);
  if (transportRegistration.getMessageSizeLimit() != null) {
    this.stompHandler.setMessageSizeLimit(transportRegistration.getMessageSizeLimit());
  }
  this.sockJsScheduler=defaultSockJsTaskScheduler;
}
