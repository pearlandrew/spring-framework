{
  HttpHeaders headers=outputMessage.getHeaders();
  if (headers.getContentType() == null) {
    if (contentType == null || contentType.isWildcardType() || contentType.isWildcardSubtype()) {
      contentType=getDefaultContentType(t);
    }
    if (contentType != null) {
      headers.setContentType(contentType);
    }
  }
  if (headers.getContentLength() == -1) {
    Long contentLength=getContentLength(t,headers.getContentType());
    if (contentLength != null) {
      headers.setContentLength(contentLength);
    }
  }
  writeInternal(t,outputMessage);
  outputMessage.getBody().flush();
}
