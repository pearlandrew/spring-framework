{
  CachedIntrospectionResults results;
  Object value=classCache.get(beanClass);
  if (value instanceof Reference) {
    Reference ref=(Reference)value;
    results=(CachedIntrospectionResults)ref.get();
  }
 else {
    results=(CachedIntrospectionResults)value;
  }
  if (results == null) {
    boolean fullyCacheable=ClassUtils.isCacheSafe(beanClass,CachedIntrospectionResults.class.getClassLoader()) || isClassLoaderAccepted(beanClass.getClassLoader());
    if (fullyCacheable || !ClassUtils.isPresent(beanClass.getName() + "BeanInfo",beanClass.getClassLoader())) {
      results=new CachedIntrospectionResults(beanClass,fullyCacheable);
      classCache.put(beanClass,results);
    }
 else {
      if (logger.isDebugEnabled()) {
        logger.debug("Not strongly caching class [" + beanClass.getName() + "] because it is not cache-safe");
      }
      results=new CachedIntrospectionResults(beanClass,true);
      classCache.put(beanClass,new WeakReference<CachedIntrospectionResults>(results));
    }
  }
  return results;
}
