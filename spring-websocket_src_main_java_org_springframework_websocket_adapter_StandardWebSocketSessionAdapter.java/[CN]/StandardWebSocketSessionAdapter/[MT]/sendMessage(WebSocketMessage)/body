{
  if (logger.isTraceEnabled()) {
    logger.trace("Sending: " + message + ", "+ this);
  }
  Assert.isTrue(isOpen(),"Cannot send message after connection closed.");
  Basic remote=this.session.getBasicRemote();
  if (message instanceof TextMessage) {
    remote.sendText(((TextMessage)message).getPayload());
  }
 else   if (message instanceof BinaryMessage) {
    remote.sendBinary(((BinaryMessage)message).getPayload());
  }
 else {
    throw new IllegalStateException("Unexpected WebSocketMessage type: " + message);
  }
}
