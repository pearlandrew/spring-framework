{
  loadBeanDefinitions("websocket-config-broker-simple.xml");
  HandlerMapping hm=this.appContext.getBean(HandlerMapping.class);
  assertNotNull(hm);
  assertThat(hm,Matchers.instanceOf(SimpleUrlHandlerMapping.class));
  SimpleUrlHandlerMapping suhm=(SimpleUrlHandlerMapping)hm;
  assertThat(suhm.getUrlMap().keySet(),Matchers.hasSize(4));
  assertThat(suhm.getUrlMap().values(),Matchers.hasSize(4));
  HttpRequestHandler httpRequestHandler=(HttpRequestHandler)suhm.getUrlMap().get("/foo");
  assertNotNull(httpRequestHandler);
  assertThat(httpRequestHandler,Matchers.instanceOf(WebSocketHttpRequestHandler.class));
  WebSocketHttpRequestHandler wsHttpRequestHandler=(WebSocketHttpRequestHandler)httpRequestHandler;
  WebSocketHandler wsHandler=unwrapWebSocketHandler(wsHttpRequestHandler.getWebSocketHandler());
  assertNotNull(wsHandler);
  assertThat(wsHandler,Matchers.instanceOf(SubProtocolWebSocketHandler.class));
  SubProtocolWebSocketHandler subProtocolWsHandler=(SubProtocolWebSocketHandler)wsHandler;
  assertEquals(Arrays.asList("v10.stomp","v11.stomp","v12.stomp"),subProtocolWsHandler.getSubProtocols());
  httpRequestHandler=(HttpRequestHandler)suhm.getUrlMap().get("/test/**");
  assertNotNull(httpRequestHandler);
  assertThat(httpRequestHandler,Matchers.instanceOf(SockJsHttpRequestHandler.class));
  SockJsHttpRequestHandler sockJsHttpRequestHandler=(SockJsHttpRequestHandler)httpRequestHandler;
  wsHandler=unwrapWebSocketHandler(sockJsHttpRequestHandler.getWebSocketHandler());
  assertNotNull(wsHandler);
  assertThat(wsHandler,Matchers.instanceOf(SubProtocolWebSocketHandler.class));
  assertNotNull(sockJsHttpRequestHandler.getSockJsService());
  UserDestinationResolver userDestResolver=this.appContext.getBean(UserDestinationResolver.class);
  assertNotNull(userDestResolver);
  assertThat(userDestResolver,Matchers.instanceOf(DefaultUserDestinationResolver.class));
  DefaultUserDestinationResolver defaultUserDestResolver=(DefaultUserDestinationResolver)userDestResolver;
  assertEquals("/personal/",defaultUserDestResolver.getDestinationPrefix());
  List<Class<? extends MessageHandler>> subscriberTypes=Arrays.<Class<? extends MessageHandler>>asList(SimpAnnotationMethodMessageHandler.class,UserDestinationMessageHandler.class,SimpleBrokerMessageHandler.class);
  testChannel("clientInboundChannel",subscriberTypes,0);
  testExecutor("clientInboundChannel",1,Integer.MAX_VALUE,60);
  subscriberTypes=Arrays.<Class<? extends MessageHandler>>asList(SubProtocolWebSocketHandler.class);
  testChannel("clientOutboundChannel",subscriberTypes,0);
  testExecutor("clientOutboundChannel",1,Integer.MAX_VALUE,60);
  subscriberTypes=Arrays.<Class<? extends MessageHandler>>asList(SimpleBrokerMessageHandler.class,UserDestinationMessageHandler.class);
  testChannel("brokerChannel",subscriberTypes,0);
  try {
    this.appContext.getBean("brokerChannelExecutor",ThreadPoolTaskExecutor.class);
    fail("expected exception");
  }
 catch (  NoSuchBeanDefinitionException ex) {
  }
}
