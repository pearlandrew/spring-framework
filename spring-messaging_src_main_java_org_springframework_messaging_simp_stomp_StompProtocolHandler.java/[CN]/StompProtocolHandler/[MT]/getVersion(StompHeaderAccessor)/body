{
  String name=StompHeaderAccessor.CONNECT_MESSAGE_HEADER;
  Message<?> connectMessage=(Message<?>)connectAckHeaders.getHeader(name);
  StompHeaderAccessor connectHeaders=StompHeaderAccessor.wrap(connectMessage);
  Assert.notNull(connectMessage,"CONNECT_ACK does not contain original CONNECT " + connectAckHeaders);
  Set<String> acceptVersions=connectHeaders.getAcceptVersion();
  if (acceptVersions.contains("1.2")) {
    return "1.2";
  }
 else   if (acceptVersions.contains("1.1")) {
    return "1.1";
  }
 else   if (acceptVersions.isEmpty()) {
    return null;
  }
 else {
    throw new StompConversionException("Unsupported version '" + acceptVersions + "'");
  }
}
