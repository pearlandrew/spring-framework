{
  StompHeaderAccessor connectHeaders=StompHeaderAccessor.wrap(message);
  StompHeaderAccessor connectedHeaders=StompHeaderAccessor.create(StompCommand.CONNECTED);
  Set<String> acceptVersions=connectHeaders.getAcceptVersion();
  if (acceptVersions.contains("1.2")) {
    connectedHeaders.setAcceptVersion("1.2");
  }
 else   if (acceptVersions.contains("1.1")) {
    connectedHeaders.setAcceptVersion("1.1");
  }
 else   if (acceptVersions.isEmpty()) {
  }
 else {
    throw new StompConversionException("Unsupported version '" + acceptVersions + "'");
  }
  connectedHeaders.setHeartbeat(0,0);
  Principal principal=session.getPrincipal();
  if (principal != null) {
    connectedHeaders.setNativeHeader(CONNECTED_USER_HEADER,principal.getName());
    connectedHeaders.setNativeHeader(QUEUE_SUFFIX_HEADER,session.getId());
    if (this.queueSuffixResolver != null) {
      String suffix=session.getId();
      this.queueSuffixResolver.addQueueSuffix(principal.getName(),session.getId(),suffix);
    }
  }
  Message<?> connectedMessage=MessageBuilder.withPayloadAndHeaders(new byte[0],connectedHeaders).build();
  byte[] bytes=this.stompMessageConverter.fromMessage(connectedMessage);
  session.sendMessage(new TextMessage(new String(bytes,Charset.forName("UTF-8"))));
}
