{
  JmsTemplate102 template=createTemplate();
  template.setPubSubDomain(true);
  template.setConnectionFactory(topicConnectionFactory);
  template.afterPropertiesSet();
  TopicPublisher topicPublisher=mock(TopicPublisher.class);
  given(topicSession.createPublisher(null)).willReturn(topicPublisher);
  given(topicPublisher.getPriority()).willReturn(4);
  template.execute(new ProducerCallback(){
    @Override public Object doInJms(    Session session,    MessageProducer producer) throws JMSException {
      session.getTransacted();
      producer.getPriority();
      return null;
    }
  }
);
  verify(topicPublisher).close();
  verify(topicSession).close();
  verify(topicConnection).close();
}
