{
  JmsTemplate template=createTemplate();
  template.setConnectionFactory(queueConnectionFactory);
  template.setMessageConverter(new SimpleMessageConverter());
  String s="Hello world";
  QueueSender queueSender=mock(QueueSender.class);
  TextMessage textMessage=mock(TextMessage.class);
  reset(queueSession);
  given(queueSession.createSender(queue)).willReturn(queueSender);
  given(queueSession.createTextMessage("Hello world")).willReturn(textMessage);
  willThrow(original).given(queueSender).send(textMessage);
  try {
    template.convertAndSend(queue,s);
    fail("Should have thrown JmsException");
  }
 catch (  JmsException wrappedEx) {
    assertEquals(thrownExceptionClass,wrappedEx.getClass());
    assertEquals(original,wrappedEx.getCause());
  }
  verify(queueSender).close();
  verify(queueSession).close();
  verify(queueConnection).close();
}
