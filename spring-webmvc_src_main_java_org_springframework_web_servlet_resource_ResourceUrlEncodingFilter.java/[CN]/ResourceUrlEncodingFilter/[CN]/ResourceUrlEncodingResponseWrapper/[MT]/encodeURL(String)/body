{
  ResourceUrlProvider resourceUrlProvider=getResourceUrlProvider();
  if (resourceUrlProvider == null) {
    logger.debug("Request attribute exposing ResourceUrlProvider not found");
    return super.encodeURL(url);
  }
  initIndexLookupPath(resourceUrlProvider);
  if (url.length() >= this.indexLookupPath) {
    String prefix=url.substring(0,this.indexLookupPath);
    String lookupPath=url.substring(this.indexLookupPath);
    lookupPath=resourceUrlProvider.getForLookupPath(lookupPath);
    if (lookupPath != null) {
      return super.encodeURL(prefix + lookupPath);
    }
  }
  return super.encodeURL(url);
}
