{
  RequestAttributes requestAttributes=RequestContextHolder.getRequestAttributes();
  if (requestAttributes instanceof ServletRequestAttributes) {
    HttpServletRequest request=((ServletRequestAttributes)requestAttributes).getRequest();
    if (request instanceof MockHttpServletRequest) {
      MockHttpServletRequest mockRequest=(MockHttpServletRequest)request;
      Object createdByTcf=mockRequest.getAttribute(ServletTestExecutionListener.CREATED_BY_THE_TESTCONTEXT_FRAMEWORK);
      if (Boolean.TRUE.equals(createdByTcf)) {
        return mockRequest;
      }
    }
  }
  return new MockHttpServletRequest(servletContext);
}
