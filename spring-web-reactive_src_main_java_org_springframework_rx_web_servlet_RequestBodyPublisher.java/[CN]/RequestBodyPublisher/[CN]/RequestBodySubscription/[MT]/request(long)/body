{
  logger.debug("Updating demand " + demand + " by "+ n);
  boolean stalled=demand <= 0;
  if (n != Long.MAX_VALUE && demand != Long.MAX_VALUE) {
    demand+=n;
  }
 else {
    demand=Long.MAX_VALUE;
  }
  if (stalled) {
    try {
      onDataAvailable();
    }
 catch (    IOException ex) {
      onError(ex);
    }
  }
}
