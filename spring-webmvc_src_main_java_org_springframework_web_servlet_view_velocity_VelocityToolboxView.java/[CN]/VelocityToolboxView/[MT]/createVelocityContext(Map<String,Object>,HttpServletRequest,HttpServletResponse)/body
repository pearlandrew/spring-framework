{
  ChainedContext velocityContext=new ChainedContext(new VelocityContext(model),getVelocityEngine(),request,response,getServletContext());
  if (getToolboxConfigLocation() != null) {
    ToolboxManager toolboxManager=ServletToolboxManager.getInstance(getServletContext(),getToolboxConfigLocation());
    Map toolboxContext=toolboxManager.getToolbox(velocityContext);
    velocityContext.setToolbox(toolboxContext);
  }
  return velocityContext;
}
