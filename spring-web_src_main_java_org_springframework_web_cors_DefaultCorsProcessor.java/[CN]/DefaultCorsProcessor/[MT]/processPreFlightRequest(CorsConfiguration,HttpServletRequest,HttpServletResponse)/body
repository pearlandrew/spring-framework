{
  ServerHttpRequest serverRequest=new ServletServerHttpRequest(request);
  ServerHttpResponse serverResponse=new ServletServerHttpResponse(response);
  boolean isPreFlight=CorsUtils.isPreFlightRequest(request);
  Assert.isTrue(isPreFlight);
  if (skip(serverResponse)) {
    return true;
  }
  if (check(serverRequest,serverResponse,config,isPreFlight)) {
    setAllowOrigin(serverRequest,serverResponse,config.getAllowedOrigins(),config.isAllowCredentials());
    setAllowCredentials(serverResponse,config.isAllowCredentials());
    setAllowMethods(serverRequest,serverResponse,config.getAllowedMethods());
    setAllowHeadersHeader(serverRequest,serverResponse,config.getAllowedHeaders());
    setMaxAgeHeader(serverResponse,config.getMaxAge());
    serverResponse.close();
    return true;
  }
  return false;
}
