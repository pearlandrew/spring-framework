{
  ServerHttpRequest serverRequest=new ServletServerHttpRequest(request);
  ServerHttpResponse serverResponse=new ServletServerHttpResponse(response);
  boolean isPreFlight=CorsUtils.isPreFlightRequest(request);
  Assert.isTrue(CorsUtils.isCorsRequest(request) && !isPreFlight);
  if (skip(serverResponse)) {
    return true;
  }
  if (check(serverRequest,serverResponse,config,isPreFlight)) {
    setAllowOrigin(serverRequest,serverResponse,config.getAllowedOrigins(),config.isAllowCredentials());
    setAllowCredentials(serverResponse,config.isAllowCredentials());
    setExposeHeadersHeader(serverResponse,config.getExposedHeaders());
    serverResponse.close();
    return true;
  }
  return false;
}
