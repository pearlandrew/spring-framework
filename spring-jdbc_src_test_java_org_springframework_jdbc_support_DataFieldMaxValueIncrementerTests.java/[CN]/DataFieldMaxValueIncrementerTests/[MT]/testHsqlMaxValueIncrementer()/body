{
  given(dataSource.getConnection()).willReturn(connection);
  given(connection.createStatement()).willReturn(statement);
  given(statement.executeUpdate("insert into myseq values(null)")).willReturn(1);
  given(statement.executeQuery("select max(identity()) from myseq")).willReturn(resultSet);
  given(resultSet.next()).willReturn(true);
  given(resultSet.getLong(1)).willReturn(0L,1L,2L,3L,4L,5L);
  given(statement.executeUpdate("delete from myseq where seq < 2")).willReturn(1);
  given(statement.executeUpdate("delete from myseq where seq < 5")).willReturn(1);
  HsqlMaxValueIncrementer incrementer=new HsqlMaxValueIncrementer();
  incrementer.setDataSource(dataSource);
  incrementer.setIncrementerName("myseq");
  incrementer.setColumnName("seq");
  incrementer.setCacheSize(3);
  incrementer.setPaddingLength(3);
  incrementer.afterPropertiesSet();
  assertEquals(0,incrementer.nextIntValue());
  assertEquals(1,incrementer.nextLongValue());
  assertEquals("002",incrementer.nextStringValue());
  assertEquals(3,incrementer.nextIntValue());
  assertEquals(4,incrementer.nextLongValue());
  verify(resultSet,times(6)).close();
  verify(statement,times(2)).close();
  verify(connection,times(2)).close();
}
