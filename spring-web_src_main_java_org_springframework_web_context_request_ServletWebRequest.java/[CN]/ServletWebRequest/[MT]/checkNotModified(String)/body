{
  HttpServletResponse response=getResponse();
  if (StringUtils.hasLength(etag) && !this.notModified && (response == null || !response.containsHeader(HEADER_ETAG))) {
    String ifNoneMatch=getRequest().getHeader(HEADER_IF_NONE_MATCH);
    this.notModified=etag.equals(ifNoneMatch);
    if (response != null) {
      if (this.notModified && supportsNotModifiedStatus()) {
        response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
      }
 else {
        response.setHeader(HEADER_ETAG,etag);
      }
    }
  }
  return this.notModified;
}
