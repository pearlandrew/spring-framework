{
  HttpServletResponse response=getResponse();
  if (StringUtils.hasLength(etag) && !this.notModified) {
    if (isCompatibleWithConditionalRequests(response)) {
      etag=addEtagPadding(etag);
      if (hasRequestHeader(HEADER_IF_NONE_MATCH)) {
        this.notModified=isEtagNotModified(etag);
      }
 else       if (hasRequestHeader(HEADER_IF_MODIFIED_SINCE)) {
        this.notModified=isTimestampNotModified(lastModifiedTimestamp);
      }
      if (response != null) {
        if (supportsNotModifiedStatus()) {
          if (this.notModified) {
            response.setStatus(HttpServletResponse.SC_NOT_MODIFIED);
          }
          if (isHeaderAbsent(response,HEADER_ETAG)) {
            response.setHeader(HEADER_ETAG,etag);
          }
          if (isHeaderAbsent(response,HEADER_LAST_MODIFIED)) {
            response.setDateHeader(HEADER_LAST_MODIFIED,lastModifiedTimestamp);
          }
        }
 else         if (supportsConditionalUpdate()) {
          if (this.notModified) {
            response.setStatus(HttpServletResponse.SC_PRECONDITION_FAILED);
          }
        }
      }
    }
  }
  return this.notModified;
}
