{
  if (!parserContext.getRegistry().containsBeanDefinition(schedulerName)) {
    RootBeanDefinition taskSchedulerDef=new RootBeanDefinition(ThreadPoolTaskScheduler.class);
    taskSchedulerDef.setSource(source);
    taskSchedulerDef.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);
    taskSchedulerDef.getPropertyValues().add("poolSize",Runtime.getRuntime().availableProcessors());
    taskSchedulerDef.getPropertyValues().add("threadNamePrefix",schedulerName + "-");
    if (hasRemoveOnCancelPolicyMethod) {
      taskSchedulerDef.getPropertyValues().add("removeOnCancelPolicy",true);
    }
    parserContext.getRegistry().registerBeanDefinition(schedulerName,taskSchedulerDef);
    parserContext.registerComponent(new BeanComponentDefinition(taskSchedulerDef,schedulerName));
  }
  return new RuntimeBeanReference(schedulerName);
}
