{
  Class<?> formattedObjectType=GenericTypeResolver.resolveTypeArgument(formatter.getClass(),Formatter.class);
  if (formattedObjectType != null && !type.isAssignableFrom(formattedObjectType)) {
    if (this.conversionService == null) {
      throw new IllegalStateException("Unable to index Formatter " + formatter + " under type ["+ type.getName()+ "]; not able to convert from a ["+ formattedObjectType.getName()+ "] parsed by the Formatter to ["+ type.getName()+ "] because this.conversionService is null");
    }
    if (!this.conversionService.canConvert(formattedObjectType,type)) {
      throw new IllegalArgumentException("Unable to index Formatter " + formatter + " under type ["+ type.getName()+ "]; not able to convert from a ["+ formattedObjectType.getName()+ "] parsed by the Formatter to ["+ type.getName()+ "]");
    }
    if (!this.conversionService.canConvert(type,formattedObjectType)) {
      throw new IllegalArgumentException("Unable to index Formatter " + formatter + " under type ["+ type.getName()+ "]; not able to convert to ["+ formattedObjectType.getName()+ "] to format a ["+ type.getName()+ "]");
    }
  }
  this.typeFormatters.put(type,new FormatterHolder(formattedObjectType,formatter));
}
