{
  Class<?> formatterObjectType=GenericTypeResolver.resolveTypeArgument(formatter.getClass(),Formatter.class);
  if (formatterObjectType != null && !type.isAssignableFrom(formatterObjectType)) {
    if (this.conversionService == null) {
      throw new IllegalStateException("Unable to index Formatter " + formatter + " under type ["+ type.getName()+ "]; not able to convert from a ["+ formatterObjectType.getName()+ "] parsed by the Formatter to ["+ type.getName()+ "] because this.conversionService is null");
    }
    if (!this.conversionService.canConvert(formatterObjectType,type)) {
      throw new IllegalArgumentException("Unable to index Formatter " + formatter + " under type ["+ type.getName()+ "]; not able to convert from a ["+ formatterObjectType.getName()+ "] parsed by the Formatter to ["+ type.getName()+ "]");
    }
    if (!this.conversionService.canConvert(type,formatterObjectType)) {
      throw new IllegalArgumentException("Unable to index Formatter " + formatter + " under type ["+ type.getName()+ "]; not able to convert to ["+ formatterObjectType.getName()+ "] to format a ["+ type.getName()+ "]");
    }
  }
  this.typeFormatters.put(type,new FormatterHolder(formatterObjectType,formatter));
}
