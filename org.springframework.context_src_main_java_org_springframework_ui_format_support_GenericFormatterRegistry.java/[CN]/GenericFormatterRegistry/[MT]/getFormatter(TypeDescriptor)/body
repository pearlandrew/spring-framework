{
  Assert.notNull(type,"TypeDescriptor is required");
  Formatter<Object> formatter=getAnnotationFormatter(type);
  if (formatter == null) {
    formatter=getTypeFormatter(type.getType());
  }
  if (formatter != null) {
    Class<?> formattedObjectType=GenericTypeResolver.resolveTypeArgument(formatter.getClass(),Formatter.class);
    if (!type.getType().isAssignableFrom(formattedObjectType)) {
      return new ConvertingFormatter(type.getType(),formattedObjectType,formatter);
    }
  }
  return formatter;
}
