{
  if (!this.hibernateTransactionCompletion || !this.newSession) {
    Session session=this.sessionHolder.getSession();
    if (session instanceof SessionImplementor) {
      ((SessionImplementor)session).afterTransactionCompletion(status == STATUS_COMMITTED,null);
    }
    if (this.newSession) {
      SessionFactoryUtils.closeSessionOrRegisterDeferredClose(session,this.sessionFactory);
    }
 else     if (!this.hibernateTransactionCompletion) {
      session.disconnect();
    }
  }
  if (!this.newSession && status != STATUS_COMMITTED) {
    this.sessionHolder.getSession().clear();
  }
  if (this.sessionHolder.doesNotHoldNonDefaultSession()) {
    this.sessionHolder.setSynchronizedWithTransaction(false);
  }
}
