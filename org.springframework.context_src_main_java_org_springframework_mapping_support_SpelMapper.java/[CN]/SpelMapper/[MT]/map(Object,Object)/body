{
  Assert.notNull(source,"The source to map from cannot be null");
  Assert.notNull(target,"The target to map to cannot be null");
  try {
    MappingContextHolder.push(source);
    EvaluationContext sourceContext=getEvaluationContext(source);
    EvaluationContext targetContext=getEvaluationContext(target);
    List<MappingFailure> failures=new LinkedList<MappingFailure>();
    for (    SpelMapping mapping : this.mappings) {
      doMap(mapping,sourceContext,targetContext,failures);
    }
    Set<SpelMapping> autoMappings=getAutoMappings(sourceContext,targetContext);
    for (    SpelMapping mapping : autoMappings) {
      doMap(mapping,sourceContext,targetContext,failures);
    }
    if (!failures.isEmpty()) {
      throw new MappingException(failures);
    }
    return target;
  }
  finally {
    MappingContextHolder.pop();
  }
}
