{
  TestBean tb=new TestBean();
  sf.openSession();
  sfControl.setReturnValue(session,1);
  session.getSessionFactory();
  sessionControl.setReturnValue(sf,1);
  session.get("myEntity","",LockMode.UPGRADE_NOWAIT);
  sessionControl.setReturnValue(tb,1);
  session.flush();
  sessionControl.setVoidCallable(1);
  session.close();
  sessionControl.setReturnValue(null,1);
  sfControl.replay();
  sessionControl.replay();
  HibernateTemplate ht=new HibernateTemplate(sf);
  Object result=ht.get("myEntity","",LockMode.UPGRADE_NOWAIT);
  assertTrue("Correct result",result == tb);
}
