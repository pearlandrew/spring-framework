{
  TestBean tb=new TestBean();
  TestBean tbMerged=new TestBean();
  sf.openSession();
  sfControl.setReturnValue(session,1);
  session.getSessionFactory();
  sessionControl.setReturnValue(sf,1);
  session.getFlushMode();
  sessionControl.setReturnValue(FlushMode.AUTO);
  session.merge(tb);
  sessionControl.setReturnValue(tbMerged,1);
  session.flush();
  sessionControl.setVoidCallable(1);
  session.close();
  sessionControl.setReturnValue(null,1);
  sfControl.replay();
  sessionControl.replay();
  HibernateTemplate ht=new HibernateTemplate(sf);
  assertSame(tbMerged,ht.merge(tb));
}
