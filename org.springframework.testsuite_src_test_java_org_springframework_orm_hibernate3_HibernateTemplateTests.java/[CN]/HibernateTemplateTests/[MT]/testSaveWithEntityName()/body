{
  TestBean tb=new TestBean();
  sf.openSession();
  sfControl.setReturnValue(session,1);
  session.getSessionFactory();
  sessionControl.setReturnValue(sf,1);
  session.getFlushMode();
  sessionControl.setReturnValue(FlushMode.AUTO);
  session.save("myEntity",tb);
  sessionControl.setReturnValue(new Integer(0),1);
  session.flush();
  sessionControl.setVoidCallable(1);
  session.close();
  sessionControl.setReturnValue(null,1);
  sfControl.replay();
  sessionControl.replay();
  HibernateTemplate ht=new HibernateTemplate(sf);
  assertEquals("Correct return value",ht.save("myEntity",tb),new Integer(0));
}
