{
  if (!isClosed()) {
    if (logger.isDebugEnabled()) {
      logger.debug(this + " was closed, " + status);
    }
    try {
      connectionClosedInternal(status);
    }
  finally {
      this.state=State.CLOSED;
      try {
        this.handler.afterConnectionClosed(status,this);
      }
  finally {
        destroyHandler();
      }
    }
  }
}
