{
  try {
    if (byte[].class.equals(getSerializedPayloadClass())) {
      ByteArrayOutputStream out=new ByteArrayOutputStream(1024);
      JsonEncoding encoding=getJsonEncoding(getMimeType(headers));
      JsonGenerator generator=this.objectMapper.getFactory().createGenerator(out,encoding);
      this.objectMapper.writeValue(generator,payload);
      payload=out.toByteArray();
    }
 else {
      Writer writer=new StringWriter();
      this.objectMapper.writeValue(writer,payload);
      payload=writer.toString();
    }
  }
 catch (  IOException ex) {
    throw new MessageConversionException("Could not write JSON: " + ex.getMessage(),ex);
  }
  return payload;
}
