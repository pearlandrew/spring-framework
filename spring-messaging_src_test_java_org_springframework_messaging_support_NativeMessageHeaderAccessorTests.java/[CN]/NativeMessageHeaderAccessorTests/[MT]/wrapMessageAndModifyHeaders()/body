{
  MultiValueMap<String,String> originalNativeHeaders=new LinkedMultiValueMap<>();
  originalNativeHeaders.add("foo","bar");
  originalNativeHeaders.add("bar","baz");
  Map<String,Object> original=new HashMap<String,Object>();
  original.put("a","b");
  original.put(NativeMessageHeaderAccessor.NATIVE_HEADERS,originalNativeHeaders);
  GenericMessage<String> message=new GenericMessage<>("p",original);
  NativeMessageHeaderAccessor headers=new NativeMessageHeaderAccessor(message);
  headers.setHeader("a","B");
  headers.setNativeHeader("foo","BAR");
  Map<String,Object> actual=headers.toMap();
  assertEquals(4,actual.size());
  assertNotNull(actual.get(MessageHeaders.ID));
  assertNotNull(actual.get(MessageHeaders.TIMESTAMP));
  assertEquals("B",actual.get("a"));
  @SuppressWarnings("unchecked") Map<String,List<String>> actualNativeHeaders=(Map<String,List<String>>)actual.get(NativeMessageHeaderAccessor.NATIVE_HEADERS);
  assertNotNull(actualNativeHeaders);
  assertEquals(Arrays.asList("BAR"),actualNativeHeaders.get("foo"));
  assertEquals(Arrays.asList("baz"),actualNativeHeaders.get("bar"));
}
