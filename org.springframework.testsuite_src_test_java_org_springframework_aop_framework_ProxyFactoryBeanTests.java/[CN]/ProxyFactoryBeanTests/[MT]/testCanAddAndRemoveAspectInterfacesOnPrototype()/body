{
  try {
    TimeStamped ts=(TimeStamped)factory.getBean("test2");
    fail("Shouldn't implement TimeStamped before manipulation");
  }
 catch (  ClassCastException ex) {
  }
  ProxyFactoryBean config=(ProxyFactoryBean)factory.getBean("&test2");
  long time=666L;
  TimestampIntroductionInterceptor ti=new TimestampIntroductionInterceptor();
  ti.setTime(time);
  int oldCount=config.getAdvisors().length;
  config.addAdvisor(0,new DefaultIntroductionAdvisor(ti,TimeStamped.class));
  assertTrue(config.getAdvisors().length == oldCount + 1);
  TimeStamped ts=(TimeStamped)factory.getBean("test2");
  assertEquals(time,ts.getTimeStamp());
  config.removeAdvice(ti);
  assertTrue(config.getAdvisors().length == oldCount);
  assertTrue(ts.getTimeStamp() == time);
  try {
    ts=(TimeStamped)factory.getBean("test2");
    fail("Should no longer implement TimeStamped");
  }
 catch (  ClassCastException ex) {
  }
  config.removeAdvice(new DebugInterceptor());
  assertTrue(config.getAdvisors().length == oldCount);
  ITestBean it=(ITestBean)ts;
  DebugInterceptor debugInterceptor=new DebugInterceptor();
  config.addAdvice(0,debugInterceptor);
  it.getSpouse();
  assertTrue(debugInterceptor.getCount() == 0);
  it=(ITestBean)factory.getBean("test2");
  it.getSpouse();
  assertEquals(1,debugInterceptor.getCount());
  config.removeAdvice(debugInterceptor);
  it.getSpouse();
  assertEquals(2,debugInterceptor.getCount());
  it=(ITestBean)factory.getBean("test2");
  it.getSpouse();
  assertEquals(2,debugInterceptor.getCount());
  assertEquals(time,ts.getTimeStamp());
}
