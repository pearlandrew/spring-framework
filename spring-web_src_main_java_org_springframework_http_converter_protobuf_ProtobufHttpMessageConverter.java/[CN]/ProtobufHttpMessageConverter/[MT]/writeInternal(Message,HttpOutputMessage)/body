{
  MediaType contentType=outputMessage.getHeaders().getContentType();
  Charset charset=getCharset(contentType);
  if (MediaType.TEXT_HTML.isCompatibleWith(contentType)) {
    HtmlFormat.print(message,new OutputStreamWriter(outputMessage.getBody(),charset));
  }
 else   if (MediaType.APPLICATION_JSON.isCompatibleWith(contentType)) {
    JsonFormat.print(message,new OutputStreamWriter(outputMessage.getBody(),charset));
  }
 else   if (MediaType.TEXT_PLAIN.isCompatibleWith(contentType)) {
    TextFormat.print(message,new OutputStreamWriter(outputMessage.getBody(),charset));
  }
 else   if (MediaType.APPLICATION_XML.isCompatibleWith(contentType)) {
    XmlFormat.print(message,new OutputStreamWriter(outputMessage.getBody(),charset));
  }
 else   if (PROTOBUF.isCompatibleWith(contentType)) {
    setProtoHeader(outputMessage,message);
    FileCopyUtils.copy(message.toByteArray(),outputMessage.getBody());
  }
}
