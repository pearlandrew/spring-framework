{
  MediaType contentType=outputMessage.getHeaders().getContentType();
  Charset charset=getCharset(contentType);
  if (MediaType.TEXT_HTML.isCompatibleWith(contentType)) {
    final OutputStreamWriter outputStreamWriter=new OutputStreamWriter(outputMessage.getBody(),charset);
    HtmlFormat.print(message,outputStreamWriter);
    outputStreamWriter.flush();
  }
 else   if (MediaType.APPLICATION_JSON.isCompatibleWith(contentType)) {
    final OutputStreamWriter outputStreamWriter=new OutputStreamWriter(outputMessage.getBody(),charset);
    JsonFormat.print(message,outputStreamWriter);
    outputStreamWriter.flush();
  }
 else   if (MediaType.TEXT_PLAIN.isCompatibleWith(contentType)) {
    final OutputStreamWriter outputStreamWriter=new OutputStreamWriter(outputMessage.getBody(),charset);
    TextFormat.print(message,outputStreamWriter);
    outputStreamWriter.flush();
  }
 else   if (MediaType.APPLICATION_XML.isCompatibleWith(contentType)) {
    final OutputStreamWriter outputStreamWriter=new OutputStreamWriter(outputMessage.getBody(),charset);
    XmlFormat.print(message,outputStreamWriter);
    outputStreamWriter.flush();
  }
 else   if (PROTOBUF.isCompatibleWith(contentType)) {
    setProtoHeader(outputMessage,message);
    FileCopyUtils.copy(message.toByteArray(),outputMessage.getBody());
  }
}
