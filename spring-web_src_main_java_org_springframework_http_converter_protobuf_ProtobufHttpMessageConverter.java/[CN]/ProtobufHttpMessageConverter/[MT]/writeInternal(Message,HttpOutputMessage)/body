{
  MediaType contentType=outputMessage.getHeaders().getContentType();
  if (contentType == null) {
    contentType=getDefaultContentType(message);
  }
  Charset charset=contentType.getCharSet();
  if (charset == null) {
    charset=DEFAULT_CHARSET;
  }
  if (MediaType.TEXT_PLAIN.isCompatibleWith(contentType)) {
    OutputStreamWriter outputStreamWriter=new OutputStreamWriter(outputMessage.getBody(),charset);
    TextFormat.print(message,outputStreamWriter);
    outputStreamWriter.flush();
  }
 else   if (MediaType.APPLICATION_JSON.isCompatibleWith(contentType)) {
    JSON_FORMAT.print(message,outputMessage.getBody(),charset);
  }
 else   if (MediaType.APPLICATION_XML.isCompatibleWith(contentType)) {
    XML_FORMAT.print(message,outputMessage.getBody(),charset);
  }
 else   if (MediaType.TEXT_HTML.isCompatibleWith(contentType)) {
    HTML_FORMAT.print(message,outputMessage.getBody(),charset);
  }
 else   if (PROTOBUF.isCompatibleWith(contentType)) {
    setProtoHeader(outputMessage,message);
    FileCopyUtils.copy(message.toByteArray(),outputMessage.getBody());
  }
}
