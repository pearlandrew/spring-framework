{
  if (ex instanceof StreamException) {
    if (marshalling) {
      return new XStreamMarshallingFailureException((StreamException)ex);
    }
 else {
      return new XStreamUnmarshallingFailureException((StreamException)ex);
    }
  }
 else   if (ex instanceof CannotResolveClassException) {
    if (marshalling) {
      return new XStreamMarshallingFailureException((CannotResolveClassException)ex);
    }
 else {
      return new XStreamUnmarshallingFailureException((CannotResolveClassException)ex);
    }
  }
 else   if (ex instanceof ConversionException) {
    if (marshalling) {
      return new XStreamMarshallingFailureException((ConversionException)ex);
    }
 else {
      return new XStreamUnmarshallingFailureException((ConversionException)ex);
    }
  }
  return new XStreamSystemException("Unknown XStream exception: " + ex.getMessage(),ex);
}
