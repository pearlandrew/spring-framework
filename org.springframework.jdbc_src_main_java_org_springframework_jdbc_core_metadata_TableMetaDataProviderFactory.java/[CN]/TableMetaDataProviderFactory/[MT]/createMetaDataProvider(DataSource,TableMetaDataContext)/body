{
  try {
    return (TableMetaDataProvider)JdbcUtils.extractDatabaseMetaData(dataSource,new DatabaseMetaDataCallback(){
      public Object processMetaData(      DatabaseMetaData databaseMetaData) throws SQLException, MetaDataAccessException {
        String databaseProductName=JdbcUtils.commonDatabaseName(databaseMetaData.getDatabaseProductName());
        boolean accessTableColumnMetaData=context.isAccessTableParameterMetaData();
        TableMetaDataProvider provider;
        if ("HSQL Database Engine".equals(databaseProductName)) {
          provider=new HsqlTableMetaDataProvider(databaseMetaData);
        }
 else         if ("PostgreSQL".equals(databaseProductName)) {
          provider=new PostgresTableMetaDataProvider(databaseMetaData);
        }
 else         if ("Apache Derby".equals(databaseProductName)) {
          provider=new DerbyTableMetaDataProvider(databaseMetaData);
        }
 else {
          provider=new GenericTableMetaDataProvider(databaseMetaData);
        }
        if (logger.isDebugEnabled()) {
          logger.debug("Using " + provider.getClass().getName());
        }
        provider.initializeWithMetaData(databaseMetaData);
        if (accessTableColumnMetaData) {
          provider.initializeWithTableColumnMetaData(databaseMetaData,context.getCatalogName(),context.getSchemaName(),context.getTableName());
        }
        return provider;
      }
    }
);
  }
 catch (  MetaDataAccessException e) {
    throw new DataAccessResourceFailureException("Error retreiving database metadata",e);
  }
}
