{
  this.request=request;
  this.model=model;
  this.webApplicationContext=(WebApplicationContext)request.getAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE);
  if (this.webApplicationContext == null) {
    this.webApplicationContext=RequestContextUtils.getWebApplicationContext(request,servletContext);
  }
  LocaleResolver localeResolver=RequestContextUtils.getLocaleResolver(request);
  if (localeResolver != null) {
    this.locale=localeResolver.resolveLocale(request);
  }
 else {
    this.locale=getFallbackLocale();
  }
  this.defaultHtmlEscape=WebUtils.getDefaultHtmlEscape(this.webApplicationContext.getServletContext());
  this.urlPathHelper=new UrlPathHelper();
}
