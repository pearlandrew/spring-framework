{
  ScopeMetadata metadata=new ScopeMetadata();
  if (definition instanceof AnnotatedBeanDefinition) {
    AnnotatedBeanDefinition annDef=(AnnotatedBeanDefinition)definition;
    Map<String,Object> attributes=annDef.getMetadata().getAnnotationAttributes(this.scopeAnnotationType.getName());
    ScopedProxyMode annMode=null;
    if (attributes != null) {
      metadata.setScopeName((String)attributes.get("value"));
      annMode=(ScopedProxyMode)attributes.get("proxyMode");
    }
    if (annMode != null && annMode != ScopedProxyMode.DEFAULT) {
      metadata.setScopedProxyMode(annMode);
    }
 else     if (!metadata.getScopeName().equals(BeanDefinition.SCOPE_SINGLETON)) {
      metadata.setScopedProxyMode(this.defaultProxyMode);
    }
  }
  return metadata;
}
