{
  UserTransaction ut1=createMock(UserTransaction.class);
  UserTransaction ut2=createMock(UserTransaction.class);
  TransactionManager tm=createMock(TransactionManager.class);
  JtaTransactionManager jtam=new JtaTransactionManager();
  jtam.setUserTransaction(ut1);
  jtam.setTransactionManager(tm);
  jtam.setRollbackOnCommitFailure(true);
  jtam.afterPropertiesSet();
  SimpleNamingContextBuilder jndiEnv=SimpleNamingContextBuilder.emptyActivatedContextBuilder();
  jndiEnv.bind(JtaTransactionManager.DEFAULT_USER_TRANSACTION_NAME,ut2);
  JtaTransactionManager serializedJtatm=(JtaTransactionManager)SerializationTestUtils.serializeAndDeserialize(jtam);
  assertNotNull("Logger must survive serialization",serializedJtatm.logger);
  assertTrue("UserTransaction looked up on client",serializedJtatm.getUserTransaction() == ut2);
  assertNull("TransactionManager didn't survive",serializedJtatm.getTransactionManager());
  assertEquals(true,serializedJtatm.isRollbackOnCommitFailure());
}
