{
  BeanDefinition processorBeanDefinition=createScriptFactoryPostProcessor(true);
  BeanDefinition scriptedBeanDefinition=createScriptedGroovyBean();
  GenericApplicationContext ctx=new GenericApplicationContext();
  ctx.registerBeanDefinition(PROCESSOR_BEAN_NAME,processorBeanDefinition);
  ctx.registerBeanDefinition(MESSENGER_BEAN_NAME,scriptedBeanDefinition);
  ctx.refresh();
  Messenger messenger=(Messenger)ctx.getBean(MESSENGER_BEAN_NAME);
  assertEquals(MESSAGE_TEXT,messenger.getMessage());
  pauseToLetRefreshDelayKickIn(DEFAULT_SECONDS_TO_PAUSE);
  StaticScriptSource source=getScriptSource(ctx);
  source.setScript(CHANGED_SCRIPT);
  Messenger refreshedMessenger=(Messenger)ctx.getBean(MESSENGER_BEAN_NAME);
  assertEquals(EXPECTED_CHANGED_MESSAGE_TEXT,refreshedMessenger.getMessage());
}
