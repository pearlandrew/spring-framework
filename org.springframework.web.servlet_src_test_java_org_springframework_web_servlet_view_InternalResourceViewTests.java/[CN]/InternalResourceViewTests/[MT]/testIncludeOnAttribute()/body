{
  HashMap<String,Object> model=new HashMap<String,Object>();
  Object obj=new Integer(1);
  model.put("foo","bar");
  model.put("I",obj);
  String url="forward-to";
  HttpServletRequest request=createMock(HttpServletRequest.class);
  request.getAttribute(View.PATH_VARIABLES);
  expectLastCall().andReturn(null);
  Set<String> keys=model.keySet();
  for (Iterator<String> iter=keys.iterator(); iter.hasNext(); ) {
    String key=(String)iter.next();
    request.setAttribute(key,model.get(key));
    expectLastCall().times(1);
  }
  request.getAttribute(WebUtils.INCLUDE_REQUEST_URI_ATTRIBUTE);
  expectLastCall().andReturn("somepath");
  request.getRequestDispatcher(url);
  expectLastCall().andReturn(new MockRequestDispatcher(url));
  replay(request);
  MockHttpServletResponse response=new MockHttpServletResponse();
  InternalResourceView v=new InternalResourceView();
  v.setUrl(url);
  v.render(model,request,response);
  assertEquals(url,response.getIncludedUrl());
  verify(request);
}
