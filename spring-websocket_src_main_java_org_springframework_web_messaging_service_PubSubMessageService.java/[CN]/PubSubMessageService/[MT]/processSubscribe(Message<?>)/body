{
  if (logger.isDebugEnabled()) {
    logger.debug("Subscribe " + message);
  }
  PubSubHeaders headers=new PubSubHeaders(message.getHeaders(),true);
  final String subscriptionId=headers.getSubscriptionId();
  EventRegistration registration=getEventBus().registerConsumer(getPublishKey(headers.getDestination()),new EventConsumer<Message<?>>(){
    @Override public void accept(    Message<?> message){
      PubSubHeaders inHeaders=new PubSubHeaders(message.getHeaders(),true);
      PubSubHeaders outHeaders=new PubSubHeaders();
      outHeaders.setDestinations(inHeaders.getDestinations());
      outHeaders.setContentType(inHeaders.getContentType());
      outHeaders.setSubscriptionId(subscriptionId);
      Object payload=message.getPayload();
      message=new GenericMessage<Object>(payload,outHeaders.getMessageHeaders());
      getEventBus().send(AbstractMessageService.SERVER_TO_CLIENT_MESSAGE_KEY,message);
    }
  }
);
  addSubscription((String)message.getHeaders().get("sessionId"),registration);
}
