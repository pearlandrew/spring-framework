{
  if (ex instanceof MarshalException) {
    MarshalException marshalException=(MarshalException)ex;
    if (marshalling) {
      return new CastorMarshallingFailureException(marshalException);
    }
 else {
      return new CastorUnmarshallingFailureException(marshalException);
    }
  }
 else   if (ex instanceof ValidationException) {
    return new CastorValidationFailureException((ValidationException)ex);
  }
  return new CastorSystemException("Unknown Castor exception: " + ex.getMessage(),ex);
}
