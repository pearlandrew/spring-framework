{
  if (ConditionalAnnotationHelper.shouldSkip(beanMethod,this.registry,this.environment,this.importBeanNameGenerator)) {
    return;
  }
  ConfigurationClass configClass=beanMethod.getConfigurationClass();
  MethodMetadata metadata=beanMethod.getMetadata();
  RootBeanDefinition beanDef=new ConfigurationClassBeanDefinition(configClass);
  beanDef.setResource(configClass.getResource());
  beanDef.setSource(this.sourceExtractor.extractSource(metadata,configClass.getResource()));
  if (metadata.isStatic()) {
    beanDef.setBeanClassName(configClass.getMetadata().getClassName());
    beanDef.setFactoryMethodName(metadata.getMethodName());
  }
 else {
    beanDef.setFactoryBeanName(configClass.getBeanName());
    beanDef.setUniqueFactoryMethodName(metadata.getMethodName());
  }
  beanDef.setAutowireMode(RootBeanDefinition.AUTOWIRE_CONSTRUCTOR);
  beanDef.setAttribute(RequiredAnnotationBeanPostProcessor.SKIP_REQUIRED_CHECK_ATTRIBUTE,Boolean.TRUE);
  AnnotationAttributes role=attributesFor(metadata,Role.class);
  if (role != null) {
    beanDef.setRole(role.<Integer>getNumber("value"));
  }
  AnnotationAttributes bean=attributesFor(metadata,Bean.class);
  List<String> names=new ArrayList<String>(Arrays.asList(bean.getStringArray("name")));
  String beanName=(names.size() > 0 ? names.remove(0) : beanMethod.getMetadata().getMethodName());
  for (  String alias : names) {
    this.registry.registerAlias(beanName,alias);
  }
  if (this.registry.containsBeanDefinition(beanName)) {
    BeanDefinition existingBeanDef=registry.getBeanDefinition(beanName);
    if (!(existingBeanDef instanceof ConfigurationClassBeanDefinition)) {
      if (logger.isDebugEnabled()) {
        logger.debug(String.format("Skipping loading bean definition for %s: a definition for bean " + "'%s' already exists. This is likely due to an override in XML.",beanMethod,beanName));
      }
      return;
    }
  }
  if (metadata.isAnnotated(Primary.class.getName())) {
    beanDef.setPrimary(true);
  }
  if (metadata.isAnnotated(Lazy.class.getName())) {
    AnnotationAttributes lazy=attributesFor(metadata,Lazy.class);
    beanDef.setLazyInit(lazy.getBoolean("value"));
  }
 else   if (configClass.getMetadata().isAnnotated(Lazy.class.getName())) {
    AnnotationAttributes lazy=attributesFor(configClass.getMetadata(),Lazy.class);
    beanDef.setLazyInit(lazy.getBoolean("value"));
  }
  if (metadata.isAnnotated(DependsOn.class.getName())) {
    AnnotationAttributes dependsOn=attributesFor(metadata,DependsOn.class);
    String[] otherBeans=dependsOn.getStringArray("value");
    if (otherBeans.length > 0) {
      beanDef.setDependsOn(otherBeans);
    }
  }
  Autowire autowire=bean.getEnum("autowire");
  if (autowire.isAutowire()) {
    beanDef.setAutowireMode(autowire.value());
  }
  String initMethodName=bean.getString("initMethod");
  if (StringUtils.hasText(initMethodName)) {
    beanDef.setInitMethodName(initMethodName);
  }
  String destroyMethodName=bean.getString("destroyMethod");
  if (StringUtils.hasText(destroyMethodName)) {
    beanDef.setDestroyMethodName(destroyMethodName);
  }
  ScopedProxyMode proxyMode=ScopedProxyMode.NO;
  AnnotationAttributes scope=attributesFor(metadata,Scope.class);
  if (scope != null) {
    beanDef.setScope(scope.getString("value"));
    proxyMode=scope.getEnum("proxyMode");
    if (proxyMode == ScopedProxyMode.DEFAULT) {
      proxyMode=ScopedProxyMode.NO;
    }
  }
  BeanDefinition beanDefToRegister=beanDef;
  if (proxyMode != ScopedProxyMode.NO) {
    BeanDefinitionHolder proxyDef=ScopedProxyCreator.createScopedProxy(new BeanDefinitionHolder(beanDef,beanName),this.registry,proxyMode == ScopedProxyMode.TARGET_CLASS);
    beanDefToRegister=new ConfigurationClassBeanDefinition((RootBeanDefinition)proxyDef.getBeanDefinition(),configClass);
  }
  if (logger.isDebugEnabled()) {
    logger.debug(String.format("Registering bean definition for @Bean method %s.%s()",configClass.getMetadata().getClassName(),beanName));
  }
  registry.registerBeanDefinition(beanName,beanDefToRegister);
}
