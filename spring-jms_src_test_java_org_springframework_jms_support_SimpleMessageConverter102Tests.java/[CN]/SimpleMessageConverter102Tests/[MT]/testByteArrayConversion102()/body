{
  Session session=mock(Session.class);
  BytesMessage message=mock(BytesMessage.class);
  byte[] content=new byte[5000];
  new Random().nextBytes(content);
  final ByteArrayInputStream byteArrayInputStream=new ByteArrayInputStream(content);
  given(session.createBytesMessage()).willReturn(message);
  given(message.readBytes((byte[])anyObject())).willAnswer(new Answer<Integer>(){
    @Override public Integer answer(    InvocationOnMock invocation) throws Throwable {
      return byteArrayInputStream.read((byte[])invocation.getArguments()[0]);
    }
  }
);
  SimpleMessageConverter102 converter=new SimpleMessageConverter102();
  Message msg=converter.toMessage(content,session);
  assertThat((byte[])converter.fromMessage(msg),equalTo(content));
}
