{
  String targetUrl=createTargetUrl(model,request);
  if (getWebApplicationContext() != null) {
    RequestContext requestContext=createRequestContext(request,response,model);
    RequestDataValueProcessor processor=requestContext.getRequestDataValueProcessor();
    if (processor != null) {
      targetUrl=processor.processUrl(request,targetUrl);
    }
  }
  FlashMap flashMap=RequestContextUtils.getOutputFlashMap(request);
  if (!CollectionUtils.isEmpty(flashMap)) {
    UriComponents uriComponents=UriComponentsBuilder.fromUriString(targetUrl).build();
    flashMap.setTargetRequestPath(uriComponents.getPath());
    flashMap.addTargetRequestParams(uriComponents.getQueryParams());
  }
  sendRedirect(request,response,targetUrl.toString(),this.http10Compatible);
}
