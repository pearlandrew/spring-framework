{
  initDispatcherServlet(RequestResponseBodyController.class,new BeanDefinitionRegistrar(){
    public void register(    GenericWebApplicationContext wac){
      RootBeanDefinition adapterDef=new RootBeanDefinition(RequestMappingHandlerAdapter.class);
      List<HttpMessageConverter<?>> messageConverters=new ArrayList<HttpMessageConverter<?>>();
      messageConverters.add(new StringHttpMessageConverter());
      messageConverters.add(new SimpleMessageConverter(new MediaType("application","json"),MediaType.ALL));
      adapterDef.getPropertyValues().add("messageConverters",messageConverters);
      wac.registerBeanDefinition("handlerAdapter",adapterDef);
    }
  }
);
  MockHttpServletRequest request=new MockHttpServletRequest("PUT","/something");
  request.setContent("Hello World".getBytes("UTF-8"));
  request.addHeader("Content-Type","text/plain; charset=utf-8");
  request.addHeader("Accept","application/json, text/javascript, */*");
  MockHttpServletResponse response=new MockHttpServletResponse();
  servlet.service(request,response);
  assertEquals("Invalid content-type","application/json",response.getHeader("Content-Type"));
}
