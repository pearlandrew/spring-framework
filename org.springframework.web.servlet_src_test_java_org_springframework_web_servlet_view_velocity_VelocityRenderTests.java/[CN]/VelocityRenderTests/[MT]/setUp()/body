{
  wac=new StaticWebApplicationContext();
  wac.setServletContext(new MockServletContext());
  final Template expectedTemplate=new Template();
  VelocityConfig vc=new VelocityConfig(){
    public VelocityEngine getVelocityEngine(){
      return new TestVelocityEngine("test.vm",expectedTemplate);
    }
  }
;
  wac.getDefaultListableBeanFactory().registerSingleton("velocityConfigurer",vc);
  wac.refresh();
  request=new MockHttpServletRequest();
  request.setAttribute(DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE,wac);
  request.setAttribute(DispatcherServlet.LOCALE_RESOLVER_ATTRIBUTE,new AcceptHeaderLocaleResolver());
  request.setAttribute(DispatcherServlet.THEME_RESOLVER_ATTRIBUTE,new FixedThemeResolver());
  response=new MockHttpServletResponse();
}
