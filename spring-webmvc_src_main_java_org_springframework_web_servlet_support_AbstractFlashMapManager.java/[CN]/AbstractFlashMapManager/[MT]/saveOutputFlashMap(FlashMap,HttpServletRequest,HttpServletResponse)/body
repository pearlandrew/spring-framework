{
  if (CollectionUtils.isEmpty(flashMap)) {
    return;
  }
  String path=decodeAndNormalizePath(flashMap.getTargetRequestPath(),request);
  flashMap.setTargetRequestPath(path);
  flashMap.startExpirationPeriod(this.flashMapTimeout);
  if (logger.isDebugEnabled()) {
    logger.debug("Saving FlashMap=" + flashMap);
  }
synchronized (writeLock) {
    List<FlashMap> allMaps=retrieveFlashMaps(request);
    allMaps=(allMaps == null) ? new CopyOnWriteArrayList<FlashMap>() : allMaps;
    allMaps.add(flashMap);
    updateFlashMaps(allMaps,request,response);
  }
}
