{
  List<FlashMap> maps=retrieveFlashMaps(request);
  if (CollectionUtils.isEmpty(maps)) {
    return null;
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Retrieved FlashMap(s): " + maps);
  }
  List<FlashMap> mapsToRemove=getExpiredFlashMaps(maps);
  FlashMap match=getMatchingFlashMap(maps,request);
  if (match != null) {
    mapsToRemove.add(match);
  }
  if (!mapsToRemove.isEmpty()) {
    if (logger.isDebugEnabled()) {
      logger.debug("Removing FlashMap(s): " + mapsToRemove);
    }
synchronized (writeLock) {
      maps=retrieveFlashMaps(request);
      maps.removeAll(mapsToRemove);
      updateFlashMaps(maps,request,response);
    }
  }
  return match;
}
