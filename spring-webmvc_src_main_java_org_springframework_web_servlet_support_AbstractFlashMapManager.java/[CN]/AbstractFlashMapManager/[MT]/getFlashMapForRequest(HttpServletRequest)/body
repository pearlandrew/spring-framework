{
  List<FlashMap> flashMaps=retrieveFlashMaps(request);
  if (CollectionUtils.isEmpty(flashMaps)) {
    return null;
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Retrieved FlashMap(s): " + flashMaps);
  }
  List<FlashMap> result=new ArrayList<FlashMap>();
  for (  FlashMap flashMap : flashMaps) {
    if (isFlashMapForRequest(flashMap,request)) {
      result.add(flashMap);
    }
  }
  if (!result.isEmpty()) {
    Collections.sort(result);
    if (logger.isDebugEnabled()) {
      logger.debug("Found matching FlashMap(s): " + result);
    }
    FlashMap match=result.remove(0);
    flashMaps.remove(match);
    return Collections.unmodifiableMap(match);
  }
  return null;
}
