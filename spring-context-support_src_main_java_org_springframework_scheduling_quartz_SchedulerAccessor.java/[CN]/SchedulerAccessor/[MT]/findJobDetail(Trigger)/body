{
  if (trigger instanceof JobDetailAwareTrigger) {
    return ((JobDetailAwareTrigger)trigger).getJobDetail();
  }
 else {
    try {
      Map jobDataMap=(Map)ReflectionUtils.invokeMethod(Trigger.class.getMethod("getJobDataMap"),trigger);
      return (JobDetail)jobDataMap.remove(JobDetailAwareTrigger.JOB_DETAIL_KEY);
    }
 catch (    NoSuchMethodException ex) {
      throw new IllegalStateException("Inconsistent Quartz API: " + ex);
    }
  }
}
