{
  HttpInputMessage inputMessage=new ServletServerHttpRequest(webRequest.getRequest());
  List<MediaType> acceptedMediaTypes=inputMessage.getHeaders().getAccept();
  if (acceptedMediaTypes.isEmpty()) {
    acceptedMediaTypes=Collections.singletonList(MediaType.ALL);
  }
 else {
    Collections.sort(acceptedMediaTypes);
  }
  HttpOutputMessage outputMessage=new ServletServerHttpResponse(webRequest.getResponse());
  Class<?> returnValueType=returnValue.getClass();
  List<MediaType> allSupportedMediaTypes=new ArrayList<MediaType>();
  if (messageConverters != null) {
    for (    HttpMessageConverter messageConverter : messageConverters) {
      allSupportedMediaTypes.addAll(messageConverter.getSupportedMediaTypes());
      for (      MediaType acceptedMediaType : acceptedMediaTypes) {
        if (messageConverter.canWrite(returnValueType,acceptedMediaType)) {
          messageConverter.write(returnValue,acceptedMediaType,outputMessage);
          this.responseArgumentUsed=true;
          return;
        }
      }
    }
  }
  throw new HttpMediaTypeNotAcceptableException(allSupportedMediaTypes);
}
