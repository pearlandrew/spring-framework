{
  Principal userPrincipal=request.getUserPrincipal();
  if (userPrincipal != null) {
    return userPrincipal.getName();
  }
  String userName=request.getRemoteUser();
  if (userName != null) {
    return userName;
  }
  Map userInfo=(Map)request.getAttribute(PortletRequest.USER_INFO);
  if (userInfo != null) {
    for (int i=0, n=this.userinfoUsernameAttributes.length; i < n; i++) {
      userName=(String)userInfo.get(this.userinfoUsernameAttributes[i]);
      if (userName != null) {
        return userName;
      }
    }
  }
  return null;
}
