{
  String destination=getDestination(message);
  if (destination == null) {
    logger.trace("Ignoring message, no destination");
    return;
  }
  String lookupDestination=getLookupDestination(destination);
  if (lookupDestination == null) {
    if (logger.isTraceEnabled()) {
      logger.trace("Ignoring message to destination=" + destination);
    }
    return;
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Handling message, lookupDestination=" + lookupDestination);
  }
  MessageHeaderAccessor headerAccessor=MessageHeaderAccessor.getMutableAccessor(message);
  headerAccessor.setHeader(DestinationPatternsMessageCondition.LOOKUP_DESTINATION_HEADER,lookupDestination);
  message=MessageBuilder.createMessage(message.getPayload(),headerAccessor.getMessageHeaders());
  handleMessageInternal(message,lookupDestination);
}
