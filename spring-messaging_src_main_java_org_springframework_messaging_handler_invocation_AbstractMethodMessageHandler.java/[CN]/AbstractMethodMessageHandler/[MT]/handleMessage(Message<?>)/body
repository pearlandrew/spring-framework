{
  String destination=getDestination(message);
  if (destination == null) {
    return;
  }
  String lookupDestination=getLookupDestination(destination);
  if (lookupDestination == null) {
    return;
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Handling message to " + destination);
  }
  MessageHeaderAccessor headerAccessor=MessageHeaderAccessor.getMutableAccessor(message);
  headerAccessor.setHeader(DestinationPatternsMessageCondition.LOOKUP_DESTINATION_HEADER,lookupDestination);
  headerAccessor.setLeaveMutable(true);
  message=MessageBuilder.createMessage(message.getPayload(),headerAccessor.getMessageHeaders());
  handleMessageInternal(message,lookupDestination);
  headerAccessor.setImmutable();
}
