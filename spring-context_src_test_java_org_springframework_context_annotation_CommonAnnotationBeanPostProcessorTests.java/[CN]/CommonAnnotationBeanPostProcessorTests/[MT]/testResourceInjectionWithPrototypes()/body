{
  DefaultListableBeanFactory bf=new DefaultListableBeanFactory();
  CommonAnnotationBeanPostProcessor bpp=new CommonAnnotationBeanPostProcessor();
  bpp.setResourceFactory(bf);
  bf.addBeanPostProcessor(bpp);
  bf.registerBeanDefinition("annotatedBean",new RootBeanDefinition(ResourceInjectionBean.class,false));
  bf.registerBeanDefinition("testBean",new RootBeanDefinition(TestBean.class,false));
  bf.registerBeanDefinition("testBean2",new RootBeanDefinition(TestBean.class,false));
  ResourceInjectionBean bean=(ResourceInjectionBean)bf.getBean("annotatedBean");
  assertTrue(bean.initCalled);
  assertTrue(bean.init2Called);
  assertTrue(bean.init3Called);
  TestBean tb=bean.getTestBean();
  TestBean tb2=bean.getTestBean2();
  assertNotNull(tb);
  assertNotNull(tb2);
  ResourceInjectionBean anotherBean=(ResourceInjectionBean)bf.getBean("annotatedBean");
  assertNotSame(anotherBean,bean);
  assertNotSame(anotherBean.getTestBean(),tb);
  assertNotSame(anotherBean.getTestBean2(),tb2);
  bf.destroyBean("annotatedBean",bean);
  assertTrue(bean.destroyCalled);
  assertTrue(bean.destroy2Called);
  assertTrue(bean.destroy3Called);
}
