{
  JmsTemplate template=createTemplate();
  template.setConnectionFactory(mockConnectionFactory);
  template.setMessageIdEnabled(false);
  template.setMessageTimestampEnabled(false);
  MockControl messageProducerControl=MockControl.createControl(MessageProducer.class);
  MessageProducer mockMessageProducer=(MessageProducer)messageProducerControl.getMock();
  mockSession.createProducer(null);
  sessionControl.setReturnValue(mockMessageProducer);
  mockMessageProducer.setDisableMessageID(true);
  messageProducerControl.setVoidCallable(1);
  mockMessageProducer.setDisableMessageTimestamp(true);
  messageProducerControl.setVoidCallable(1);
  mockMessageProducer.getPriority();
  messageProducerControl.setReturnValue(4);
  mockMessageProducer.close();
  messageProducerControl.setVoidCallable(1);
  mockSession.close();
  sessionControl.setVoidCallable(1);
  mockConnection.close();
  connectionControl.setVoidCallable(1);
  messageProducerControl.replay();
  sessionControl.replay();
  connectionControl.replay();
  template.execute(new ProducerCallback(){
    @Override public Object doInJms(    Session session,    MessageProducer producer) throws JMSException {
      session.getTransacted();
      producer.getPriority();
      return null;
    }
  }
);
  connectionFactoryControl.verify();
  connectionControl.verify();
  sessionControl.verify();
}
