{
  MockControl sfControl=MockControl.createControl(SessionFactoryImplementor.class);
  final SessionFactoryImplementor sf=(SessionFactoryImplementor)sfControl.getMock();
  MockControl sessionControl=MockControl.createControl(Session.class);
  Session session=(Session)sessionControl.getMock();
  MockControl tmControl=MockControl.createControl(TransactionManager.class);
  TransactionManager tm=(TransactionManager)tmControl.getMock();
  tm.getTransaction();
  tmControl.setReturnValue(null,2);
  OpenSessionInViewInterceptor interceptor=new OpenSessionInViewInterceptor();
  interceptor.setSessionFactory(sf);
  MockServletContext sc=new MockServletContext();
  MockHttpServletRequest request=new MockHttpServletRequest(sc);
  MockHttpServletResponse response=new MockHttpServletResponse();
  sf.getTransactionManager();
  sfControl.setReturnValue(tm,2);
  sf.openSession();
  sfControl.setReturnValue(session,1);
  session.isOpen();
  sessionControl.setReturnValue(true,1);
  session.setFlushMode(FlushMode.MANUAL);
  sessionControl.setVoidCallable(1);
  tmControl.replay();
  sfControl.replay();
  sessionControl.replay();
  interceptor.preHandle(new ServletWebRequest(request));
  assertTrue(TransactionSynchronizationManager.hasResource(sf));
  interceptor.preHandle(new ServletWebRequest(request));
  assertEquals(session,SessionFactoryUtils.getSession(sf,false));
  interceptor.preHandle(new ServletWebRequest(request));
  interceptor.postHandle(new ServletWebRequest(request),null);
  interceptor.afterCompletion(new ServletWebRequest(request),null);
  interceptor.postHandle(new ServletWebRequest(request),null);
  interceptor.afterCompletion(new ServletWebRequest(request),null);
  interceptor.preHandle(new ServletWebRequest(request));
  interceptor.postHandle(new ServletWebRequest(request),null);
  interceptor.afterCompletion(new ServletWebRequest(request),null);
  sfControl.verify();
  sessionControl.verify();
  sfControl.reset();
  sessionControl.reset();
  sfControl.replay();
  sessionControl.replay();
  interceptor.postHandle(new ServletWebRequest(request),null);
  assertTrue(TransactionSynchronizationManager.hasResource(sf));
  sfControl.verify();
  sessionControl.verify();
  sfControl.reset();
  sessionControl.reset();
  session.close();
  sessionControl.setReturnValue(null,1);
  sfControl.replay();
  sessionControl.replay();
  interceptor.afterCompletion(new ServletWebRequest(request),null);
  assertFalse(TransactionSynchronizationManager.hasResource(sf));
  sfControl.verify();
  sessionControl.verify();
}
