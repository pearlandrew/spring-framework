{
  SessionFactory sf=mock(SessionFactory.class);
  Session session=mock(Session.class);
  OpenSessionInViewInterceptor interceptor=new OpenSessionInViewInterceptor();
  interceptor.setSessionFactory(sf);
  interceptor.setSingleSession(false);
  given(sf.openSession()).willReturn(session);
  given(session.getSessionFactory()).willReturn(sf);
  interceptor.preHandle(this.webRequest);
  org.hibernate.Session sess=SessionFactoryUtils.getSession(sf,true);
  SessionFactoryUtils.releaseSession(sess,sf);
  interceptor.preHandle(this.webRequest);
  interceptor.preHandle(this.webRequest);
  interceptor.postHandle(this.webRequest,null);
  interceptor.afterCompletion(this.webRequest,null);
  interceptor.postHandle(this.webRequest,null);
  interceptor.afterCompletion(this.webRequest,null);
  interceptor.preHandle(this.webRequest);
  interceptor.postHandle(this.webRequest,null);
  interceptor.afterCompletion(this.webRequest,null);
  interceptor.postHandle(this.webRequest,null);
  interceptor.afterCompletion(this.webRequest,null);
  verify(session).setFlushMode(FlushMode.MANUAL);
  verify(session).close();
}
