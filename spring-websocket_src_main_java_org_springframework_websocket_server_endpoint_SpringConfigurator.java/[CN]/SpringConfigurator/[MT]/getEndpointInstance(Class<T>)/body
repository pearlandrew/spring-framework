{
  WebApplicationContext wac=ContextLoader.getCurrentWebApplicationContext();
  if (wac == null) {
    throw new IllegalStateException("Failed to find WebApplicationContext. " + "Was org.springframework.web.context.ContextLoader used to load the WebApplicationContext?");
  }
  Map<String,T> beans=wac.getBeansOfType(endpointClass);
  if (beans.isEmpty()) {
    return wac.getAutowireCapableBeanFactory().createBean(endpointClass);
  }
  if (beans.size() == 1) {
    return beans.values().iterator().next();
  }
 else {
    throw new IllegalStateException("Found more than one matching beans of type " + endpointClass);
  }
}
