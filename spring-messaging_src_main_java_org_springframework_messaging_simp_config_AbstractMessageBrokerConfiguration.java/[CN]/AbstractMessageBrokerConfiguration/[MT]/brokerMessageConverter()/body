{
  List<MessageConverter> converters=new ArrayList<MessageConverter>();
  boolean registerDefaults=configureMessageConverters(converters);
  if (registerDefaults) {
    if (jackson2Present) {
      converters.add(new MappingJackson2MessageConverter());
    }
    converters.add(new StringMessageConverter());
    converters.add(new ByteArrayMessageConverter());
  }
  ContentTypeResolver contentTypeResolver=getContentTypeResolver();
  if (contentTypeResolver == null) {
    contentTypeResolver=new DefaultContentTypeResolver();
    if (jackson2Present && registerDefaults) {
      ((DefaultContentTypeResolver)contentTypeResolver).setDefaultMimeType(MimeTypeUtils.APPLICATION_JSON);
    }
  }
  return new CompositeMessageConverter(converters,contentTypeResolver);
}
