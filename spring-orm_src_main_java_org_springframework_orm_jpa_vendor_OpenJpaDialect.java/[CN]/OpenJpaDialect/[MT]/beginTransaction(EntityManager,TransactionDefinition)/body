{
  OpenJPAEntityManager openJpaEntityManager=getOpenJPAEntityManager(entityManager);
  if (definition.getIsolationLevel() != TransactionDefinition.ISOLATION_DEFAULT) {
    FetchPlan fetchPlan=openJpaEntityManager.getFetchPlan();
    if (fetchPlan instanceof JDBCFetchPlan) {
      IsolationLevel isolation=IsolationLevel.fromConnectionConstant(definition.getIsolationLevel());
      ((JDBCFetchPlan)fetchPlan).setIsolation(isolation);
    }
  }
  entityManager.getTransaction().begin();
  if (!definition.isReadOnly()) {
    openJpaEntityManager.beginStore();
  }
  return new OpenJpaTransactionData(openJpaEntityManager);
}
