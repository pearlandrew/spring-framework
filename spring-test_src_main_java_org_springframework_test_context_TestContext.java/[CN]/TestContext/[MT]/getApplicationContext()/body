{
synchronized (contextCache) {
    ApplicationContext context=contextCache.get(mergedContextConfiguration);
    if (context == null) {
      try {
        context=loadApplicationContext();
        if (logger.isDebugEnabled()) {
          logger.debug(String.format("Storing ApplicationContext for test class [%s] in cache under key [%s].",testClass,mergedContextConfiguration));
        }
        contextCache.put(mergedContextConfiguration,context);
      }
 catch (      Exception ex) {
        throw new IllegalStateException("Failed to load ApplicationContext",ex);
      }
    }
 else {
      if (logger.isDebugEnabled()) {
        logger.debug(String.format("Retrieved ApplicationContext for test class [%s] from cache with key [%s].",testClass,mergedContextConfiguration));
      }
    }
    return context;
  }
}
