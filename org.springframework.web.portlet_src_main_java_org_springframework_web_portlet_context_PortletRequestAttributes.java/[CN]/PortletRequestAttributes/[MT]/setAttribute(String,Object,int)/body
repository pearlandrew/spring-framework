{
  if (scope == SCOPE_REQUEST) {
    if (!isRequestActive()) {
      throw new IllegalStateException("Cannot set request attribute - request is not active anymore!");
    }
    this.request.setAttribute(name,value);
  }
 else {
    PortletSession session=getSession(true);
    if (scope == SCOPE_GLOBAL_SESSION) {
      session.setAttribute(name,value,PortletSession.APPLICATION_SCOPE);
synchronized (this.globalSessionAttributesToUpdate) {
        this.globalSessionAttributesToUpdate.remove(name);
      }
    }
 else {
      session.setAttribute(name,value);
synchronized (this.sessionAttributesToUpdate) {
        this.sessionAttributesToUpdate.remove(name);
      }
    }
  }
}
