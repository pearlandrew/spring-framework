{
  WebApplicationContext webApplicationContext=(WebApplicationContext)context.getRequestScope().get(DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE);
  if (webApplicationContext == null) {
    if (!(context instanceof ServletTilesRequestContext)) {
      throw new IllegalStateException(getClass().getSimpleName() + " requires a ServletTilesRequestContext to operate on");
    }
    ServletTilesRequestContext servletRequestContext=(ServletTilesRequestContext)context;
    webApplicationContext=WebApplicationContextUtils.getRequiredWebApplicationContext(servletRequestContext.getServletContext());
  }
  return getPreparer(name,webApplicationContext);
}
