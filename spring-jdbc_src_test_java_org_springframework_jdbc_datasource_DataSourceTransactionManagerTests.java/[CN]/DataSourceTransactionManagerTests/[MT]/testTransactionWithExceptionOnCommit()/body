{
  willThrow(new SQLException("Cannot commit")).given(con).commit();
  TransactionTemplate tt=new TransactionTemplate(tm);
  try {
    tt.execute(new TransactionCallbackWithoutResult(){
      @Override protected void doInTransactionWithoutResult(      TransactionStatus status){
      }
    }
);
    fail("Should have thrown TransactionSystemException");
  }
 catch (  TransactionSystemException ex) {
  }
  assertTrue("Hasn't thread connection",!TransactionSynchronizationManager.hasResource(ds));
  verify(con).close();
}
