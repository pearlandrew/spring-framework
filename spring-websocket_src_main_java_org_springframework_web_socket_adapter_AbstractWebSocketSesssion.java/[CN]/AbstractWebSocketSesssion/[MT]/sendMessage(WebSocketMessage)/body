{
  checkDelegateSessionInitialized();
  Assert.isTrue(isOpen(),"Cannot send message after connection closed.");
  if (logger.isTraceEnabled()) {
    logger.trace("Sending " + message + ", "+ this);
  }
  if (message instanceof TextMessage) {
    sendTextMessage((TextMessage)message);
  }
 else   if (message instanceof BinaryMessage) {
    sendBinaryMessage((BinaryMessage)message);
  }
 else {
    throw new IllegalStateException("Unexpected WebSocketMessage type: " + message);
  }
}
