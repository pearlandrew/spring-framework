{
  SpelExpressionParser parser=new SpelExpressionParser();
  Expression expr=parser.parseExpression("throwException(#bar)");
  StandardEvaluationContext eContext=TestScenarioCreator.getTestEvaluationContext();
  eContext.setVariable("bar",3);
  Object o=expr.getValue(eContext);
  Assert.assertEquals(o,3);
  Assert.assertEquals(1,parser.parseExpression("counter").getValue(eContext));
  eContext.setVariable("bar",new PlaceOfBirth("London"));
  o=expr.getValue(eContext);
  Assert.assertEquals("London",o);
  eContext.setVariable("bar",3);
  o=expr.getValue(eContext);
  Assert.assertEquals(3,o);
  Assert.assertEquals(2,parser.parseExpression("counter").getValue(eContext));
  eContext.setVariable("bar",1);
  try {
    o=expr.getValue(eContext);
    Assert.fail();
  }
 catch (  Exception e) {
    if (e instanceof SpelEvaluationException) {
      e.printStackTrace();
      Assert.fail("Should not be a SpelEvaluationException");
    }
  }
  Assert.assertEquals(3,parser.parseExpression("counter").getValue(eContext));
  eContext.setVariable("bar",4);
  try {
    o=expr.getValue(eContext);
    Assert.fail();
  }
 catch (  Exception e) {
    if (!(e instanceof ExpressionInvocationTargetException)) {
      e.printStackTrace();
      Assert.fail("Should have been wrapped");
    }
  }
  Assert.assertEquals(4,parser.parseExpression("counter").getValue(eContext));
}
