{
  if (logger.isDebugEnabled()) {
    logger.debug("Subscribe " + message);
  }
  PubSubHeaders headers=PubSubHeaders.fromMessageHeaders(message.getHeaders());
  String subscriptionId=headers.getSubscriptionId();
  BroadcastingConsumer consumer=new BroadcastingConsumer(subscriptionId);
  String key=getPublishKey(headers.getDestination());
  Registration<?> registration=this.reactor.on(new ObjectSelector<String>(key),consumer);
  String sessionId=headers.getSessionId();
  List<Registration<?>> list=this.subscriptionsBySession.get(sessionId);
  if (list == null) {
    list=new ArrayList<Registration<?>>();
    this.subscriptionsBySession.put(sessionId,list);
  }
  list.add(registration);
}
