{
  String acceptEncoding=request.getHeader("Accept-Encoding");
  boolean isGzipEligible=resource.getContentLength() >= this.minGzipSize && resource.getContentLength() <= this.maxGzipSize;
  if (this.gzipEnabled && isGzipEligible && StringUtils.hasText(acceptEncoding)&& acceptEncoding.indexOf("gzip") > -1 && response.getContentType().startsWith("text/")) {
    return new GZIPResponseStream(response);
  }
 else {
    return response.getOutputStream();
  }
}
