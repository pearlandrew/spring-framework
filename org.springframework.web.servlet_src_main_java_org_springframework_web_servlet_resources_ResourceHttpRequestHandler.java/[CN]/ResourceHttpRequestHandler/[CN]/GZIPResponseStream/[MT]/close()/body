{
  if (closed) {
    throw new IOException("This output stream has already been closed");
  }
  gzipStream.finish();
  byte[] bytes=byteStream.toByteArray();
  response.setContentLength(bytes.length);
  response.addHeader("Content-Encoding","gzip");
  servletStream.write(bytes);
  servletStream.flush();
  servletStream.close();
  closed=true;
}
