{
  WebSocketHandler handler=decorateWebSocketHandler(subProtocolWebSocketHandler());
  WebMvcStompEndpointRegistry registry=new WebMvcStompEndpointRegistry(handler,getTransportRegistration(),userSessionRegistry(),messageBrokerTaskScheduler());
  registry.setApplicationContext(getApplicationContext());
  registerStompEndpoints(registry);
  return registry.getHandlerMapping();
}
