{
  WebSocketHandler webSocketHandler=subProtocolWebSocketHandler();
  UserSessionRegistry sessionRegistry=userSessionRegistry();
  WebSocketTransportRegistration transportRegistration=getTransportRegistration();
  ThreadPoolTaskScheduler taskScheduler=messageBrokerSockJsTaskScheduler();
  MessageBrokerRegistry brokerRegistry=getBrokerRegistry();
  WebMvcStompEndpointRegistry registry=new WebMvcStompEndpointRegistry(webSocketHandler,transportRegistration,sessionRegistry,taskScheduler,brokerRegistry);
  registerStompEndpoints(registry);
  return registry.getHandlerMapping();
}
