{
  WebSocketHandler webSocketHandler=subProtocolWebSocketHandler();
  UserSessionRegistry sessionRegistry=userSessionRegistry();
  WebSocketTransportRegistration transportRegistration=getTransportRegistration();
  ThreadPoolTaskScheduler taskScheduler=messageBrokerSockJsTaskScheduler();
  WebMvcStompEndpointRegistry registry=new WebMvcStompEndpointRegistry(webSocketHandler,transportRegistration,sessionRegistry,taskScheduler);
  registry.setApplicationContext(getApplicationContext());
  registerStompEndpoints(registry);
  return registry.getHandlerMapping();
}
