{
  WebSocketHandler handler=decorateWebSocketHandler(subProtocolWebSocketHandler());
  WebSocketTransportRegistration transport=getTransportRegistration();
  ThreadPoolTaskScheduler scheduler=messageBrokerTaskScheduler();
  WebMvcStompEndpointRegistry registry=new WebMvcStompEndpointRegistry(handler,transport,scheduler);
  registry.setApplicationContext(getApplicationContext());
  registerStompEndpoints(registry);
  return registry.getHandlerMapping();
}
