{
  WebSocketHandler handler=subProtocolWebSocketHandler();
  handler=decorateWebSocketHandler(handler);
  WebMvcStompEndpointRegistry registry=new WebMvcStompEndpointRegistry(handler,getTransportRegistration(),userSessionRegistry(),messageBrokerSockJsTaskScheduler());
  registry.setApplicationContext(getApplicationContext());
  registerStompEndpoints(registry);
  return registry.getHandlerMapping();
}
