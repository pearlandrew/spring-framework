{
  final RemoteException rex=new RemoteException();
  final String jndiName="foo";
  MockControl ec=MockControl.createControl(MyEjb.class);
  MyEjb myEjb=(MyEjb)ec.getMock();
  myEjb.getValue();
  ec.setThrowable(rex);
  myEjb.remove();
  ec.setVoidCallable(1);
  ec.replay();
  MockControl mc=MockControl.createControl(MyHome.class);
  final MyHome home=(MyHome)mc.getMock();
  home.create();
  mc.setReturnValue(myEjb,1);
  mc.replay();
  JndiTemplate jt=new JndiTemplate(){
    public Object lookup(    String name){
      assertTrue(name.equals("java:comp/env/" + jndiName));
      return home;
    }
  }
;
  SimpleRemoteStatelessSessionProxyFactoryBean fb=new SimpleRemoteStatelessSessionProxyFactoryBean();
  fb.setJndiName(jndiName);
  fb.setResourceRef(true);
  fb.setBusinessInterface(MyBusinessMethods.class);
  fb.setJndiTemplate(jt);
  fb.afterPropertiesSet();
  MyBusinessMethods mbm=(MyBusinessMethods)fb.getObject();
  assertTrue(Proxy.isProxyClass(mbm.getClass()));
  try {
    mbm.getValue();
    fail("Should've thrown remote exception");
  }
 catch (  RemoteException ex) {
    assertSame("Threw expected RemoteException",rex,ex);
  }
  mc.verify();
  ec.verify();
}
