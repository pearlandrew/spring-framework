{
  if (beanFactory instanceof ListableBeanFactory) {
    ListableBeanFactory lbf=(ListableBeanFactory)beanFactory;
    Map<String,Object> annotatedEndpoints=lbf.getBeansWithAnnotation(ServerEndpoint.class);
    for (    String beanName : annotatedEndpoints.keySet()) {
      Class<?> beanType=lbf.getType(beanName);
      try {
        if (logger.isInfoEnabled()) {
          logger.info("Detected @ServerEndpoint bean '" + beanName + "', registering it as an endpoint by type");
        }
        ServerContainerProvider.getServerContainer().addEndpoint(beanType);
      }
 catch (      DeploymentException e) {
        throw new IllegalStateException("Failed to register @ServerEndpoint bean type " + beanName,e);
      }
    }
  }
}
