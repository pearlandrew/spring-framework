{
  TestBean t=new TestBean();
  String newName="tony";
  String invalidTouchy=".valid";
  try {
    BeanWrapper bw=new BeanWrapperImpl(t);
    MutablePropertyValues pvs=new MutablePropertyValues();
    pvs.addPropertyValue(new PropertyValue("age","foobar"));
    pvs.addPropertyValue(new PropertyValue("name",newName));
    pvs.addPropertyValue(new PropertyValue("touchy",invalidTouchy));
    bw.setPropertyValues(pvs);
    fail("Should throw exception when everything is valid");
  }
 catch (  PropertyBatchUpdateException ex) {
    assertTrue("Must contain 2 exceptions",ex.getExceptionCount() == 2);
    assertTrue("Validly set property must stick",t.getName().equals(newName));
    assertTrue("Invalidly set property must retain old value",t.getAge() == 0);
    assertTrue("New value of dodgy setter must be available through exception",ex.getPropertyAccessException("touchy").getPropertyChangeEvent().getNewValue().equals(invalidTouchy));
  }
}
