{
synchronized (this.scriptBeanFactory) {
    if (!this.scriptBeanFactory.containsBeanDefinition(scriptedObjectBeanName)) {
      this.scriptBeanFactory.registerBeanDefinition(scriptFactoryBeanName,createScriptFactoryBeanDefinition(bd));
      ScriptFactory scriptFactory=(ScriptFactory)this.scriptBeanFactory.getBean(scriptFactoryBeanName,ScriptFactory.class);
      ScriptSource scriptSource=getScriptSource(scriptFactoryBeanName,scriptFactory.getScriptSourceLocator());
      Class[] interfaces=scriptFactory.getScriptInterfaces();
      Class[] scriptedInterfaces=interfaces;
      if (scriptFactory.requiresConfigInterface() && !bd.getPropertyValues().isEmpty()) {
        Class configInterface=createConfigInterface(bd,interfaces);
        scriptedInterfaces=(Class[])ObjectUtils.addObjectToArray(interfaces,configInterface);
      }
      BeanDefinition objectBd=createScriptedObjectBeanDefinition(bd,scriptFactoryBeanName,scriptSource,scriptedInterfaces);
      long refreshCheckDelay=resolveRefreshCheckDelay(bd);
      if (refreshCheckDelay >= 0) {
        objectBd.setScope(BeanDefinition.SCOPE_PROTOTYPE);
      }
      this.scriptBeanFactory.registerBeanDefinition(scriptedObjectBeanName,objectBd);
    }
  }
}
