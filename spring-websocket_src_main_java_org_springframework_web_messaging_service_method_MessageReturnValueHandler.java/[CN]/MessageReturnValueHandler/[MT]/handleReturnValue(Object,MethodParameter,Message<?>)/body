{
  Assert.notNull(this.clientChannel,"No clientChannel to send messages to");
  Message<?> returnMessage=(Message<?>)returnValue;
  if (message == null) {
    return;
  }
  PubSubHeaderAccesssor headers=PubSubHeaderAccesssor.wrap(message);
  Assert.notNull(headers.getSubscriptionId(),"No subscription id: " + message);
  PubSubHeaderAccesssor returnHeaders=PubSubHeaderAccesssor.wrap(returnMessage);
  returnHeaders.setSessionId(headers.getSessionId());
  returnHeaders.setSubscriptionId(headers.getSubscriptionId());
  if (returnHeaders.getDestination() == null) {
    returnHeaders.setDestination(headers.getDestination());
  }
  returnMessage=MessageBuilder.withPayload(returnMessage.getPayload()).copyHeaders(returnHeaders.toHeaders()).build();
  this.clientChannel.send(returnMessage);
}
