{
  final String[] sql={"UPDATE NOSUCHTABLE SET DATE_DISPATCHED = SYSDATE WHERE ID = 1","SELECT * FROM NOSUCHTABLE"};
  MockControl ctrlStatement=MockControl.createControl(Statement.class);
  Statement mockStatement=(Statement)ctrlStatement.getMock();
  mockStatement.getConnection();
  ctrlStatement.setReturnValue(mockConnection);
  mockStatement.execute(sql[0]);
  ctrlStatement.setReturnValue(false);
  mockStatement.getUpdateCount();
  ctrlStatement.setReturnValue(1);
  mockStatement.execute(sql[1]);
  ctrlStatement.setReturnValue(true);
  mockStatement.close();
  ctrlStatement.setVoidCallable();
  MockControl ctrlDatabaseMetaData=MockControl.createControl(DatabaseMetaData.class);
  DatabaseMetaData mockDatabaseMetaData=(DatabaseMetaData)ctrlDatabaseMetaData.getMock();
  mockDatabaseMetaData.getDatabaseProductName();
  ctrlDatabaseMetaData.setReturnValue("MySQL");
  mockDatabaseMetaData.supportsBatchUpdates();
  ctrlDatabaseMetaData.setReturnValue(false);
  mockConnection.getMetaData();
  ctrlConnection.setReturnValue(mockDatabaseMetaData,2);
  mockConnection.createStatement();
  ctrlConnection.setReturnValue(mockStatement);
  ctrlStatement.replay();
  ctrlDatabaseMetaData.replay();
  replay();
  JdbcTemplate template=new JdbcTemplate(mockDataSource,false);
  try {
    template.batchUpdate(sql);
    fail("Shouldn't have executed batch statement with a select");
  }
 catch (  DataAccessException ex) {
    assertTrue("Check exception type",ex.getClass() == InvalidDataAccessApiUsageException.class);
  }
  ctrlStatement.verify();
  ctrlDatabaseMetaData.verify();
}
