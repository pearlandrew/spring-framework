{
  MapEntryConverter entryConverter=this.entryConverter;
  if (entryConverter == MapEntryConverter.NO_OP_INSTANCE) {
    Class<?> targetKeyType=targetType.getMapKeyType();
    Class<?> targetValueType=targetType.getMapValueType();
    if (targetKeyType != null && targetValueType != null) {
      ConversionExecutor keyConverter=null;
      ConversionExecutor valueConverter=null;
      Iterator<?> it=map.entrySet().iterator();
      while (it.hasNext()) {
        Map.Entry<?,?> entry=(Map.Entry<?,?>)it.next();
        Object key=entry.getKey();
        Object value=entry.getValue();
        if (keyConverter == null && key != null) {
          keyConverter=conversionService.getConversionExecutor(key.getClass(),TypeDescriptor.valueOf(targetKeyType));
        }
        if (valueConverter == null && value != null) {
          valueConverter=conversionService.getConversionExecutor(value.getClass(),TypeDescriptor.valueOf(targetValueType));
        }
        if (keyConverter != null && valueConverter != null) {
          break;
        }
      }
      entryConverter=new MapEntryConverter(keyConverter,valueConverter);
    }
  }
  return entryConverter;
}
