{
  SettableListenableFuture<WebSocketSession> connectFuture=new SettableListenableFuture<WebSocketSession>();
  XhrClientSockJsSession session=new XhrClientSockJsSession(request,handler,this,connectFuture);
  request.addTimeoutTask(session.getTimeoutTask());
  URI receiveUrl=request.getTransportUrl();
  if (logger.isDebugEnabled()) {
    logger.debug("Opening XHR session, receive url=" + receiveUrl);
  }
  HttpHeaders handshakeHeaders=new HttpHeaders();
  handshakeHeaders.putAll(request.getHandshakeHeaders());
  handshakeHeaders.putAll(getRequestHeaders());
  connectInternal(request,handler,receiveUrl,handshakeHeaders,session,connectFuture);
  return connectFuture;
}
