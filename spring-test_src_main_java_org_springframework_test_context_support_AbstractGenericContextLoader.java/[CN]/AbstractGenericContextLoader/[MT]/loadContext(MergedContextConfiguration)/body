{
  if (logger.isDebugEnabled()) {
    logger.debug(String.format("Loading ApplicationContext for merged context configuration [%s].",mergedConfig));
  }
  GenericApplicationContext context=new GenericApplicationContext();
  context.getEnvironment().setActiveProfiles(mergedConfig.getActiveProfiles());
  prepareContext(context);
  customizeBeanFactory(context.getDefaultListableBeanFactory());
  loadBeanDefinitions(context,mergedConfig);
  AnnotationConfigUtils.registerAnnotationConfigProcessors(context);
  customizeContext(context);
  context.refresh();
  context.registerShutdownHook();
  return context;
}
