{
  BeanDefinitionDocumentReader documentReader=createBeanDefinitionDocumentReader();
  if (documentReader instanceof DefaultBeanDefinitionDocumentReader) {
    ((DefaultBeanDefinitionDocumentReader)documentReader).setEnvironment(this.getEnvironment());
  }
  int countBefore=getRegistry().getBeanDefinitionCount();
  documentReader.registerBeanDefinitions(doc,createReaderContext(resource));
  return getRegistry().getBeanDefinitionCount() - countBefore;
}
