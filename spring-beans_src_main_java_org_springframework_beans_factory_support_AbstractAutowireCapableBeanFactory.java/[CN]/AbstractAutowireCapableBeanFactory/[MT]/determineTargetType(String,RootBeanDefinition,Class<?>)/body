{
  Class<?> targetType=mbd.getTargetType();
  if (targetType == null) {
    targetType=(mbd.getFactoryMethodName() != null ? getTypeForFactoryMethod(beanName,mbd,typesToMatch) : resolveBeanClass(mbd,beanName,typesToMatch));
    if (ObjectUtils.isEmpty(typesToMatch) || getTempClassLoader() == null) {
      mbd.setTargetType(targetType);
    }
  }
  return targetType;
}
