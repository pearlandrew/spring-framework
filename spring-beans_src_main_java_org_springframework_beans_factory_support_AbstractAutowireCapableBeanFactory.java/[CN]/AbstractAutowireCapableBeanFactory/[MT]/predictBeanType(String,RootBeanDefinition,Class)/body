{
  Class beanClass=(mbd.getFactoryMethodName() != null ? getTypeForFactoryMethod(beanName,mbd,typesToMatch) : resolveBeanClass(mbd,beanName,typesToMatch));
  if (beanClass != null && !mbd.isSynthetic() && hasInstantiationAwareBeanPostProcessors()) {
    for (    BeanPostProcessor bp : getBeanPostProcessors()) {
      if (bp instanceof SmartInstantiationAwareBeanPostProcessor) {
        SmartInstantiationAwareBeanPostProcessor ibp=(SmartInstantiationAwareBeanPostProcessor)bp;
        Class predictedType=ibp.predictBeanType(beanClass,beanName);
        if (predictedType != null && (typesToMatch.length != 1 || !FactoryBean.class.equals(typesToMatch[0]) || FactoryBean.class.isAssignableFrom(predictedType))) {
          return predictedType;
        }
      }
    }
  }
  return beanClass;
}
