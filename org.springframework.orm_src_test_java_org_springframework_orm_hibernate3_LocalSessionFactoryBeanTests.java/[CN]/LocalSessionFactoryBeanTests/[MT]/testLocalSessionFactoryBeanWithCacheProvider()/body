{
  final CacheProvider cacheProvider=new NoCacheProvider();
  final List<String> invocations=new ArrayList<String>();
  LocalSessionFactoryBean sfb=new LocalSessionFactoryBean(){
    @Override protected Configuration newConfiguration(){
      return new Configuration(){
        public Configuration addInputStream(        InputStream is){
          try {
            is.close();
          }
 catch (          IOException ex) {
          }
          invocations.add("addResource");
          return this;
        }
      }
;
    }
    @Override protected SessionFactory newSessionFactory(){
      assertEquals(LocalCacheProviderProxy.class.getName(),this.getConfiguration().getProperty(Environment.CACHE_PROVIDER));
      assertSame(cacheProvider,SessionFactoryBeanDelegate.getConfigTimeCacheProvider());
      invocations.add("newSessionFactory");
      return null;
    }
  }
;
  sfb.setCacheProvider(cacheProvider);
  sfb.afterPropertiesSet();
  assertTrue(sfb.getConfiguration() != null);
  assertEquals("newSessionFactory",invocations.get(0));
}
