{
  TestChannel channel=this.simpleBrokerContext.getBean("brokerChannel",TestChannel.class);
  UserDestinationMessageHandler messageHandler=this.simpleBrokerContext.getBean(UserDestinationMessageHandler.class);
  this.simpleBrokerContext.getBean(UserSessionRegistry.class).registerSessionId("joe","s1");
  StompHeaderAccessor headers=StompHeaderAccessor.create(StompCommand.SEND);
  headers.setDestination("/user/joe/foo");
  Message<?> message=MessageBuilder.createMessage(new byte[0],headers.getMessageHeaders());
  messageHandler.handleMessage(message);
  message=channel.messages.get(0);
  headers=StompHeaderAccessor.wrap(message);
  assertEquals(SimpMessageType.MESSAGE,headers.getMessageType());
  assertEquals("/foo-users1",headers.getDestination());
}
