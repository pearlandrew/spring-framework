{
  boolean isFactoryType=(type != null && FactoryBean.class.isAssignableFrom(type));
  List<String> matches=new ArrayList<String>();
  for (  String name : this.beans.keySet()) {
    Object beanInstance=this.beans.get(name);
    if (beanInstance instanceof FactoryBean && !isFactoryType) {
      if (includeFactoryBeans) {
        Class objectType=((FactoryBean)beanInstance).getObjectType();
        if (objectType != null && (type == null || type.isAssignableFrom(objectType))) {
          matches.add(name);
        }
      }
    }
 else {
      if (type == null || type.isInstance(beanInstance)) {
        matches.add(name);
      }
    }
  }
  return StringUtils.toStringArray(matches);
}
