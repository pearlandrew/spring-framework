{
  try {
    WebSocketServerSockJsSession wsSession=(WebSocketServerSockJsSession)session;
    WebSocketHandler sockJsWrapper=new SockJsWebSocketHandler(getSockJsConfig(),webSocketHandler,wsSession);
    this.handshakeHandler.doHandshake(request,response,sockJsWrapper);
  }
 catch (  Throwable t) {
    throw new TransportErrorException("Failed to start handshake request",t,session.getId());
  }
}
