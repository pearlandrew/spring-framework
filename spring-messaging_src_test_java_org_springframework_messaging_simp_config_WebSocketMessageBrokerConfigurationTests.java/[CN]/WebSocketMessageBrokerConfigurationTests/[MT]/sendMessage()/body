{
  final TextMessage textMessage=StompTextMessageBuilder.create(StompCommand.SEND).headers("destination:/app/foo").build();
  WebSocketHandler clientHandler=new TextWebSocketHandlerAdapter(){
    @Override public void afterConnectionEstablished(    WebSocketSession session) throws Exception {
      session.sendMessage(textMessage);
    }
  }
;
  TestController testController=this.wac.getBean(TestController.class);
  WebSocketSession session=this.webSocketClient.doHandshake(clientHandler,getWsBaseUrl() + "/ws");
  assertTrue(testController.latch.await(2,TimeUnit.SECONDS));
  session.close();
  testController.latch=new CountDownLatch(1);
  session=this.webSocketClient.doHandshake(clientHandler,getWsBaseUrl() + "/sockjs/websocket");
  assertTrue(testController.latch.await(2,TimeUnit.SECONDS));
  session.close();
}
