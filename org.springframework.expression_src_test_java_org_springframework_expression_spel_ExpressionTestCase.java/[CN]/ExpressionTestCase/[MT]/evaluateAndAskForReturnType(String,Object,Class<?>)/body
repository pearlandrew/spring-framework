{
  try {
    SpelExpression expr=(SpelExpression)parser.parseExpression(expression);
    if (expr == null) {
      fail("Parser returned null for expression");
    }
    if (DEBUG) {
      SpelUtilities.printAbstractSyntaxTree(System.out,expr);
    }
    Object value=expr.getValue(eContext,expectedResultType);
    if (value == null) {
      if (expectedValue == null)       return;
      assertEquals("Expression returned null value, but expected '" + expectedValue + "'",expectedValue,null);
    }
    Class<?> resultType=value.getClass();
    assertEquals("Type of the actual result was not as expected.  Expected '" + expectedResultType + "' but result was of type '"+ resultType+ "'",expectedResultType,resultType);
    assertEquals("Did not get expected value for expression '" + expression + "'.",expectedValue,value);
  }
 catch (  EvaluationException ee) {
    SpelException ex=(SpelException)ee;
    ex.printStackTrace();
    fail("Unexpected EvaluationException: " + ex.getMessage());
  }
catch (  ParseException pe) {
    fail("Unexpected ParseException: " + pe.getMessage());
  }
}
