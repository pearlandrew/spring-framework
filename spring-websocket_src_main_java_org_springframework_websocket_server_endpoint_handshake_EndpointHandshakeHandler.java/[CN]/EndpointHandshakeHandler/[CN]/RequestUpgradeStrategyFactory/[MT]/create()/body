{
  String className;
  if (tomcatWebSocketPresent) {
    className=packageName + ".TomcatRequestUpgradeStrategy";
  }
 else   if (glassfishWebSocketPresent) {
    className=packageName + ".GlassfishRequestUpgradeStrategy";
  }
 else {
    throw new IllegalStateException("No suitable " + RequestUpgradeStrategy.class.getSimpleName());
  }
  try {
    Class<?> clazz=ClassUtils.forName(className,EndpointHandshakeHandler.class.getClassLoader());
    return (RequestUpgradeStrategy)BeanUtils.instantiateClass(clazz.getConstructor());
  }
 catch (  Throwable t) {
    throw new IllegalStateException("Failed to instantiate " + className,t);
  }
}
