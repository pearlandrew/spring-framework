{
  if (this.favorPathExtension) {
    String requestUri=urlPathHelper.getRequestUri(request);
    String filename=WebUtils.extractFullFilenameFromUrlPath(requestUri);
    MediaType mediaType=getMediaTypeFromFilename(filename);
    if (mediaType != null) {
      if (logger.isDebugEnabled()) {
        logger.debug("Requested media type is '" + mediaType + "' (based on filename '"+ filename+ "')");
      }
      return Collections.singletonList(mediaType);
    }
  }
  if (this.favorParameter) {
    if (request.getParameter(this.parameterName) != null) {
      String parameterValue=request.getParameter(this.parameterName);
      MediaType mediaType=getMediaTypeFromParameter(parameterValue);
      if (mediaType != null) {
        if (logger.isDebugEnabled()) {
          logger.debug("Requested media type is '" + mediaType + "' (based on parameter '"+ this.parameterName+ "'='"+ parameterValue+ "')");
        }
        return Collections.singletonList(mediaType);
      }
    }
  }
  if (!this.ignoreAcceptHeader) {
    String acceptHeader=request.getHeader(ACCEPT_HEADER);
    if (StringUtils.hasText(acceptHeader)) {
      List<MediaType> mediaTypes=MediaType.parseMediaTypes(acceptHeader);
      MediaType.sortByQualityValue(mediaTypes);
      if (logger.isDebugEnabled()) {
        logger.debug("Requested media types are " + mediaTypes + " (based on Accept header)");
      }
      return mediaTypes;
    }
  }
  if (this.defaultContentType != null) {
    if (logger.isDebugEnabled()) {
      logger.debug("Requested media types is " + this.defaultContentType + " (based on defaultContentType property)");
    }
    return Collections.singletonList(this.defaultContentType);
  }
 else {
    return Collections.emptyList();
  }
}
