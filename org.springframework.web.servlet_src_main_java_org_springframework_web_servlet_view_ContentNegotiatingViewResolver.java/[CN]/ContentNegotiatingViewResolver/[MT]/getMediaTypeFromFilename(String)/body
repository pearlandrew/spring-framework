{
  String extension=StringUtils.getFilenameExtension(filename);
  if (!StringUtils.hasText(extension)) {
    return null;
  }
  extension=extension.toLowerCase(Locale.ENGLISH);
  MediaType mediaType=mediaTypes.get(extension);
  if (mediaType == null && jafPresent) {
    mediaType=ActivationMediaTypeFactory.getMediaType(filename);
    if (mediaType != null) {
      mediaTypes.putIfAbsent(extension,mediaType);
    }
  }
  return mediaType;
}
