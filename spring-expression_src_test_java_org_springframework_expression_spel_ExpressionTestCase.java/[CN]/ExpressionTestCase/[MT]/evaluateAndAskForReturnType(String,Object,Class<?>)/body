{
  try {
    Expression expr=parser.parseExpression(expression);
    if (expr == null) {
      Assert.fail("Parser returned null for expression");
    }
    if (DEBUG) {
      SpelUtilities.printAbstractSyntaxTree(System.out,expr);
    }
    Object value=expr.getValue(eContext,expectedResultType);
    if (value == null) {
      if (expectedValue == null)       return;
      Assert.assertEquals("Expression returned null value, but expected '" + expectedValue + "'",expectedValue,null);
    }
    Class<?> resultType=value.getClass();
    Assert.assertEquals("Type of the actual result was not as expected.  Expected '" + expectedResultType + "' but result was of type '"+ resultType+ "'",expectedResultType,resultType);
    Assert.assertEquals("Did not get expected value for expression '" + expression + "'.",expectedValue,value);
  }
 catch (  EvaluationException ee) {
    SpelEvaluationException ex=(SpelEvaluationException)ee;
    ex.printStackTrace();
    Assert.fail("Unexpected EvaluationException: " + ex.getMessage());
  }
catch (  ParseException pe) {
    Assert.fail("Unexpected ParseException: " + pe.getMessage());
  }
}
