{
  ResolvableType dependencyType=descriptor.getResolvableType();
  if (dependencyType.getType() instanceof Class) {
    return true;
  }
  ResolvableType targetType=null;
  RootBeanDefinition rbd=null;
  if (bdHolder.getBeanDefinition() instanceof RootBeanDefinition) {
    rbd=(RootBeanDefinition)bdHolder.getBeanDefinition();
  }
  if (rbd != null && rbd.getFactoryMethodName() != null) {
    Class<?> preResolved=rbd.resolvedFactoryMethodReturnType;
    if (preResolved != null) {
      targetType=ResolvableType.forClass(preResolved);
    }
 else {
      Method resolvedFactoryMethod=rbd.getResolvedFactoryMethod();
      if (resolvedFactoryMethod != null) {
        targetType=ResolvableType.forMethodReturnType(resolvedFactoryMethod);
      }
    }
  }
  if (targetType == null) {
    if (this.beanFactory != null) {
      Class<?> beanType=this.beanFactory.getType(bdHolder.getBeanName());
      if (beanType != null) {
        targetType=ResolvableType.forClass(ClassUtils.getUserClass(beanType));
      }
    }
    if (targetType == null && rbd != null && rbd.hasBeanClass() && rbd.getFactoryMethodName() == null) {
      Class<?> beanClass=rbd.getBeanClass();
      if (!FactoryBean.class.isAssignableFrom(beanClass)) {
        targetType=ResolvableType.forClass(ClassUtils.getUserClass(beanClass));
      }
    }
  }
  if (targetType == null) {
    return true;
  }
  if (descriptor.fallbackMatchAllowed() && targetType.hasUnresolvableGenerics()) {
    return descriptor.getDependencyType().isAssignableFrom(targetType.getRawClass());
  }
  return dependencyType.isAssignableFrom(targetType);
}
