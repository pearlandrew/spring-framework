{
  DefaultListableBeanFactory lbf=new DefaultListableBeanFactory();
  Properties p=new Properties();
  p.setProperty("x1.(class)",DummyFactory.class.getName());
  DummyFactory.reset();
  p.setProperty("x1.singleton","false");
  (new PropertiesBeanDefinitionReader(lbf)).registerBeanDefinitions(p);
  lbf.preInstantiateSingletons();
  assertTrue("prototype not instantiated",!DummyFactory.wasPrototypeCreated());
  String[] beanNames=lbf.getBeanNamesForType(TestBean.class,true,false);
  assertEquals(1,beanNames.length);
  assertEquals("x1",beanNames[0]);
  assertTrue(lbf.containsSingleton("x1"));
  assertTrue(lbf.containsBean("x1"));
  assertTrue(lbf.containsBean("&x1"));
  assertTrue(lbf.containsLocalBean("x1"));
  assertTrue(lbf.containsLocalBean("&x1"));
  assertFalse(lbf.isSingleton("x1"));
  assertTrue(lbf.isSingleton("&x1"));
  assertTrue(lbf.isPrototype("x1"));
  assertFalse(lbf.isPrototype("&x1"));
  assertTrue(lbf.isTypeMatch("x1",TestBean.class));
  assertFalse(lbf.isTypeMatch("&x1",TestBean.class));
  assertTrue(lbf.isTypeMatch("&x1",DummyFactory.class));
  assertTrue(lbf.isTypeMatch("x1",Object.class));
  assertTrue(lbf.isTypeMatch("&x1",Object.class));
  assertEquals(TestBean.class,lbf.getType("x1"));
  assertEquals(DummyFactory.class,lbf.getType("&x1"));
  assertTrue("prototype not instantiated",!DummyFactory.wasPrototypeCreated());
  lbf.registerAlias("x1","x2");
  assertTrue(lbf.containsBean("x2"));
  assertTrue(lbf.containsBean("&x2"));
  assertTrue(lbf.containsLocalBean("x2"));
  assertTrue(lbf.containsLocalBean("&x2"));
  assertFalse(lbf.isSingleton("x2"));
  assertTrue(lbf.isSingleton("&x2"));
  assertTrue(lbf.isPrototype("x2"));
  assertFalse(lbf.isPrototype("&x2"));
  assertTrue(lbf.isTypeMatch("x2",TestBean.class));
  assertFalse(lbf.isTypeMatch("&x2",TestBean.class));
  assertTrue(lbf.isTypeMatch("&x2",DummyFactory.class));
  assertTrue(lbf.isTypeMatch("x2",Object.class));
  assertTrue(lbf.isTypeMatch("&x2",Object.class));
  assertEquals(TestBean.class,lbf.getType("x2"));
  assertEquals(DummyFactory.class,lbf.getType("&x2"));
  assertEquals(1,lbf.getAliases("x1").length);
  assertEquals("x2",lbf.getAliases("x1")[0]);
  assertEquals(1,lbf.getAliases("&x1").length);
  assertEquals("&x2",lbf.getAliases("&x1")[0]);
  assertEquals(1,lbf.getAliases("x2").length);
  assertEquals("x1",lbf.getAliases("x2")[0]);
  assertEquals(1,lbf.getAliases("&x2").length);
  assertEquals("&x1",lbf.getAliases("&x2")[0]);
}
