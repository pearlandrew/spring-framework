{
  String participateAttributeName=getParticipateAttributeName();
  Integer count=(Integer)request.getAttribute(participateAttributeName,WebRequest.SCOPE_REQUEST);
  if (count != null) {
    if (count > 1) {
      request.setAttribute(participateAttributeName,count - 1,WebRequest.SCOPE_REQUEST);
    }
 else {
      request.removeAttribute(participateAttributeName,WebRequest.SCOPE_REQUEST);
    }
  }
 else {
    SessionHolder sessionHolder=(SessionHolder)TransactionSynchronizationManager.unbindResource(getSessionFactory());
    logger.debug("Closing Hibernate Session in OpenSessionInViewInterceptor");
    SessionFactoryUtils.closeSession(sessionHolder.getSession());
  }
}
