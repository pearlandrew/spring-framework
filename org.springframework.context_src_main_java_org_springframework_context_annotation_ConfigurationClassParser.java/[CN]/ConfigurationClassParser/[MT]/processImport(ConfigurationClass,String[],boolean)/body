{
  if (checkForCircularImports && this.importStack.contains(configClass)) {
    this.problemReporter.error(new CircularImportProblem(configClass,this.importStack,configClass.getMetadata()));
  }
 else {
    this.importStack.push(configClass);
    AnnotationMetadata importingClassMetadata=configClass.getMetadata();
    for (    String candidate : classesToImport) {
      MetadataReader reader=this.metadataReaderFactory.getMetadataReader(candidate);
      if (new AssignableTypeFilter(ImportSelector.class).match(reader,metadataReaderFactory)) {
        try {
          ImportSelector selector=BeanUtils.instantiateClass(Class.forName(candidate),ImportSelector.class);
          ImportSelector.Context context=new ImportSelector.Context(importingClassMetadata,this.registry);
          processImport(configClass,selector.selectImports(context),false);
        }
 catch (        ClassNotFoundException ex) {
          throw new IllegalStateException(ex);
        }
      }
 else {
        this.importStack.registerImport(importingClassMetadata.getClassName(),candidate);
        processConfigurationClass(new ConfigurationClass(reader,null));
      }
    }
    this.importStack.pop();
  }
}
