{
  List<String> protocols=handler.getSupportedProtocols();
  if (CollectionUtils.isEmpty(protocols)) {
    logger.warn("No sub-protocols, ignoring handler " + handler);
    return;
  }
  for (  String protocol : protocols) {
    SubProtocolHandler replaced=this.protocolHandlers.put(protocol,handler);
    if ((replaced != null) && (replaced != handler)) {
      throw new IllegalStateException("Failed to map handler " + handler + " to protocol '"+ protocol+ "', it is already mapped to handler "+ replaced);
    }
  }
}
