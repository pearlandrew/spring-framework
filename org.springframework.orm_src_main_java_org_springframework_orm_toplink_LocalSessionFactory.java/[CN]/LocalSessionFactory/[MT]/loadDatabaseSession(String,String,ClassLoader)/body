{
  SessionManager manager=getSessionManager();
  Method getSessionMethod=null;
  Object loader=null;
  try {
    Class loaderClass=SessionManager.class.getClassLoader().loadClass("oracle.toplink.tools.sessionconfiguration.XMLSessionConfigLoader");
    getSessionMethod=SessionManager.class.getMethod("getSession",new Class[]{loaderClass,String.class,ClassLoader.class,boolean.class,boolean.class,boolean.class});
    if (logger.isDebugEnabled()) {
      logger.debug("Using TopLink 10.1.3 XMLSessionConfigLoader");
    }
    Constructor ctor=loaderClass.getConstructor(new Class[]{String.class});
    loader=ctor.newInstance(new Object[]{configLocation});
  }
 catch (  Exception ex) {
    if (logger.isDebugEnabled()) {
      logger.debug("Using TopLink 9.0.4 XMLLoader");
    }
    XMLLoader xmlLoader=new XMLLoader(configLocation);
    return (DatabaseSession)manager.getSession(xmlLoader,sessionName,sessionClassLoader,false,false);
  }
  return (DatabaseSession)ReflectionUtils.invokeMethod(getSessionMethod,manager,new Object[]{loader,sessionName,sessionClassLoader,Boolean.FALSE,Boolean.FALSE,Boolean.TRUE});
}
