{
  Assert.notNull(lbf,"ListableBeanFactory must not be null");
  String[] result=lbf.getBeanNamesForType(type,includeNonSingletons,allowEagerInit);
  if (lbf instanceof HierarchicalBeanFactory) {
    HierarchicalBeanFactory hbf=(HierarchicalBeanFactory)lbf;
    if (hbf.getParentBeanFactory() instanceof ListableBeanFactory) {
      String[] parentResult=beanNamesForTypeIncludingAncestors((ListableBeanFactory)hbf.getParentBeanFactory(),type,includeNonSingletons,allowEagerInit);
      List resultList=new ArrayList();
      resultList.addAll(Arrays.asList(result));
      for (int i=0; i < parentResult.length; i++) {
        String beanName=parentResult[i];
        if (!resultList.contains(beanName) && !hbf.containsLocalBean(beanName)) {
          resultList.add(beanName);
        }
      }
      result=StringUtils.toStringArray(resultList);
    }
  }
  return result;
}
