{
  PageContext ctx=new CountingMockPageContext();
  CountingMockExpressionEvaluator eval=(CountingMockExpressionEvaluator)ctx.getExpressionEvaluator();
  ctx.setAttribute("bla","blie");
  ctx.setAttribute("blo","blue");
  MockServletContext sc=(MockServletContext)ctx.getServletContext();
  sc.addInitParameter(ExpressionEvaluationUtils.EXPRESSION_CACHE_CONTEXT_PARAM,"true");
  String expr="text${bla}text${blo}text";
  Object o=ExpressionEvaluationUtils.evaluate("test",expr,String.class,ctx);
  assertEquals("textblietextbluetext",o);
  assertEquals(2,eval.parseExpressionCount);
  expr="${bla}text${blo}text";
  o=ExpressionEvaluationUtils.evaluate("test",expr,String.class,ctx);
  assertEquals("blietextbluetext",o);
  assertEquals(2,eval.parseExpressionCount);
  expr="${bla}text${blo}";
  o=ExpressionEvaluationUtils.evaluate("test",expr,String.class,ctx);
  assertEquals("blietextblue",o);
  assertEquals(2,eval.parseExpressionCount);
  expr="${bla}text${blo}";
  o=ExpressionEvaluationUtils.evaluate("test",expr,Object.class,ctx);
  assertEquals("blietextblue",o);
  assertEquals(2,eval.parseExpressionCount);
}
