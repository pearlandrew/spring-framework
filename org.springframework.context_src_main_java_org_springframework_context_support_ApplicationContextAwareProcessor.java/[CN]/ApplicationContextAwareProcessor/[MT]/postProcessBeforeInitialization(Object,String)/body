{
  AccessControlContext acc=null;
  if (System.getSecurityManager() != null) {
    if (applicationContext instanceof ConfigurableApplicationContext) {
      ConfigurableListableBeanFactory factory=((ConfigurableApplicationContext)applicationContext).getBeanFactory();
      if (factory instanceof AbstractBeanFactory) {
        acc=((AbstractBeanFactory)factory).getSecurityContextProvider().getAccessControlContext();
      }
    }
    if (bean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware || bean instanceof MessageSourceAware|| bean instanceof ApplicationContextAware) {
      AccessController.doPrivileged(new PrivilegedAction<Object>(){
        public Object run(){
          doProcess(bean);
          return null;
        }
      }
,acc);
    }
  }
 else {
    doProcess(bean);
  }
  return bean;
}
