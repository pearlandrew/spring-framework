{
  Class<?> targetClass=AopUtils.getTargetClass(bean);
  ReflectionUtils.doWithMethods(targetClass,new MethodCallback(){
    public void doWith(    Method method) throws IllegalArgumentException, IllegalAccessException {
      Scheduled annotation=AnnotationUtils.getAnnotation(method,Scheduled.class);
      if (annotation != null) {
        Assert.isTrue(void.class.equals(method.getReturnType()),"Only void-returning methods may be annotated with @Scheduled.");
        Assert.isTrue(method.getParameterTypes().length == 0,"Only no-arg methods may be annotated with @Scheduled.");
        Runnable runnable=new ScheduledMethodRunnable(bean,method);
        boolean processedSchedule=false;
        String errorMessage="Exactly one of 'cron', 'fixedDelay', or 'fixedRate' is required.";
        String cron=annotation.cron();
        if (!"".equals(cron)) {
          processedSchedule=true;
          if (embeddedValueResolver != null) {
            cron=embeddedValueResolver.resolveStringValue(cron);
          }
          cronTasks.put(runnable,cron);
        }
        long fixedDelay=annotation.fixedDelay();
        if (fixedDelay >= 0) {
          Assert.isTrue(!processedSchedule,errorMessage);
          processedSchedule=true;
          fixedDelayTasks.put(runnable,fixedDelay);
        }
        long fixedRate=annotation.fixedRate();
        if (fixedRate >= 0) {
          Assert.isTrue(!processedSchedule,errorMessage);
          processedSchedule=true;
          fixedRateTasks.put(runnable,fixedRate);
        }
        Assert.isTrue(processedSchedule,errorMessage);
      }
    }
  }
);
  return bean;
}
