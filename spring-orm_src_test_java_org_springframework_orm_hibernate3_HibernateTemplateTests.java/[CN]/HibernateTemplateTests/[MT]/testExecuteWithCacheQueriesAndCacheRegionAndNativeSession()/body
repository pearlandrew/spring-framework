{
  Query query1=mock(Query.class);
  Query query2=mock(Query.class);
  Criteria criteria=mock(Criteria.class);
  given(session.createQuery("some query")).willReturn(query1);
  given(session.getNamedQuery("some query name")).willReturn(query2);
  given(session.createCriteria(TestBean.class)).willReturn(criteria);
  hibernateTemplate.setExposeNativeSession(true);
  hibernateTemplate.setCacheQueries(true);
  hibernateTemplate.setQueryCacheRegion("myRegion");
  hibernateTemplate.execute(new HibernateCallback<Object>(){
    @Override public Object doInHibernate(    org.hibernate.Session sess) throws HibernateException {
      assertSame(session,sess);
      sess.createQuery("some query");
      sess.getNamedQuery("some query name");
      sess.createCriteria(TestBean.class);
      return null;
    }
  }
);
  verify(session).flush();
  verify(session).close();
}
