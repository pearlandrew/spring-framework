{
  reset(sessionFactory);
  given(sessionFactory.getCurrentSession()).willThrow(new HibernateException(""));
  HibernateTemplate ht=new HibernateTemplate();
  ht.setSessionFactory(sessionFactory);
  ht.setAllowCreate(false);
  try {
    ht.execute(new HibernateCallback<Object>(){
      @Override public Object doInHibernate(      org.hibernate.Session session) throws HibernateException {
        return null;
      }
    }
);
    fail("Should have thrown DataAccessException");
  }
 catch (  DataAccessResourceFailureException ex) {
  }
}
