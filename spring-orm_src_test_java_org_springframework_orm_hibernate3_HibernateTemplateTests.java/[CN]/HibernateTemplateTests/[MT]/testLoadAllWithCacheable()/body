{
  Criteria criteria=mock(Criteria.class);
  List list=new ArrayList();
  given(session.createCriteria(TestBean.class)).willReturn(criteria);
  given(criteria.setResultTransformer(Criteria.DISTINCT_ROOT_ENTITY)).willReturn(criteria);
  given(criteria.setCacheable(true)).willReturn(criteria);
  given(criteria.list()).willReturn(list);
  hibernateTemplate.setCacheQueries(true);
  List result=hibernateTemplate.loadAll(TestBean.class);
  assertTrue("Correct result",result == list);
  verify(criteria).setCacheable(true);
  verify(session).flush();
  verify(session).close();
}
