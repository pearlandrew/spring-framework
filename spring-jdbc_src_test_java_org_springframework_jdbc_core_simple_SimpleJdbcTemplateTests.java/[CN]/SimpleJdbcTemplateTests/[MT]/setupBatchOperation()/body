{
  DataSource dataSource=mock(DataSource.class);
  Connection connection=mock(Connection.class);
  PreparedStatement preparedStatement=mock(PreparedStatement.class);
  DatabaseMetaData databaseMetaData=mock(DatabaseMetaData.class);
  given(dataSource.getConnection()).willReturn(connection);
  given(preparedStatement.getConnection()).willReturn(connection);
  given(preparedStatement.executeBatch()).willReturn(new int[]{1,2});
  given(databaseMetaData.getDatabaseProductName()).willReturn("MySQL");
  given(databaseMetaData.supportsBatchUpdates()).willReturn(true);
  given(connection.prepareStatement(anyString())).willReturn(preparedStatement);
  given(connection.getMetaData()).willReturn(databaseMetaData);
  template=new SimpleJdbcTemplate(new JdbcTemplate(dataSource,false));
  return preparedStatement;
}
