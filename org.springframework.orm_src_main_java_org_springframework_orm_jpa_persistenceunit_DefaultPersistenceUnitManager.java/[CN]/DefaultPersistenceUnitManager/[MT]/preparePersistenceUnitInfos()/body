{
  this.persistenceUnitInfoNames.clear();
  this.persistenceUnitInfos.clear();
  SpringPersistenceUnitInfo[] puis=readPersistenceUnitInfos();
  for (  SpringPersistenceUnitInfo pui : puis) {
    if (pui.getPersistenceUnitRootUrl() == null) {
      pui.setPersistenceUnitRootUrl(determineDefaultPersistenceUnitRootUrl());
    }
    if (pui.getNonJtaDataSource() == null) {
      pui.setNonJtaDataSource(this.defaultDataSource);
    }
    if (this.loadTimeWeaver != null) {
      pui.init(this.loadTimeWeaver);
    }
 else {
      pui.init(this.resourcePatternResolver.getClassLoader());
    }
    postProcessPersistenceUnitInfo(pui);
    String name=pui.getPersistenceUnitName();
    this.persistenceUnitInfoNames.add(name);
    PersistenceUnitInfo puiToStore=pui;
    if (jpa2ApiPresent) {
      puiToStore=(PersistenceUnitInfo)Proxy.newProxyInstance(SmartPersistenceUnitInfo.class.getClassLoader(),new Class[]{SmartPersistenceUnitInfo.class},new Jpa2PersistenceUnitInfoDecorator(pui));
    }
    this.persistenceUnitInfos.put(name,puiToStore);
  }
}
