{
  MapMessage message=session.createMapMessage();
  for (Iterator it=map.entrySet().iterator(); it.hasNext(); ) {
    Map.Entry entry=(Map.Entry)it.next();
    if (!(entry.getKey() instanceof String)) {
      throw new MessageConversionException("Cannot convert non-String key of type [" + ObjectUtils.nullSafeClassName(entry.getKey()) + "] to JMS MapMessage entry");
    }
    message.setObject((String)entry.getKey(),entry.getValue());
  }
  return message;
}
