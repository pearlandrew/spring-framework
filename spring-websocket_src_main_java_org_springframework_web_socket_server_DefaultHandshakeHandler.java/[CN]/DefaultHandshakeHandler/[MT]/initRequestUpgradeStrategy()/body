{
  String className;
  if (tomcatWsPresent) {
    className="org.springframework.web.socket.server.support.TomcatRequestUpgradeStrategy";
  }
 else   if (jettyWsPresent) {
    className="org.springframework.web.socket.server.support.JettyRequestUpgradeStrategy";
  }
 else   if (glassFishWsPresent) {
    if (glassFish40WsPresent) {
      className="org.springframework.web.socket.server.support.GlassFish40RequestUpgradeStrategy";
    }
 else {
      className="org.springframework.web.socket.server.support.GlassFishRequestUpgradeStrategy";
    }
  }
 else {
    throw new IllegalStateException("No suitable " + RequestUpgradeStrategy.class.getSimpleName());
  }
  try {
    Class<?> clazz=ClassUtils.forName(className,DefaultHandshakeHandler.class.getClassLoader());
    return (RequestUpgradeStrategy)BeanUtils.instantiateClass(clazz.getConstructor());
  }
 catch (  Throwable t) {
    throw new IllegalStateException("Failed to instantiate " + className,t);
  }
}
