{
  MessageHeaders headers=message.getHeaders();
  SimpMessageType messageType=SimpMessageHeaderAccessor.getMessageType(headers);
  String destination=SimpMessageHeaderAccessor.getDestination(headers);
  String sessionId=SimpMessageHeaderAccessor.getSessionId(headers);
  if (!checkDestinationPrefix(destination)) {
    return;
  }
  if (SimpMessageType.MESSAGE.equals(messageType)) {
    sendMessageToSubscribers(destination,message);
  }
 else   if (SimpMessageType.CONNECT.equals(messageType)) {
    if (logger.isInfoEnabled()) {
      logger.info("Handling CONNECT: " + message);
    }
    SimpMessageHeaderAccessor accessor=SimpMessageHeaderAccessor.create(SimpMessageType.CONNECT_ACK);
    initHeaders(accessor);
    accessor.setSessionId(sessionId);
    accessor.setHeader(SimpMessageHeaderAccessor.CONNECT_MESSAGE_HEADER,message);
    Message<byte[]> connectAck=MessageBuilder.createMessage(EMPTY_PAYLOAD,accessor.getMessageHeaders());
    this.clientOutboundChannel.send(connectAck);
  }
 else   if (SimpMessageType.DISCONNECT.equals(messageType)) {
    if (logger.isInfoEnabled()) {
      logger.info("Handling DISCONNECT: " + message);
    }
    this.subscriptionRegistry.unregisterAllSubscriptions(sessionId);
  }
 else   if (SimpMessageType.SUBSCRIBE.equals(messageType)) {
    if (logger.isDebugEnabled()) {
      logger.debug("Handling SUBSCRIBE: " + message);
    }
    this.subscriptionRegistry.registerSubscription(message);
  }
 else   if (SimpMessageType.UNSUBSCRIBE.equals(messageType)) {
    if (logger.isDebugEnabled()) {
      logger.debug("Handling UNSUBSCRIBE: " + message);
    }
    this.subscriptionRegistry.unregisterSubscription(message);
  }
}
