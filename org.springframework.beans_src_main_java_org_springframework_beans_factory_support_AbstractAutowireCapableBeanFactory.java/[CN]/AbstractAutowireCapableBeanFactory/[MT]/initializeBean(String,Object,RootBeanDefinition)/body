{
  if (bean instanceof BeanNameAware) {
    ((BeanNameAware)bean).setBeanName(beanName);
  }
  if (bean instanceof BeanClassLoaderAware) {
    ((BeanClassLoaderAware)bean).setBeanClassLoader(getBeanClassLoader());
  }
  if (bean instanceof BeanFactoryAware) {
    ((BeanFactoryAware)bean).setBeanFactory(this);
  }
  Object wrappedBean=bean;
  if (mbd == null || !mbd.isSynthetic()) {
    wrappedBean=applyBeanPostProcessorsBeforeInitialization(wrappedBean,beanName);
  }
  try {
    invokeInitMethods(beanName,wrappedBean,mbd);
  }
 catch (  Throwable ex) {
    throw new BeanCreationException((mbd != null ? mbd.getResourceDescription() : null),beanName,"Invocation of init method failed",ex);
  }
  if (mbd == null || !mbd.isSynthetic()) {
    wrappedBean=applyBeanPostProcessorsAfterInitialization(wrappedBean,beanName);
  }
  return wrappedBean;
}
