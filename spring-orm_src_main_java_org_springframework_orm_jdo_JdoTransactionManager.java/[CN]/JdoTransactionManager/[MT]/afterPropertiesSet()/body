{
  if (getPersistenceManagerFactory() == null) {
    throw new IllegalArgumentException("Property 'persistenceManagerFactory' is required");
  }
  if (this.jdoDialect == null) {
    this.jdoDialect=new DefaultJdoDialect(getPersistenceManagerFactory().getConnectionFactory());
  }
  if (this.autodetectDataSource && getDataSource() == null) {
    Object pmfcf=getPersistenceManagerFactory().getConnectionFactory();
    if (pmfcf instanceof DataSource) {
      this.dataSource=(DataSource)pmfcf;
      if (logger.isInfoEnabled()) {
        logger.info("Using DataSource [" + this.dataSource + "] of JDO PersistenceManagerFactory for JdoTransactionManager");
      }
    }
  }
}
