{
  JdoTransactionObject txObject=new JdoTransactionObject();
  txObject.setSavepointAllowed(isNestedTransactionAllowed());
  PersistenceManagerHolder pmHolder=(PersistenceManagerHolder)TransactionSynchronizationManager.getResource(getPersistenceManagerFactory());
  if (pmHolder != null) {
    if (logger.isDebugEnabled()) {
      logger.debug("Found thread-bound PersistenceManager [" + pmHolder.getPersistenceManager() + "] for JDO transaction");
    }
    txObject.setPersistenceManagerHolder(pmHolder,false);
  }
  if (getDataSource() != null) {
    ConnectionHolder conHolder=(ConnectionHolder)TransactionSynchronizationManager.getResource(getDataSource());
    txObject.setConnectionHolder(conHolder);
  }
  return txObject;
}
