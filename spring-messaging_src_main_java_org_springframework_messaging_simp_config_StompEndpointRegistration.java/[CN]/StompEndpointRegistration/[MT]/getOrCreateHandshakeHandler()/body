{
  HandshakeHandler handler=(this.handshakeHandler != null) ? this.handshakeHandler : new DefaultHandshakeHandler();
  if (handler instanceof DefaultHandshakeHandler) {
    DefaultHandshakeHandler defaultHandshakeHandler=(DefaultHandshakeHandler)handler;
    if (ObjectUtils.isEmpty(defaultHandshakeHandler.getSupportedProtocols())) {
      Set<String> protocols=this.wsHandler.getSupportedProtocols();
      defaultHandshakeHandler.setSupportedProtocols(protocols.toArray(new String[protocols.size()]));
    }
  }
  return handler;
}
