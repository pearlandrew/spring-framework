{
  boolean actualNewSynchronization=newSynchronization && !TransactionSynchronizationManager.isSynchronizationActive();
  if (actualNewSynchronization) {
    TransactionSynchronizationManager.setActualTransactionActive(transaction != null);
    TransactionSynchronizationManager.setCurrentTransactionIsolationLevel((definition.getIsolationLevel() != TransactionDefinition.ISOLATION_DEFAULT) ? new Integer(definition.getIsolationLevel()) : null);
    TransactionSynchronizationManager.setCurrentTransactionReadOnly(definition.isReadOnly());
    TransactionSynchronizationManager.setCurrentTransactionName(definition.getName());
    TransactionSynchronizationManager.initSynchronization();
  }
  return new DefaultTransactionStatus(transaction,newTransaction,actualNewSynchronization,definition.isReadOnly(),debug,suspendedResources);
}
