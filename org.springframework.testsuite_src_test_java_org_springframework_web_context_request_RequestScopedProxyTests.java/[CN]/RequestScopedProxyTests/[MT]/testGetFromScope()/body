{
  String name="requestScopedObject";
  TestBean bean=(TestBean)this.beanFactory.getBean(name);
  assertTrue(AopUtils.isCglibProxy(bean));
  MockHttpServletRequest request=new MockHttpServletRequest();
  RequestAttributes requestAttributes=new ServletRequestAttributes(request);
  RequestContextHolder.setRequestAttributes(requestAttributes);
  try {
    assertNull(request.getAttribute("scopedTarget." + name));
    assertEquals("scoped",bean.getName());
    assertNotNull(request.getAttribute("scopedTarget." + name));
    assertEquals(TestBean.class,request.getAttribute("scopedTarget." + name).getClass());
    assertEquals("scoped",((TestBean)request.getAttribute("scopedTarget." + name)).getName());
    assertSame(bean,this.beanFactory.getBean(name));
  }
  finally {
    RequestContextHolder.setRequestAttributes(null);
  }
}
