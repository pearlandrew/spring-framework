{
  Class[] ifcs=null;
  EntityManagerFactory emf=getEntityManagerFactory();
  if (emf instanceof EntityManagerFactoryInfo) {
    Class entityManagerInterface=((EntityManagerFactoryInfo)emf).getEntityManagerInterface();
    if (entityManagerInterface != null) {
      ifcs=new Class[]{entityManagerInterface};
    }
  }
  if (ifcs == null) {
    ifcs=ClassUtils.getAllInterfacesForClass(em.getClass());
  }
  return (EntityManager)Proxy.newProxyInstance(em.getClass().getClassLoader(),ifcs,new CloseSuppressingInvocationHandler(em));
}
