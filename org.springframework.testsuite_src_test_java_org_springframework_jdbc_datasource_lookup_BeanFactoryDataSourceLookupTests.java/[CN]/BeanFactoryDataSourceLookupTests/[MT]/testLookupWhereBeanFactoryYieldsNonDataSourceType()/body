{
  MockControl mockBeanFactory=MockControl.createControl(BeanFactory.class);
  final BeanFactory beanFactory=(BeanFactory)mockBeanFactory.getMock();
  beanFactory.getBean(DATASOURCE_BEAN_NAME,DataSource.class);
  mockBeanFactory.setThrowable(new BeanNotOfRequiredTypeException(DATASOURCE_BEAN_NAME,DataSource.class,String.class));
  mockBeanFactory.replay();
  new AssertThrows(DataSourceLookupFailureException.class){
    public void test() throws Exception {
      BeanFactoryDataSourceLookup lookup=new BeanFactoryDataSourceLookup(beanFactory);
      lookup.getDataSource(DATASOURCE_BEAN_NAME);
    }
  }
.runTest();
  mockBeanFactory.verify();
}
