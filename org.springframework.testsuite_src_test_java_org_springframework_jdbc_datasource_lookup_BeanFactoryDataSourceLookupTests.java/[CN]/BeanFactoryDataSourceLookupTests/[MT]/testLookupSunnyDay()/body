{
  MockControl mockBeanFactory=MockControl.createControl(BeanFactory.class);
  BeanFactory beanFactory=(BeanFactory)mockBeanFactory.getMock();
  beanFactory.getBean(DATASOURCE_BEAN_NAME,DataSource.class);
  StubDataSource expectedDataSource=new StubDataSource();
  mockBeanFactory.setReturnValue(expectedDataSource);
  mockBeanFactory.replay();
  BeanFactoryDataSourceLookup lookup=new BeanFactoryDataSourceLookup();
  lookup.setBeanFactory(beanFactory);
  DataSource dataSource=lookup.getDataSource(DATASOURCE_BEAN_NAME);
  assertNotNull("A DataSourceLookup implementation must *never* return null from getDataSource(): this one obviously (and incorrectly) is",dataSource);
  assertSame(expectedDataSource,dataSource);
  mockBeanFactory.verify();
}
