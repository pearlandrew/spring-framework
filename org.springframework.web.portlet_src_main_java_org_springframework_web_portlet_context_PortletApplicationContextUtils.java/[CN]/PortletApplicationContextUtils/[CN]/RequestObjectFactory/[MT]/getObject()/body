{
  RequestAttributes requestAttr=RequestContextHolder.currentRequestAttributes();
  if (!(requestAttr instanceof PortletRequestAttributes)) {
    throw new IllegalStateException("Current request is not a portlet request");
  }
  return ((PortletRequestAttributes)requestAttr).getRequest();
}
