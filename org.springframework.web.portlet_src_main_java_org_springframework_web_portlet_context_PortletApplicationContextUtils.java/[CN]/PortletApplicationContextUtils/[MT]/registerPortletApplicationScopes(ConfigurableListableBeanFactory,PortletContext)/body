{
  beanFactory.registerScope(WebApplicationContext.SCOPE_REQUEST,new RequestScope());
  beanFactory.registerScope(WebApplicationContext.SCOPE_SESSION,new SessionScope(false));
  beanFactory.registerScope(WebApplicationContext.SCOPE_GLOBAL_SESSION,new SessionScope(true));
  if (pc != null) {
    PortletContextScope appScope=new PortletContextScope(pc);
    beanFactory.registerScope(WebApplicationContext.SCOPE_APPLICATION,appScope);
    pc.setAttribute(PortletContextScope.class.getName(),appScope);
  }
  beanFactory.registerResolvableDependency(PortletRequest.class,new ObjectFactory<PortletRequest>(){
    public PortletRequest getObject(){
      RequestAttributes requestAttr=RequestContextHolder.currentRequestAttributes();
      if (!(requestAttr instanceof PortletRequestAttributes)) {
        throw new IllegalStateException("Current request is not a portlet request");
      }
      return ((PortletRequestAttributes)requestAttr).getRequest();
    }
  }
);
  beanFactory.registerResolvableDependency(PortletSession.class,new ObjectFactory<PortletSession>(){
    public PortletSession getObject(){
      RequestAttributes requestAttr=RequestContextHolder.currentRequestAttributes();
      if (!(requestAttr instanceof PortletRequestAttributes)) {
        throw new IllegalStateException("Current request is not a portlet request");
      }
      return ((PortletRequestAttributes)requestAttr).getRequest().getPortletSession();
    }
  }
);
}
