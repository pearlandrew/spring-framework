{
  int written;
  int totalWritten=0;
  do {
    written=channel.write(byteBuffer);
    totalWritten+=written;
  }
 while (byteBuffer.hasRemaining() && written > 0);
  return totalWritten;
}
