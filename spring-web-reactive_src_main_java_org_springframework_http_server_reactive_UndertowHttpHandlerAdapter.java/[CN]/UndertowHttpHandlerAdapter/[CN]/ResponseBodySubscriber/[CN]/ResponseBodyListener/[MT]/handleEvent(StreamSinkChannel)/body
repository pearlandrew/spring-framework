{
  if (byteBuffer != null) {
    try {
      int total=byteBuffer.remaining();
      int written=writeByteBuffer(channel);
      logger.trace("written: " + written + " total: "+ total);
      if (written == total) {
        if (dataBuffer instanceof FlushingDataBuffer) {
          flush(channel);
        }
        releaseBuffer();
        if (!completed) {
          subscription.request(1);
        }
 else {
          closeChannel(channel);
        }
      }
    }
 catch (    IOException ex) {
      onError(ex);
    }
  }
 else   if (subscription != null) {
    subscription.request(1);
  }
}
