{
  AbstractJasperReportsView view=getView(COMPILED_REPORT);
  if (!(view instanceof AbstractJasperReportsSingleFormatView) || !((AbstractJasperReportsSingleFormatView)view).useWriter()) {
    return;
  }
  String characterEncoding="UTF-8";
  String overiddenCharacterEncoding="ASCII";
  Map parameters=new HashMap();
  parameters.put(JRExporterParameter.CHARACTER_ENCODING,characterEncoding);
  view.setExporterParameters(parameters);
  view.convertExporterParameters();
  Map model=getModel();
  model.put(JRExporterParameter.CHARACTER_ENCODING,overiddenCharacterEncoding);
  view.render(model,this.request,this.response);
  assertEquals(overiddenCharacterEncoding,this.response.getCharacterEncoding());
}
