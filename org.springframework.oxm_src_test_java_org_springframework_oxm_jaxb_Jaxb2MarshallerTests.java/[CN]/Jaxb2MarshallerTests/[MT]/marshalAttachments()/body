{
  marshaller=new Jaxb2Marshaller();
  marshaller.setClassesToBeBound(new Class[]{BinaryObject.class});
  marshaller.setMtomEnabled(true);
  marshaller.afterPropertiesSet();
  MimeContainer mimeContainer=createMock(MimeContainer.class);
  Resource logo=new ClassPathResource("spring-ws.png",getClass());
  DataHandler dataHandler=new DataHandler(new FileDataSource(logo.getFile()));
  expect(mimeContainer.convertToXopPackage()).andReturn(true);
  mimeContainer.addAttachment(isA(String.class),isA(DataHandler.class));
  expectLastCall().times(3);
  replay(mimeContainer);
  byte[] bytes=FileCopyUtils.copyToByteArray(logo.getInputStream());
  BinaryObject object=new BinaryObject(bytes,dataHandler);
  StringWriter writer=new StringWriter();
  marshaller.marshal(object,new StreamResult(writer),mimeContainer);
  verify(mimeContainer);
  assertTrue("No XML written",writer.toString().length() > 0);
}
