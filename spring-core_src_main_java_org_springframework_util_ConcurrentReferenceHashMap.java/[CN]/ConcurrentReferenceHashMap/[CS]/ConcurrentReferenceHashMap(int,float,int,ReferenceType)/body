{
  Assert.isTrue(concurrencyLevel > 0,"ConcurrencyLevel must be positive");
  Assert.isTrue(initialCapacity >= 0,"InitialCapactity must not be negative");
  Assert.isTrue(loadFactor > 0f,"LoadFactor must be positive");
  Assert.notNull(referenceType,"Reference type must not be null");
  this.loadFactor=loadFactor;
  this.shift=calculateShift(concurrencyLevel,MAXIMUM_CONCURRENCY_LEVEL);
  int size=1 << this.shift;
  this.referenceType=referenceType;
  int roundedUpSegmentCapactity=(int)((initialCapacity + size - 1L) / size);
  this.segments=createSegmentsArray(size);
  for (int i=0; i < this.segments.length; i++) {
    this.segments[i]=new Segment(roundedUpSegmentCapactity);
  }
}
