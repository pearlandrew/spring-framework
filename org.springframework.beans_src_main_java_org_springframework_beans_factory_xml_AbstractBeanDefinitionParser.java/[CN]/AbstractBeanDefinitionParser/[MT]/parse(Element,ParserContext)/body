{
  AbstractBeanDefinition definition=parseInternal(element,parserContext);
  if (!parserContext.isNested()) {
    try {
      String id=resolveId(element,definition,parserContext);
      if (!StringUtils.hasText(id)) {
        parserContext.getReaderContext().error("Id is required for element '" + element.getLocalName() + "' when used as a top-level tag",element);
      }
      BeanDefinitionHolder holder=new BeanDefinitionHolder(definition,id);
      registerBeanDefinition(holder,parserContext.getRegistry());
      if (shouldFireEvents()) {
        BeanComponentDefinition componentDefinition=new BeanComponentDefinition(holder);
        postProcessComponentDefinition(componentDefinition);
        parserContext.registerComponent(componentDefinition);
      }
    }
 catch (    BeanDefinitionStoreException ex) {
      parserContext.getReaderContext().error(ex.getMessage(),element);
      return null;
    }
  }
  return definition;
}
