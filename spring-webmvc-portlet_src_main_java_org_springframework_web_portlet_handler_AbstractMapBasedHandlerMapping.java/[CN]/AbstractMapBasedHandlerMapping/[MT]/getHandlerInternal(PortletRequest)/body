{
  K lookupKey=getLookupKey(request);
  Object handler=this.handlerMap.get(lookupKey);
  if (handler != null && logger.isDebugEnabled()) {
    logger.debug("Key [" + lookupKey + "] -> handler ["+ handler+ "]");
  }
  if (handler instanceof Map) {
    Map<PortletRequestMappingPredicate,Object> predicateMap=(Map<PortletRequestMappingPredicate,Object>)handler;
    List<PortletRequestMappingPredicate> filtered=new LinkedList<PortletRequestMappingPredicate>();
    for (    PortletRequestMappingPredicate predicate : predicateMap.keySet()) {
      if (predicate.match(request)) {
        filtered.add(predicate);
      }
    }
    if (filtered.isEmpty()) {
      return null;
    }
    Collections.sort(filtered);
    PortletRequestMappingPredicate predicate=filtered.get(0);
    predicate.validate(request);
    return predicateMap.get(predicate);
  }
  return handler;
}
