{
  String port=portAsString();
  String path=null;
  if (!pathSegments.isEmpty()) {
    StringBuilder pathBuilder=new StringBuilder();
    for (    String pathSegment : pathSegments) {
      boolean startsWithSlash=pathSegment.charAt(0) == '/';
      boolean endsWithSlash=pathBuilder.length() > 0 && pathBuilder.charAt(pathBuilder.length() - 1) == '/';
      if (!endsWithSlash && !startsWithSlash) {
        pathBuilder.append('/');
      }
 else       if (endsWithSlash && startsWithSlash) {
        pathSegment=pathSegment.substring(1);
      }
      pathBuilder.append(pathSegment);
    }
    path=pathBuilder.toString();
  }
  String query=queryAsString();
  String uri=UriUtils.buildUri(scheme,null,userInfo,host,port,path,query,fragment);
  uri=StringUtils.replace(uri,"{","%7B");
  uri=StringUtils.replace(uri,"}","%7D");
  return URI.create(uri);
}
