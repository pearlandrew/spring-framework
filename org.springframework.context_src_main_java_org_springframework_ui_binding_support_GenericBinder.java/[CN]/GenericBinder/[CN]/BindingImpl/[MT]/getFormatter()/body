{
  if (formatter != null) {
    return formatter;
  }
 else {
    Class<?> type=getValueType();
    Formatter<?> formatter=typeFormatters.get(type);
    if (formatter != null) {
      return formatter;
    }
 else {
      Annotation[] annotations=getAnnotations();
      for (      Annotation a : annotations) {
        AnnotationFormatterFactory factory=annotationFormatters.get(a.annotationType());
        if (factory != null) {
          return factory.getFormatter(a);
        }
      }
      return defaultFormatter;
    }
  }
}
