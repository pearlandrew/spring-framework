{
  if (this.sourceSet == null) {
    throw new IllegalArgumentException("'sourceSet' is required");
  }
  Set result=null;
  if (this.targetSetClass != null) {
    result=(Set)BeanUtils.instantiateClass(this.targetSetClass);
  }
 else {
    result=new LinkedHashSet(this.sourceSet.size());
  }
  Class valueType=null;
  if (this.targetSetClass != null) {
    valueType=GenericCollectionTypeResolver.getCollectionType(this.targetSetClass);
  }
  if (valueType != null) {
    TypeConverter converter=getBeanTypeConverter();
    for (Iterator it=this.sourceSet.iterator(); it.hasNext(); ) {
      result.add(converter.convertIfNecessary(it.next(),valueType));
    }
  }
 else {
    result.addAll(this.sourceSet);
  }
  return result;
}
