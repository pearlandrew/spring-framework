{
  mavContainer.setRequestHandled(true);
  if (returnValue == null) {
    return;
  }
  ServletServerHttpRequest inputMessage=createInputMessage(webRequest);
  ServletServerHttpResponse outputMessage=createOutputMessage(webRequest);
  Assert.isInstanceOf(HttpEntity.class,returnValue);
  HttpEntity<?> responseEntity=(HttpEntity<?>)returnValue;
  if (responseEntity instanceof ResponseEntity) {
    outputMessage.setStatusCode(((ResponseEntity<?>)responseEntity).getStatusCode());
  }
  HttpHeaders entityHeaders=responseEntity.getHeaders();
  Object body=responseEntity.getBody();
  if (responseEntity instanceof ResponseEntity) {
    for (    String headerName : entityHeaders.keySet()) {
      if (!HttpHeaders.LAST_MODIFIED.equals(headerName) && !HttpHeaders.ETAG.equals(headerName)) {
        outputMessage.getHeaders().put(headerName,entityHeaders.get(headerName));
      }
    }
    if (isResourceNotModified(webRequest,(ResponseEntity<?>)responseEntity)) {
      outputMessage.flush();
      return;
    }
  }
 else {
    if (!entityHeaders.isEmpty()) {
      outputMessage.getHeaders().putAll(entityHeaders);
    }
  }
  writeWithMessageConverters(body,returnType,inputMessage,outputMessage);
  outputMessage.flush();
}
