{
  HSSFWorkbook workbook;
  if (this.url != null) {
    workbook=getTemplateSource(this.url,request);
  }
 else {
    workbook=new HSSFWorkbook();
    logger.debug("Created Excel Workbook from scratch");
  }
  buildExcelDocument(model,workbook,request,response);
  response.setContentType(getContentType());
  ServletOutputStream out=response.getOutputStream();
  workbook.write(out);
  out.flush();
}
