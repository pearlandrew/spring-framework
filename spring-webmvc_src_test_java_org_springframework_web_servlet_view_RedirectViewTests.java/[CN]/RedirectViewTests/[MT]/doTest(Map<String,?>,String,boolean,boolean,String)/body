{
class TestRedirectView extends RedirectView {
    public boolean queryPropertiesCalled=false;
    /** 
 * Test whether this callback method is called with correct args
 */
    @Override protected Map<String,Object> queryProperties(    Map<String,Object> model){
      assertTrue("Map and model must be equal.",map.equals(model));
      this.queryPropertiesCalled=true;
      return super.queryProperties(model);
    }
  }
  TestRedirectView rv=new TestRedirectView();
  rv.setUrl(url);
  rv.setContextRelative(contextRelative);
  rv.setExposeModelAttributes(exposeModelAttributes);
  HttpServletRequest request=mock(HttpServletRequest.class,"request");
  if (exposeModelAttributes) {
    given(request.getCharacterEncoding()).willReturn(WebUtils.DEFAULT_CHARACTER_ENCODING);
  }
  if (contextRelative) {
    expectedUrlForEncoding="/context" + expectedUrlForEncoding;
    given(request.getContextPath()).willReturn("/context");
  }
  given(request.getAttribute(DispatcherServlet.OUTPUT_FLASH_MAP_ATTRIBUTE)).willReturn(new FlashMap());
  FlashMapManager flashMapManager=new SessionFlashMapManager();
  given(request.getAttribute(DispatcherServlet.FLASH_MAP_MANAGER_ATTRIBUTE)).willReturn(flashMapManager);
  HttpServletResponse response=mock(HttpServletResponse.class,"response");
  given(response.encodeRedirectURL(expectedUrlForEncoding)).willReturn(expectedUrlForEncoding);
  response.sendRedirect(expectedUrlForEncoding);
  rv.render(map,request,response);
  if (exposeModelAttributes) {
    assertTrue("queryProperties() should have been called.",rv.queryPropertiesCalled);
  }
}
