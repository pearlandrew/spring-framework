{
  this.handshakeHandler.setSupportedProtocols("stomp","mqtt");
  when(this.upgradeStrategy.getSupportedVersions()).thenReturn(new String[]{"13"});
  this.servletRequest.setMethod("GET");
  this.request.getHeaders().setUpgrade("WebSocket");
  this.request.getHeaders().setConnection("Upgrade");
  this.request.getHeaders().setSecWebSocketVersion("13");
  this.request.getHeaders().setSecWebSocketKey("82/ZS2YHjEnUN97HLL8tbw==");
  this.request.getHeaders().setSecWebSocketProtocol("STOMP");
  WebSocketHandler handler=new TextWebSocketHandlerAdapter();
  this.handshakeHandler.doHandshake(this.request,this.response,handler);
  verify(this.upgradeStrategy).upgrade(request,response,"STOMP",handler);
}
