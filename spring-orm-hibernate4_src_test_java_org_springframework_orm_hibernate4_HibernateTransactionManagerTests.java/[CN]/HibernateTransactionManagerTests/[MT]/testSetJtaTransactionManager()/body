{
  DataSource ds=mock(DataSource.class);
  TransactionManager tm=mock(TransactionManager.class);
  UserTransaction ut=mock(UserTransaction.class);
  TransactionSynchronizationRegistry tsr=mock(TransactionSynchronizationRegistry.class);
  JtaTransactionManager jtm=new JtaTransactionManager();
  jtm.setTransactionManager(tm);
  jtm.setUserTransaction(ut);
  jtm.setTransactionSynchronizationRegistry(tsr);
  LocalSessionFactoryBuilder lsfb=new LocalSessionFactoryBuilder(ds);
  lsfb.setJtaTransactionManager(jtm);
  Object jtaPlatform=lsfb.getProperties().get(AvailableSettings.JTA_PLATFORM);
  assertNotNull(jtaPlatform);
  assertSame(tm,jtaPlatform.getClass().getMethod("retrieveTransactionManager").invoke(jtaPlatform));
  assertSame(ut,jtaPlatform.getClass().getMethod("retrieveUserTransaction").invoke(jtaPlatform));
  assertTrue(lsfb.getProperties().get(AvailableSettings.TRANSACTION_STRATEGY) instanceof CMTTransactionFactory);
}
