{
  SQLException sex=new SQLException("foo","07xxx");
  ctrlConnection=MockControl.createControl(Connection.class);
  mockConnection=(Connection)ctrlConnection.getMock();
  ctrlConnection.replay();
  ctrlDataSource=MockControl.createControl(DataSource.class);
  mockDataSource=(DataSource)ctrlDataSource.getMock();
  mockDataSource.getConnection();
  ctrlDataSource.setThrowable(sex,2);
  ctrlDataSource.replay();
  try {
    JdbcTemplate template2=new JdbcTemplate();
    template2.setDataSource(mockDataSource);
    template2.setLazyInit(false);
    if (beanProperty) {
      template2.setExceptionTranslator(new SQLErrorCodeSQLExceptionTranslator(mockDataSource));
    }
 else {
      template2.afterPropertiesSet();
      template2.afterPropertiesSet();
    }
    RowCountCallbackHandler rcch=new RowCountCallbackHandler();
    template2.query("SELECT ID, FORENAME FROM CUSTMR WHERE ID < 3",rcch);
    fail("Shouldn't have executed query without a connection");
  }
 catch (  CannotGetJdbcConnectionException ex) {
    assertTrue("Check root cause",ex.getCause() == sex);
  }
  ctrlDataSource.verify();
  ctrlConnection.verify();
}
