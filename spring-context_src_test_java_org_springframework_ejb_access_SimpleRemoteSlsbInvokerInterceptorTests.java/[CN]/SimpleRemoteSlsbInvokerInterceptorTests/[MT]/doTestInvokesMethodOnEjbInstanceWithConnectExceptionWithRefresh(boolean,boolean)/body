{
  final RemoteInterface ejb=createMock(RemoteInterface.class);
  expect(ejb.targetMethod()).andThrow(new ConnectException("")).times(2);
  ejb.remove();
  expectLastCall().times(2);
  replay(ejb);
  int lookupCount=2;
  if (!cacheHome) {
    lookupCount++;
    if (lookupHomeOnStartup) {
      lookupCount++;
    }
  }
  final String jndiName="foobar";
  Context mockContext=mockContext(jndiName,ejb,2,lookupCount,lookupCount);
  SimpleRemoteSlsbInvokerInterceptor si=configuredInterceptor(mockContext,jndiName);
  si.setRefreshHomeOnConnectFailure(true);
  si.setLookupHomeOnStartup(lookupHomeOnStartup);
  si.setCacheHome(cacheHome);
  RemoteInterface target=(RemoteInterface)configuredProxy(si,RemoteInterface.class);
  try {
    target.targetMethod();
    fail("Should have thrown RemoteException");
  }
 catch (  ConnectException ex) {
  }
  verify(mockContext,ejb);
}
