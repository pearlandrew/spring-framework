{
  MockControl cfControl=MockControl.createControl(QueueConnectionFactory.class);
  QueueConnectionFactory cf=(QueueConnectionFactory)cfControl.getMock();
  MockControl conControl=MockControl.createControl(QueueConnection.class);
  QueueConnection con=(QueueConnection)conControl.getMock();
  MockControl txSessionControl=MockControl.createControl(QueueSession.class);
  QueueSession txSession=(QueueSession)txSessionControl.getMock();
  MockControl nonTxSessionControl=MockControl.createControl(QueueSession.class);
  QueueSession nonTxSession=(QueueSession)nonTxSessionControl.getMock();
  cf.createQueueConnection();
  cfControl.setReturnValue(con,1);
  con.createQueueSession(true,Session.AUTO_ACKNOWLEDGE);
  conControl.setReturnValue(txSession,1);
  txSession.getTransacted();
  txSessionControl.setReturnValue(true,2);
  txSession.rollback();
  txSessionControl.setVoidCallable(2);
  txSession.close();
  txSessionControl.setVoidCallable(1);
  con.createQueueSession(false,Session.CLIENT_ACKNOWLEDGE);
  conControl.setReturnValue(nonTxSession,1);
  nonTxSession.close();
  nonTxSessionControl.setVoidCallable(1);
  con.start();
  conControl.setVoidCallable(2);
  con.stop();
  conControl.setVoidCallable(1);
  con.close();
  conControl.setVoidCallable(1);
  cfControl.replay();
  conControl.replay();
  txSessionControl.replay();
  nonTxSessionControl.replay();
  CachingConnectionFactory scf=new CachingConnectionFactory(cf);
  scf.setReconnectOnException(false);
  Connection con1=scf.createQueueConnection();
  Session session1=con1.createSession(true,Session.AUTO_ACKNOWLEDGE);
  session1.rollback();
  session1.close();
  session1=con1.createSession(false,Session.CLIENT_ACKNOWLEDGE);
  session1.close();
  con1.start();
  con1.close();
  QueueConnection con2=scf.createQueueConnection();
  Session session2=con2.createQueueSession(false,Session.CLIENT_ACKNOWLEDGE);
  session2.close();
  session2=con2.createSession(true,Session.AUTO_ACKNOWLEDGE);
  session2.getTransacted();
  session2.close();
  con2.start();
  con2.close();
  scf.destroy();
  cfControl.verify();
  conControl.verify();
  txSessionControl.verify();
  nonTxSessionControl.verify();
}
