{
  MockControl cfControl=MockControl.createControl(ConnectionFactory.class);
  ConnectionFactory cf=(ConnectionFactory)cfControl.getMock();
  MockControl conControl=MockControl.createControl(Connection.class);
  Connection con=(Connection)conControl.getMock();
  ExceptionListener listener=new ChainedExceptionListener();
  cf.createConnection();
  cfControl.setReturnValue(con,1);
  con.setExceptionListener(listener);
  conControl.setVoidCallable(1);
  con.getExceptionListener();
  conControl.setReturnValue(listener,1);
  con.start();
  conControl.setVoidCallable(1);
  con.stop();
  conControl.setVoidCallable(1);
  con.close();
  conControl.setVoidCallable(1);
  cfControl.replay();
  conControl.replay();
  SingleConnectionFactory scf=new SingleConnectionFactory(cf);
  scf.setExceptionListener(listener);
  Connection con1=scf.createConnection();
  assertEquals(listener,con1.getExceptionListener());
  con1.start();
  con1.stop();
  con1.close();
  Connection con2=scf.createConnection();
  con2.start();
  con2.stop();
  con2.close();
  scf.destroy();
  cfControl.verify();
  conControl.verify();
}
