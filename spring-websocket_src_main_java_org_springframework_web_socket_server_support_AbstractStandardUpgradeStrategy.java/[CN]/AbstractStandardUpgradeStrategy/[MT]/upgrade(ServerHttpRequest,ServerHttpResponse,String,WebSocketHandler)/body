{
  HttpHeaders headers=request.getHeaders();
  InetSocketAddress localAddress=request.getLocalAddress();
  InetSocketAddress remoteAddress=request.getRemoteAddress();
  StandardWebSocketSession wsSession=new StandardWebSocketSession(headers,localAddress,remoteAddress);
  StandardWebSocketHandlerAdapter endpoint=new StandardWebSocketHandlerAdapter(wsHandler,wsSession);
  upgradeInternal(request,response,acceptedProtocol,endpoint);
}
