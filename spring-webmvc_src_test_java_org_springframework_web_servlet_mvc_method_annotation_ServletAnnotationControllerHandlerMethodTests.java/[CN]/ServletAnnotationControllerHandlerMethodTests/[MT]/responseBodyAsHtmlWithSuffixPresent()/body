{
  initServlet(new ApplicationContextInitializer<GenericWebApplicationContext>(){
    @Override public void initialize(    GenericWebApplicationContext wac){
      ContentNegotiationManagerFactoryBean factoryBean=new ContentNegotiationManagerFactoryBean();
      factoryBean.afterPropertiesSet();
      RootBeanDefinition adapterDef=new RootBeanDefinition(RequestMappingHandlerAdapter.class);
      adapterDef.getPropertyValues().add("contentNegotiationManager",factoryBean.getObject());
      wac.registerBeanDefinition("handlerAdapter",adapterDef);
    }
  }
,TextRestController.class);
  byte[] content="alert('boo')".getBytes(Charset.forName("ISO-8859-1"));
  MockHttpServletRequest request=new MockHttpServletRequest("GET","/a2.html");
  request.setContent(content);
  MockHttpServletResponse response=new MockHttpServletResponse();
  getServlet().service(request,response);
  assertEquals(200,response.getStatus());
  assertEquals("text/html",response.getContentType());
  assertNull(response.getHeader("Content-Disposition"));
  assertArrayEquals(content,response.getContentAsByteArray());
}
