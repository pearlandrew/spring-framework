{
  Assert.state(!isClosed(),"Cannot send a message when session is closed");
  if (!(message instanceof TextMessage)) {
    throw new IllegalArgumentException("Expected text message: " + message);
  }
  sendMessageInternal(((TextMessage)message).getPayload());
}
