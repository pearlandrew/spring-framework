{
  if (XMLStreamConstants.START_DOCUMENT == reader.getEventType()) {
    String xmlVersion=reader.getVersion();
    if (StringUtils.hasLength(xmlVersion)) {
      this.xmlVersion=xmlVersion;
    }
    this.encoding=reader.getCharacterEncodingScheme();
  }
  if (getContentHandler() != null) {
    final Location location=reader.getLocation();
    getContentHandler().setDocumentLocator(new Locator2(){
      @Override public int getColumnNumber(){
        return location != null ? location.getColumnNumber() : -1;
      }
      @Override public int getLineNumber(){
        return location != null ? location.getLineNumber() : -1;
      }
      @Override public String getPublicId(){
        return location != null ? location.getPublicId() : null;
      }
      @Override public String getSystemId(){
        return location != null ? location.getSystemId() : null;
      }
      @Override public String getXMLVersion(){
        return xmlVersion;
      }
      @Override public String getEncoding(){
        return encoding;
      }
    }
);
    getContentHandler().startDocument();
    if (reader.standaloneSet()) {
      setStandalone(reader.isStandalone());
    }
  }
}
