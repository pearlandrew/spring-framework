{
  List<M> messages=new ArrayList<M>();
  this.messageQueue.drainTo(messages);
  for (  Message<?> message : messages) {
    StompHeaders headers=StompHeaders.fromMessageHeaders(message.getHeaders());
    if (!forwardInternal(message,headers,connection)) {
      return;
    }
  }
}
