{
synchronized (this.monitor) {
    if (!this.isConnected) {
      if (logger.isTraceEnabled()) {
        logger.trace("Adding to queue message " + message + ", queue size="+ this.messageQueue.size());
      }
      this.messageQueue.add(message);
      return;
    }
  }
  TcpConnection<String,String> connection=this.promise.get();
  if (this.messageQueue.isEmpty()) {
    forwardInternal(message,headers,connection);
  }
 else {
    this.messageQueue.add(message);
    flushMessages(connection);
  }
}
