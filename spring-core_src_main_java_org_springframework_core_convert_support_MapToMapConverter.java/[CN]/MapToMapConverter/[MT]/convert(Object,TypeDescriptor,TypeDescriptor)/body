{
  if (source == null) {
    return null;
  }
  boolean copyRequired=!targetType.getType().isInstance(source);
  Map<Object,Object> sourceMap=(Map<Object,Object>)source;
  if (!copyRequired && sourceMap.isEmpty()) {
    return sourceMap;
  }
  List<MapEntry> targetEntries=new ArrayList<MapEntry>(sourceMap.size());
  for (  Map.Entry<Object,Object> entry : sourceMap.entrySet()) {
    Object sourceKey=entry.getKey();
    Object sourceValue=entry.getValue();
    Object targetKey=convertKey(sourceKey,sourceType,targetType.getMapKeyTypeDescriptor());
    Object targetValue=convertValue(sourceValue,sourceType,targetType.getMapValueTypeDescriptor());
    targetEntries.add(new MapEntry(targetKey,targetValue));
    if (sourceKey != targetKey || sourceValue != targetValue) {
      copyRequired=true;
    }
  }
  if (!copyRequired) {
    return sourceMap;
  }
  Map<Object,Object> targetMap=CollectionFactory.createMap(targetType.getType(),sourceMap.size());
  for (  MapEntry entry : targetEntries) {
    entry.addToMap(targetMap);
  }
  return targetMap;
}
