{
  try {
    Class<?> registryClass=ClassUtils.forName(TRANSACTION_SYNCHRONIZATION_REGISTRY_CLASS_NAME,JtaTransactionManager.class.getClassLoader());
    if (this.userTransactionObtainedFromJndi) {
      String jndiName=DEFAULT_TRANSACTION_SYNCHRONIZATION_REGISTRY_NAME;
      try {
        Object tsr=getJndiTemplate().lookup(jndiName,registryClass);
        if (logger.isDebugEnabled()) {
          logger.debug("JTA TransactionSynchronizationRegistry found at default JNDI location [" + jndiName + "]");
        }
        return tsr;
      }
 catch (      NamingException ex) {
        if (logger.isDebugEnabled()) {
          logger.debug("No JTA TransactionSynchronizationRegistry found at default JNDI location [" + jndiName + "]",ex);
        }
      }
    }
    if (registryClass.isInstance(ut)) {
      return ut;
    }
    if (registryClass.isInstance(tm)) {
      return tm;
    }
    return null;
  }
 catch (  ClassNotFoundException ex) {
    logger.debug("JTA 1.1 [" + TRANSACTION_SYNCHRONIZATION_REGISTRY_CLASS_NAME + "] not available");
    return null;
  }
}
