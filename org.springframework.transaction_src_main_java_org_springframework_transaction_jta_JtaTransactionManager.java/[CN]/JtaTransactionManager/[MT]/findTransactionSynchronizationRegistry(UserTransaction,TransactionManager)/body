{
  if (transactionSynchronizationRegistryClass == null) {
    if (logger.isDebugEnabled()) {
      logger.debug("JTA 1.1 [" + TRANSACTION_SYNCHRONIZATION_REGISTRY_CLASS_NAME + "] API not available");
    }
    return null;
  }
  if (this.userTransactionObtainedFromJndi) {
    String jndiName=DEFAULT_TRANSACTION_SYNCHRONIZATION_REGISTRY_NAME;
    try {
      Object tsr=getJndiTemplate().lookup(jndiName,transactionSynchronizationRegistryClass);
      if (logger.isDebugEnabled()) {
        logger.debug("JTA TransactionSynchronizationRegistry found at default JNDI location [" + jndiName + "]");
      }
      return tsr;
    }
 catch (    NamingException ex) {
      if (logger.isDebugEnabled()) {
        logger.debug("No JTA TransactionSynchronizationRegistry found at default JNDI location [" + jndiName + "]",ex);
      }
    }
  }
  if (transactionSynchronizationRegistryClass.isInstance(ut)) {
    return ut;
  }
  if (transactionSynchronizationRegistryClass.isInstance(tm)) {
    return tm;
  }
  return null;
}
