{
  MockActionRequest request=new MockActionRequest();
  MockActionResponse response=new MockActionResponse();
  request.setPortletMode(PortletMode.EDIT);
  ComplexPortletApplicationContext.MockMultipartResolver multipartResolver=(ComplexPortletApplicationContext.MockMultipartResolver)complexDispatcherPortlet.getPortletApplicationContext().getBean("portletMultipartResolver");
  MultipartActionRequest multipartRequest=multipartResolver.resolveMultipart(request);
  complexDispatcherPortlet.processAction(multipartRequest,response);
  multipartResolver.cleanupMultipart(multipartRequest);
  assertNotNull(request.getAttribute("cleanedUp"));
}
