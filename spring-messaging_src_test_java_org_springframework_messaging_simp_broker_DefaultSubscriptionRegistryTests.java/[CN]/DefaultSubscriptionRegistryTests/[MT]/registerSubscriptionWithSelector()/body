{
  String sessionId="sess01";
  String subscriptionId="subs01";
  String destination="/foo";
  String selector="headers.foo == 'bar'";
  this.registry.registerSubscription(subscribeMessage(sessionId,subscriptionId,destination,selector));
  SimpMessageHeaderAccessor accessor=SimpMessageHeaderAccessor.create();
  accessor.setDestination(destination);
  accessor.setNativeHeader("foo","bar");
  Message<?> message=MessageBuilder.createMessage("",accessor.getMessageHeaders());
  MultiValueMap<String,String> actual=this.registry.findSubscriptions(message);
  assertEquals(1,actual.size());
  assertEquals(Arrays.asList(subscriptionId),actual.get(sessionId));
  accessor=SimpMessageHeaderAccessor.create();
  accessor.setDestination(destination);
  message=MessageBuilder.createMessage("",accessor.getMessageHeaders());
  assertEquals(0,this.registry.findSubscriptions(message).size());
}
