{
  String sess1="sess01";
  String sess2="sess02";
  String subs1="subs01";
  String subs2="subs02";
  String subs3="subs03";
  String destNasdaqIbm="/topic/PRICE.STOCK.NASDAQ.IBM";
  Message<?> destNasdaqIbmMessage=createMessage(destNasdaqIbm);
  this.registry.registerSubscription(subscribeMessage(sess1,subs2,destNasdaqIbm));
  this.registry.registerSubscription(subscribeMessage(sess1,subs1,"/topic/PRICE.STOCK.*.IBM"));
  MultiValueMap<String,String> actual=this.registry.findSubscriptions(destNasdaqIbmMessage);
  assertNotNull(actual);
  assertEquals(1,actual.size());
  assertEquals(Arrays.asList(subs2,subs1),actual.get(sess1));
  this.registry.registerSubscription(subscribeMessage(sess2,subs1,destNasdaqIbm));
  this.registry.registerSubscription(subscribeMessage(sess2,subs2,"/topic/PRICE.STOCK.NYSE.IBM"));
  this.registry.registerSubscription(subscribeMessage(sess2,subs3,"/topic/PRICE.STOCK.NASDAQ.GOOG"));
  actual=this.registry.findSubscriptions(destNasdaqIbmMessage);
  assertNotNull(actual);
  assertEquals(2,actual.size());
  assertEquals(Arrays.asList(subs2,subs1),actual.get(sess1));
  assertEquals(Collections.singletonList(subs1),actual.get(sess2));
  this.registry.unregisterAllSubscriptions(sess1);
  actual=this.registry.findSubscriptions(destNasdaqIbmMessage);
  assertNotNull(actual);
  assertEquals(1,actual.size());
  assertEquals(Collections.singletonList(subs1),actual.get(sess2));
  this.registry.registerSubscription(subscribeMessage(sess1,subs1,"/topic/PRICE.STOCK.*.IBM"));
  this.registry.registerSubscription(subscribeMessage(sess1,subs2,destNasdaqIbm));
  actual=this.registry.findSubscriptions(destNasdaqIbmMessage);
  assertNotNull(actual);
  assertEquals(2,actual.size());
  assertEquals(Arrays.asList(subs1,subs2),actual.get(sess1));
  assertEquals(Collections.singletonList(subs1),actual.get(sess2));
  this.registry.unregisterSubscription(unsubscribeMessage(sess1,subs2));
  actual=this.registry.findSubscriptions(destNasdaqIbmMessage);
  assertNotNull(actual);
  assertEquals(2,actual.size());
  assertEquals(Collections.singletonList(subs1),actual.get(sess1));
  assertEquals(Collections.singletonList(subs1),actual.get(sess2));
  this.registry.unregisterSubscription(unsubscribeMessage(sess1,subs1));
  actual=this.registry.findSubscriptions(destNasdaqIbmMessage);
  assertNotNull(actual);
  assertEquals(1,actual.size());
  assertEquals(Collections.singletonList(subs1),actual.get(sess2));
  this.registry.unregisterSubscription(unsubscribeMessage(sess2,subs1));
  actual=this.registry.findSubscriptions(destNasdaqIbmMessage);
  assertNotNull(actual);
  assertEquals(0,actual.size());
}
