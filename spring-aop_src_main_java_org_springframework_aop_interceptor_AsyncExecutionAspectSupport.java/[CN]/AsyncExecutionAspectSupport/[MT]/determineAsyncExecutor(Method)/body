{
  AsyncTaskExecutor executor=this.executors.get(method);
  if (executor == null) {
    Executor executorToUse=this.defaultExecutor;
    String qualifier=getExecutorQualifier(method);
    if (StringUtils.hasLength(qualifier)) {
      if (this.beanFactory == null) {
        throw new IllegalStateException("BeanFactory must be set on " + getClass().getSimpleName() + " to access qualified executor '"+ qualifier+ "'");
      }
      executorToUse=BeanFactoryAnnotationUtils.qualifiedBeanOfType(this.beanFactory,Executor.class,qualifier);
    }
 else     if (executorToUse == null) {
      return null;
    }
    executor=(executorToUse instanceof AsyncListenableTaskExecutor ? (AsyncListenableTaskExecutor)executorToUse : new TaskExecutorAdapter(executorToUse));
    this.executors.put(method,executor);
  }
  return executor;
}
