{
  if (!ObjectUtils.isEmpty(headers)) {
    for (    String header : headers) {
      int separator=header.indexOf('=');
      if (separator == -1) {
        if (header.startsWith("!")) {
          if (hasHeader(request,header.substring(1))) {
            return false;
          }
        }
 else         if (!hasHeader(request,header)) {
          return false;
        }
      }
 else {
        String key=header.substring(0,separator);
        String value=header.substring(separator + 1);
        if (isMediaTypeHeader(key)) {
          List<MediaType> requestMediaTypes=MediaType.parseMediaTypes(request.getHeader(key));
          List<MediaType> valueMediaTypes=MediaType.parseMediaTypes(value);
          boolean found=false;
          for (Iterator<MediaType> valIter=valueMediaTypes.iterator(); valIter.hasNext() && !found; ) {
            MediaType valueMediaType=valIter.next();
            for (Iterator<MediaType> reqIter=requestMediaTypes.iterator(); reqIter.hasNext() && !found; ) {
              MediaType requestMediaType=reqIter.next();
              if (valueMediaType.includes(requestMediaType)) {
                found=true;
              }
            }
          }
          if (!found) {
            return false;
          }
        }
 else         if (!value.equals(request.getHeader(key))) {
          return false;
        }
      }
    }
  }
  return true;
}
