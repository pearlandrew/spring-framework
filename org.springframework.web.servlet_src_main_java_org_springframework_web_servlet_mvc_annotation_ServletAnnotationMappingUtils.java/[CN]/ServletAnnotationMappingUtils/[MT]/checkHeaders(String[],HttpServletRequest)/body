{
  if (!ObjectUtils.isEmpty(headers)) {
    for (    String header : headers) {
      int separator=header.indexOf('=');
      if (separator == -1) {
        if (header.startsWith("!")) {
          if (request.getHeader(header.substring(1)) != null) {
            return false;
          }
        }
 else         if (request.getHeader(header) == null) {
          return false;
        }
      }
 else {
        boolean negated=separator > 0 && header.charAt(separator - 1) == '!';
        String key=!negated ? header.substring(0,separator) : header.substring(0,separator - 1);
        String value=header.substring(separator + 1);
        if (isMediaTypeHeader(key)) {
          List<MediaType> requestMediaTypes=MediaType.parseMediaTypes(request.getHeader(key));
          List<MediaType> valueMediaTypes=MediaType.parseMediaTypes(value);
          boolean found=false;
          for (Iterator<MediaType> valIter=valueMediaTypes.iterator(); valIter.hasNext() && !found; ) {
            MediaType valueMediaType=valIter.next();
            for (Iterator<MediaType> reqIter=requestMediaTypes.iterator(); reqIter.hasNext() && !found; ) {
              MediaType requestMediaType=reqIter.next();
              if (valueMediaType.includes(requestMediaType)) {
                found=true;
              }
            }
          }
          if (negated) {
            found=!found;
          }
          if (!found) {
            return false;
          }
        }
 else {
          boolean match=value.equals(request.getHeader(key));
          if (negated) {
            match=!match;
          }
          if (!match) {
            return false;
          }
        }
      }
    }
  }
  return true;
}
