{
  Assert.notNull(registry,"BeanDefinitionRegistry must not be null");
  if (registry.containsBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME)) {
    BeanDefinition apcDefinition=registry.getBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME);
    if (!cls.getName().equals(apcDefinition.getBeanClassName())) {
      int currentPriority=findPriorityForClass(apcDefinition.getBeanClassName());
      int requiredPriority=findPriorityForClass(cls.getName());
      if (currentPriority < requiredPriority) {
        apcDefinition.setBeanClassName(cls.getName());
      }
    }
    return null;
  }
  RootBeanDefinition beanDefinition=new RootBeanDefinition(cls);
  beanDefinition.setSource(source);
  beanDefinition.getPropertyValues().addPropertyValue("order",new Integer(Ordered.HIGHEST_PRECEDENCE));
  beanDefinition.setRole(BeanDefinition.ROLE_INFRASTRUCTURE);
  registry.registerBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME,beanDefinition);
  return beanDefinition;
}
