{
  Class<?> handlerType=(handler instanceof String) ? this.applicationContext.getType((String)handler) : handler.getClass();
  final Class<?> userType=ClassUtils.getUserClass(handlerType);
  Set<Method> methods=HandlerMethodSelector.selectMethods(userType,new MethodFilter(){
    @Override public boolean matches(    Method method){
      return AnnotationUtils.findAnnotation(method,MessageMapping.class) != null;
    }
  }
);
  for (  Method method : methods) {
    MessageMapping mapping=AnnotationUtils.findAnnotation(method,MessageMapping.class);
    HandlerMethod handlerMethod=createHandlerMethod(handler,method);
    this.handlerMethods.put(mapping,handlerMethod);
  }
}
