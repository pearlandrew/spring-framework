{
  if (isRequestActive()) {
    return this.request.getSession(allowCreate);
  }
 else {
    if (this.session == null && allowCreate) {
      throw new IllegalStateException("No session found and request already completed - cannot create new session!");
    }
    return this.session;
  }
}
