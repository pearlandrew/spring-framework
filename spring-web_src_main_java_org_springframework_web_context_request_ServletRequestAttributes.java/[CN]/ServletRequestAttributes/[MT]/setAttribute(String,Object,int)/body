{
  if (scope == SCOPE_REQUEST) {
    if (!isRequestActive()) {
      throw new IllegalStateException("Cannot set request attribute - request is not active anymore!");
    }
    this.request.setAttribute(name,value);
  }
 else {
    HttpSession session=getSession(true);
synchronized (this.sessionAttributesToUpdate) {
      this.sessionAttributesToUpdate.remove(name);
    }
    session.setAttribute(name,value);
  }
}
