{
  if (logger.isDebugEnabled()) {
    logger.debug("DispatcherPortlet with name '" + getPortletName() + "' received render request");
  }
  HandlerExecutionChain mappedHandler=null;
  int interceptorIndex=-1;
  try {
    ModelAndView mv;
    try {
      mappedHandler=getHandler(request);
      if (mappedHandler == null || mappedHandler.getHandler() == null) {
        noHandlerFound(request,response);
        return;
      }
      HandlerInterceptor[] interceptors=mappedHandler.getInterceptors();
      if (interceptors != null) {
        for (int i=0; i < interceptors.length; i++) {
          HandlerInterceptor interceptor=interceptors[i];
          if (!interceptor.preHandleRender(request,response,mappedHandler.getHandler())) {
            triggerAfterRenderCompletion(mappedHandler,interceptorIndex,request,response,null);
            return;
          }
          interceptorIndex=i;
        }
      }
      PortletSession session=request.getPortletSession(false);
      if (session != null) {
        if (request.getParameter(ACTION_EXCEPTION_RENDER_PARAMETER) != null) {
          Exception ex=(Exception)session.getAttribute(ACTION_EXCEPTION_SESSION_ATTRIBUTE);
          if (ex != null) {
            logger.debug("Render phase found exception caught during action phase - rethrowing it");
            throw ex;
          }
        }
 else {
          session.removeAttribute(ACTION_EXCEPTION_SESSION_ATTRIBUTE);
        }
      }
      HandlerAdapter ha=getHandlerAdapter(mappedHandler.getHandler());
      mv=ha.handleRender(request,response,mappedHandler.getHandler());
      if (interceptors != null) {
        for (int i=interceptors.length - 1; i >= 0; i--) {
          HandlerInterceptor interceptor=interceptors[i];
          interceptor.postHandleRender(request,response,mappedHandler.getHandler(),mv);
        }
      }
    }
 catch (    ModelAndViewDefiningException ex) {
      logger.debug("ModelAndViewDefiningException encountered",ex);
      mv=ex.getModelAndView();
    }
catch (    Exception ex) {
      Object handler=(mappedHandler != null ? mappedHandler.getHandler() : null);
      mv=processHandlerException(request,response,handler,ex);
    }
    if (mv != null && !mv.isEmpty()) {
      render(mv,request,response);
    }
 else {
      if (logger.isDebugEnabled()) {
        logger.debug("Null ModelAndView returned to DispatcherPortlet with name '" + getPortletName() + "': assuming HandlerAdapter completed request handling");
      }
    }
    triggerAfterRenderCompletion(mappedHandler,interceptorIndex,request,response,null);
  }
 catch (  Exception ex) {
    triggerAfterRenderCompletion(mappedHandler,interceptorIndex,request,response,ex);
    throw ex;
  }
catch (  Throwable err) {
    PortletException ex=new PortletException("Error occured during request processing: " + err.getMessage(),err);
    triggerAfterRenderCompletion(mappedHandler,interceptorIndex,request,response,ex);
    throw ex;
  }
}
