{
  if (classValuesAsString) {
    if (value instanceof Class) {
      value=((Class<?>)value).getName();
    }
 else     if (value instanceof Class[]) {
      Class<?>[] clazzArray=(Class[])value;
      String[] newValue=new String[clazzArray.length];
      for (int i=0; i < clazzArray.length; i++) {
        newValue[i]=clazzArray[i].getName();
      }
      value=newValue;
    }
  }
  if (nestedAnnotationsAsMap && value instanceof Annotation) {
    return getAnnotationAttributes((Annotation)value,classValuesAsString,true);
  }
 else   if (nestedAnnotationsAsMap && value instanceof Annotation[]) {
    Annotation[] realAnnotations=(Annotation[])value;
    AnnotationAttributes[] mappedAnnotations=new AnnotationAttributes[realAnnotations.length];
    for (int i=0; i < realAnnotations.length; i++) {
      mappedAnnotations[i]=getAnnotationAttributes(realAnnotations[i],classValuesAsString,true);
    }
    return mappedAnnotations;
  }
 else {
    return value;
  }
}
