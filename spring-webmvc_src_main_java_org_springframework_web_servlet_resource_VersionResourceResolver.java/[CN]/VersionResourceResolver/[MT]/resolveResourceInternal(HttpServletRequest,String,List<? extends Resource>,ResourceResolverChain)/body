{
  Resource resolved=chain.resolveResource(request,requestPath,locations);
  if (resolved != null) {
    return resolved;
  }
  VersionStrategy versionStrategy=getStrategyForPath(requestPath);
  if (versionStrategy == null) {
    return null;
  }
  String candidateVersion=versionStrategy.extractVersion(requestPath);
  if (StringUtils.isEmpty(candidateVersion)) {
    if (logger.isTraceEnabled()) {
      logger.trace("No version found in path=\"" + requestPath + "\"");
    }
    return null;
  }
  String simplePath=versionStrategy.removeVersion(requestPath,candidateVersion);
  if (logger.isTraceEnabled()) {
    logger.trace("Extracted version from path, re-resolving without version, path=\"" + simplePath + "\"");
  }
  Resource baseResource=chain.resolveResource(request,simplePath,locations);
  if (baseResource == null) {
    return null;
  }
  String actualVersion=versionStrategy.getResourceVersion(baseResource);
  if (candidateVersion.equals(actualVersion)) {
    if (logger.isTraceEnabled()) {
      logger.trace("resource matches extracted version");
    }
    if (request != null) {
      request.setAttribute(VersionResourceResolver.RESOURCE_VERSION_ATTRIBUTE,candidateVersion);
    }
    return baseResource;
  }
 else {
    if (logger.isTraceEnabled()) {
      logger.trace("Potential resource found for [" + requestPath + "], but version ["+ candidateVersion+ "] doesn't match.");
    }
    return null;
  }
}
