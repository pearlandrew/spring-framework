{
  try {
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    while (!session.getSocket().isClosed()) {
      int b=session.getInputStream().read();
      if (b == -1) {
        break;
      }
 else       if (b == 0x00) {
        byte[] bytes=out.toByteArray();
        StompMessage message=RelayStompService.this.messageConverter.toStompMessage(bytes);
        getReactor().notify(replyTo,Event.wrap(message));
        out.reset();
      }
 else {
        out.write(b);
      }
    }
    logger.debug("Socket closed, STOMP session=" + stompSessionId);
    sendErrorMessage("Lost connection");
  }
 catch (  IOException e) {
    logger.error("Socket error: " + e.getMessage());
    clearRelaySession(stompSessionId);
  }
}
