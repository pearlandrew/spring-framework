{
  DeferredResultHandler handler=createMock(DeferredResultHandler.class);
  handler.handleResult("hello");
  expectLastCall().andThrow(new IllegalStateException());
  replay(handler);
  DeferredResult<String> result=new DeferredResult<String>();
  result.setResultHandler(handler);
  assertFalse(result.setResult("hello"));
  verify(handler);
}
