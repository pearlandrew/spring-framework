{
  View view;
  if (mv.isReference()) {
    view=resolveViewName(mv.getViewName(),mv.getModelInternal(),request);
    if (view == null) {
      throw new PortletException("Could not resolve view with name '" + mv.getViewName() + "' in portlet with name '"+ getPortletName()+ "'");
    }
  }
 else {
    Object viewObject=mv.getView();
    if (viewObject == null) {
      throw new PortletException("ModelAndView [" + mv + "] neither contains a view name nor a "+ "View object in portlet with name '"+ getPortletName()+ "'");
    }
    if (!(viewObject instanceof View)) {
      throw new PortletException("View object [" + viewObject + "] is not an instance of [org.springframework.web.servlet.View] - "+ "DispatcherPortlet does not support any other view types");
    }
    view=(View)viewObject;
  }
  if (response.getContentType() != null) {
    if (logger.isDebugEnabled()) {
      logger.debug("Portlet response content type already set to [" + response.getContentType() + "]");
    }
  }
 else {
    String contentType=view.getContentType();
    if (contentType != null) {
      if (logger.isDebugEnabled()) {
        logger.debug("Setting portlet response content type to view-determined type [" + contentType + "]");
      }
      response.setContentType(contentType);
    }
  }
  doRender(view,mv.getModelInternal(),request,response);
}
