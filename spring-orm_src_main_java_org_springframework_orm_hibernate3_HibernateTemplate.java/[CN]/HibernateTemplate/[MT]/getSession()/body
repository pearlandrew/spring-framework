{
  if (isAlwaysUseNewSession()) {
    return SessionFactoryUtils.getNewSession(getSessionFactory(),getEntityInterceptor());
  }
 else   if (isAllowCreate()) {
    return SessionFactoryUtils.getSession(getSessionFactory(),getEntityInterceptor(),getJdbcExceptionTranslator());
  }
 else   if (SessionFactoryUtils.hasTransactionalSession(getSessionFactory())) {
    return SessionFactoryUtils.getSession(getSessionFactory(),false);
  }
 else {
    try {
      return getSessionFactory().getCurrentSession();
    }
 catch (    HibernateException ex) {
      throw new DataAccessResourceFailureException("Could not obtain current Hibernate Session",ex);
    }
  }
}
