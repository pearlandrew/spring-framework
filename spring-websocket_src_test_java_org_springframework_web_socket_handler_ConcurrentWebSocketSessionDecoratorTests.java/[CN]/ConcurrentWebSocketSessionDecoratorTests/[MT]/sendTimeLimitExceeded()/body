{
  BlockingSession blockingSession=new BlockingSession();
  blockingSession.setOpen(true);
  CountDownLatch sentMessageLatch=blockingSession.getSentMessageLatch();
  int sendTimeLimit=100;
  int bufferSizeLimit=1024;
  final ConcurrentWebSocketSessionDecorator concurrentSession=new ConcurrentWebSocketSessionDecorator(blockingSession,sendTimeLimit,bufferSizeLimit);
  Executors.newSingleThreadExecutor().submit(new Runnable(){
    @Override public void run(){
      TextMessage textMessage=new TextMessage("slow message");
      try {
        concurrentSession.sendMessage(textMessage);
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
  }
);
  assertTrue(sentMessageLatch.await(5,TimeUnit.SECONDS));
  Thread.sleep(sendTimeLimit + 100);
  try {
    TextMessage payload=new TextMessage("payload");
    concurrentSession.sendMessage(payload);
    fail("Expected exception");
  }
 catch (  SessionLimitExceededException ex) {
  }
}
