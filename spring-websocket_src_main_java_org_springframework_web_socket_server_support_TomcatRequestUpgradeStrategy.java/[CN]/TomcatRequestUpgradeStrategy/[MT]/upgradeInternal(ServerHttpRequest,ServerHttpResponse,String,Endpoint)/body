{
  Assert.isTrue(request instanceof ServletServerHttpRequest);
  HttpServletRequest servletRequest=((ServletServerHttpRequest)request).getServletRequest();
  Assert.isTrue(response instanceof ServletServerHttpResponse);
  HttpServletResponse servletResponse=((ServletServerHttpResponse)response).getServletResponse();
  String path=servletRequest.getRequestURI();
  Map<String,String> pathParams=Collections.<String,String>emptyMap();
  ServerEndpointRegistration endpointConfig=new ServerEndpointRegistration(path,endpoint);
  endpointConfig.setSubprotocols(Arrays.asList(acceptedProtocol));
  try {
    getContainer(servletRequest).doUpgrade(servletRequest,servletResponse,endpointConfig,pathParams);
  }
 catch (  Exception ex) {
    throw new HandshakeFailureException("Failed to upgrade HttpServletRequest",ex);
  }
}
