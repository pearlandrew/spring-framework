{
  Assert.isTrue(request instanceof ServletServerHttpRequest);
  HttpServletRequest servletRequest=((ServletServerHttpRequest)request).getServletRequest();
  Assert.isTrue(response instanceof ServletServerHttpResponse);
  HttpServletResponse servletResponse=((ServletServerHttpResponse)response).getServletResponse();
  if (hasDoUpgrade) {
    doUpgrade(servletRequest,servletResponse,acceptedProtocol,endpoint);
  }
 else {
    upgradeTomcat80RC1(servletRequest,acceptedProtocol,endpoint);
  }
}
