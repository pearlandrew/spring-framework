{
  SubProtocolHandler protocolHandler=findProtocolHandler(session);
  protocolHandler.handleMessageFromClient(session,message,this.clientInboundChannel);
  WebSocketSessionHolder holder=this.sessions.get(session.getId());
  if (holder != null) {
    holder.setHasHandledMessages();
  }
 else {
    throw new IllegalStateException("Session not found: " + session);
  }
  checkSessions();
}
