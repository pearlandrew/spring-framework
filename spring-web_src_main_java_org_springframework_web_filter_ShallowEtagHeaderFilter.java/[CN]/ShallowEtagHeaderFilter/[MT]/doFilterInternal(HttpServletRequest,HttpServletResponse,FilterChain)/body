{
  WebAsyncManager asyncManager=WebAsyncUtils.getAsyncManager(request);
  boolean isFirstRequest=!asyncManager.hasConcurrentResult();
  if (isFirstRequest) {
    response=new ShallowEtagResponseWrapper(response);
  }
  filterChain.doFilter(request,response);
  if (!asyncManager.isConcurrentHandlingStarted()) {
    updateResponse(request,response);
  }
}
