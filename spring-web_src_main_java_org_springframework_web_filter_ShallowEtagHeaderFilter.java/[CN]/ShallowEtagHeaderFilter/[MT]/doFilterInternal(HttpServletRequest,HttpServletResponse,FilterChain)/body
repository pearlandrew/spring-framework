{
  boolean isFirstRequest=!isAsyncDispatch(request);
  if (isFirstRequest) {
    response=new ShallowEtagResponseWrapper(response);
  }
  filterChain.doFilter(request,response);
  if (isLastRequestThread(request)) {
    updateResponse(request,response);
  }
}
