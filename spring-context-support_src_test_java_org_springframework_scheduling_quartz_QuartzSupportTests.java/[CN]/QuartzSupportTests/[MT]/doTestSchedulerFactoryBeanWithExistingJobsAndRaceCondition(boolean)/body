{
  TestBean tb=new TestBean("tb",99);
  JobDetailBean jobDetail0=new JobDetailBean();
  jobDetail0.setJobClass(Job.class);
  jobDetail0.setBeanName("myJob0");
  Map jobData=new HashMap();
  jobData.put("testBean",tb);
  jobDetail0.setJobDataAsMap(jobData);
  jobDetail0.afterPropertiesSet();
  assertEquals(tb,jobDetail0.getJobDataMap().get("testBean"));
  CronTriggerBean trigger0=new CronTriggerBean();
  trigger0.setBeanName("myTrigger0");
  trigger0.setJobDetail(jobDetail0);
  trigger0.setCronExpression("0/1 * * * * ?");
  trigger0.afterPropertiesSet();
  TestMethodInvokingTask task1=new TestMethodInvokingTask();
  MethodInvokingJobDetailFactoryBean mijdfb=new MethodInvokingJobDetailFactoryBean();
  mijdfb.setBeanName("myJob1");
  mijdfb.setTargetObject(task1);
  mijdfb.setTargetMethod("doSomething");
  mijdfb.afterPropertiesSet();
  JobDetail jobDetail1=mijdfb.getObject();
  SimpleTriggerBean trigger1=new SimpleTriggerBean();
  trigger1.setBeanName("myTrigger1");
  trigger1.setJobDetail(jobDetail1);
  trigger1.setStartDelay(0);
  trigger1.setRepeatInterval(20);
  trigger1.afterPropertiesSet();
  final Scheduler scheduler=mock(Scheduler.class);
  given(scheduler.getContext()).willReturn(new SchedulerContext());
  given(scheduler.getTrigger("myTrigger1",Scheduler.DEFAULT_GROUP)).willReturn(new SimpleTrigger());
  if (overwrite) {
    given(scheduler.rescheduleJob("myTrigger1",Scheduler.DEFAULT_GROUP,trigger1)).willReturn(new Date());
  }
  given(scheduler.scheduleJob(trigger0)).willThrow(new ObjectAlreadyExistsException(""));
  if (overwrite) {
    given(scheduler.rescheduleJob("myTrigger0",Scheduler.DEFAULT_GROUP,trigger0)).willReturn(new Date());
  }
  SchedulerFactoryBean schedulerFactoryBean=new SchedulerFactoryBean(){
    @Override protected Scheduler createScheduler(    SchedulerFactory schedulerFactory,    String schedulerName){
      return scheduler;
    }
  }
;
  schedulerFactoryBean.setJobFactory(null);
  Map schedulerContext=new HashMap();
  schedulerContext.put("otherTestBean",tb);
  schedulerFactoryBean.setSchedulerContextAsMap(schedulerContext);
  schedulerFactoryBean.setTriggers(new Trigger[]{trigger0,trigger1});
  if (overwrite) {
    schedulerFactoryBean.setOverwriteExistingJobs(true);
  }
  try {
    schedulerFactoryBean.afterPropertiesSet();
    schedulerFactoryBean.start();
  }
  finally {
    schedulerFactoryBean.destroy();
  }
  verify(scheduler).getTrigger("myTrigger0",Scheduler.DEFAULT_GROUP);
  verify(scheduler).getTrigger("myTrigger1",Scheduler.DEFAULT_GROUP);
  if (overwrite) {
    verify(scheduler).addJob(jobDetail1,true);
    verify(scheduler).rescheduleJob("myTrigger1",Scheduler.DEFAULT_GROUP,trigger1);
  }
 else {
    verify(scheduler).getJobDetail("myJob0",Scheduler.DEFAULT_GROUP);
  }
  verify(scheduler).addJob(jobDetail0,true);
  verify(scheduler).start();
  verify(scheduler).shutdown(false);
}
