{
  int port=SocketUtils.findAvailableTcpPort();
  jettyServer=new Server(port);
  baseUrl="http://localhost:" + port;
  ServletContextHandler handler=new ServletContextHandler();
  byte[] bytes=helloWorld.getBytes("UTF-8");
  textContentType=new MediaType("text","plain",Collections.singletonMap("charset","UTF-8"));
  jsonContentType=new MediaType("application","json",Collections.singletonMap("charset","UTF-8"));
  handler.addServlet(new ServletHolder(new GetServlet(bytes,textContentType)),"/get");
  handler.addServlet(new ServletHolder(new GetServlet(new byte[0],textContentType)),"/get/nothing");
  handler.addServlet(new ServletHolder(new GetServlet(bytes,null)),"/get/nocontenttype");
  handler.addServlet(new ServletHolder(new PostServlet(helloWorld,baseUrl + "/post/1",bytes,textContentType)),"/post");
  handler.addServlet(new ServletHolder(new JsonPostServlet(baseUrl + "/jsonpost/1",jsonContentType)),"/jsonpost");
  handler.addServlet(new ServletHolder(new StatusCodeServlet(204)),"/status/nocontent");
  handler.addServlet(new ServletHolder(new StatusCodeServlet(304)),"/status/notmodified");
  handler.addServlet(new ServletHolder(new ErrorServlet(404)),"/status/notfound");
  handler.addServlet(new ServletHolder(new ErrorServlet(500)),"/status/server");
  handler.addServlet(new ServletHolder(new UriServlet()),"/uri/*");
  handler.addServlet(new ServletHolder(new MultipartServlet()),"/multipart");
  handler.addServlet(new ServletHolder(new DeleteServlet()),"/delete");
  handler.addServlet(new ServletHolder(new PutServlet(helloWorld,bytes,textContentType)),"/put");
  jettyServer.setHandler(handler);
  jettyServer.start();
}
