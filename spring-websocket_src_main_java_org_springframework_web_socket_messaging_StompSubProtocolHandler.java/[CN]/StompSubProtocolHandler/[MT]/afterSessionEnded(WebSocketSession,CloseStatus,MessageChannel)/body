{
  this.decoders.remove(session.getId());
  Principal principal=session.getPrincipal();
  if ((this.userSessionRegistry != null) && (principal != null)) {
    String userName=resolveNameForUserSessionRegistry(principal);
    this.userSessionRegistry.unregisterSessionId(userName,session.getId());
  }
  StompHeaderAccessor headers=StompHeaderAccessor.create(StompCommand.DISCONNECT);
  headers.setSessionId(session.getId());
  Message<?> message=MessageBuilder.withPayload(new byte[0]).setHeaders(headers).build();
  if (this.eventPublisher != null) {
    publishEvent(new SessionDisconnectEvent(this,session.getId(),closeStatus));
  }
  outputChannel.send(message);
}
