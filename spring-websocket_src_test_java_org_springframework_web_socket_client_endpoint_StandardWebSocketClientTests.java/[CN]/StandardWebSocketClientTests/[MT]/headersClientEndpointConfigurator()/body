{
  URI uri=new URI("ws://example.com/abc");
  List<String> protocols=Arrays.asList("abc");
  this.headers.setSecWebSocketProtocol(protocols);
  this.headers.add("foo","bar");
  this.wsClient.doHandshake(this.wsHandler,this.headers,uri);
  ArgumentCaptor<Endpoint> arg1=ArgumentCaptor.forClass(Endpoint.class);
  ArgumentCaptor<ClientEndpointConfig> arg2=ArgumentCaptor.forClass(ClientEndpointConfig.class);
  ArgumentCaptor<URI> arg3=ArgumentCaptor.forClass(URI.class);
  verify(this.wsContainer).connectToServer(arg1.capture(),arg2.capture(),arg3.capture());
  ClientEndpointConfig endpointConfig=arg2.getValue();
  assertEquals(protocols,endpointConfig.getPreferredSubprotocols());
  Map<String,List<String>> map=new HashMap<>();
  endpointConfig.getConfigurator().beforeRequest(map);
  assertEquals(Collections.singletonMap("foo",Arrays.asList("bar")),map);
}
