{
  Connection connection=null;
  try {
    SimpleDriverDataSource shutdownDataSource=new SimpleDriverDataSource();
    shutdownDataSource.setDriverClass(EmbeddedDriver.class);
    shutdownDataSource.setUrl(String.format(URL_TEMPLATE,databaseName,"shutdown=true"));
    connection=shutdownDataSource.getConnection();
  }
 catch (  SQLException e) {
    if (SHUTDOWN_CODE.equals(e.getSQLState())) {
      purgeDatabase(databaseName);
    }
 else {
      logger.warn("Could not shutdown in-memory Derby database",e);
    }
  }
 finally {
    JdbcUtils.closeConnection(connection);
  }
}
