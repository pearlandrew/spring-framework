{
  if (pattern.contains("**") && pattern.contains("{")) {
    throw new IllegalArgumentException("Combining '**' and URI templates is not allowed");
  }
  String[] patternParts=StringUtils.tokenizeToStringArray(pattern,this.pathSeparator);
  String[] pathParts=StringUtils.tokenizeToStringArray(path,this.pathSeparator);
  Map<String,String> variables=new LinkedHashMap<String,String>();
  for (int i=0; i < patternParts.length && i < pathParts.length; i++) {
    String patternPart=patternParts[i];
    String pathPart=pathParts[i];
    int patternEnd=patternPart.length() - 1;
    if (patternEnd > 1 && patternPart.charAt(0) == '{' && patternPart.charAt(patternEnd) == '}') {
      String varName=patternPart.substring(1,patternEnd);
      variables.put(varName,pathPart);
    }
  }
  return variables;
}
