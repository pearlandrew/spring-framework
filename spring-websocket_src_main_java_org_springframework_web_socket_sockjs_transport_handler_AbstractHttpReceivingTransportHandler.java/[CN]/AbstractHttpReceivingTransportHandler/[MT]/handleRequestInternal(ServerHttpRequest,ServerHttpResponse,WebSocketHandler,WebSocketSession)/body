{
  String[] messages=null;
  try {
    messages=readMessages(request);
  }
 catch (  JsonMappingException ex) {
    logger.error("Failed to read message: " + ex.getMessage());
    sendInternalServerError(response,"Payload expected.",wsSession.getId());
    return;
  }
catch (  IOException ex) {
    logger.error("Failed to read message: " + ex.getMessage());
    sendInternalServerError(response,"Broken JSON encoding.",wsSession.getId());
    return;
  }
catch (  Throwable t) {
    logger.error("Failed to read message: " + t.getMessage());
    sendInternalServerError(response,"Failed to process messages",wsSession.getId());
    return;
  }
  if (messages == null) {
    sendInternalServerError(response,"Payload expected.",wsSession.getId());
    return;
  }
  if (logger.isTraceEnabled()) {
    logger.trace("Received message(s): " + Arrays.asList(messages));
  }
  response.setStatusCode(getResponseStatus());
  response.getHeaders().setContentType(new MediaType("text","plain",Charset.forName("UTF-8")));
  try {
    for (    String message : messages) {
      wsHandler.handleMessage(wsSession,new TextMessage(message));
    }
  }
 catch (  Throwable t) {
    ExceptionWebSocketHandlerDecorator.tryCloseWithError(wsSession,t,logger);
    throw new SockJsProcessingException("Unhandled WebSocketHandler error in " + this,t,wsSession.getId());
  }
}
