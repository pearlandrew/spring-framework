{
  String[] messages;
  try {
    messages=readMessages(request);
  }
 catch (  IOException ex) {
    if (ex.getClass().getName().contains("Mapping")) {
      logger.error("Failed to read message",ex);
      handleReadError(response,"Payload expected.",sockJsSession.getId());
    }
 else {
      logger.error("Failed to read message",ex);
      handleReadError(response,"Broken JSON encoding.",sockJsSession.getId());
    }
    return;
  }
catch (  Throwable ex) {
    logger.error("Failed to read message",ex);
    handleReadError(response,"Failed to read message(s)",sockJsSession.getId());
    return;
  }
  if (messages == null) {
    handleReadError(response,"Payload expected.",sockJsSession.getId());
    return;
  }
  if (logger.isTraceEnabled()) {
    logger.trace("Received message(s): " + Arrays.asList(messages));
  }
  response.setStatusCode(getResponseStatus());
  response.getHeaders().setContentType(new MediaType("text","plain",UTF8_CHARSET));
  sockJsSession.delegateMessages(messages);
}
