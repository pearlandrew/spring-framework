{
  if (logger.isDebugEnabled()) {
    logger.debug(String.format("Loading ApplicationContext for merged context configuration [%s].",mergedContextConfiguration));
  }
  GenericApplicationContext context=new GenericApplicationContext();
  context.getEnvironment().setActiveProfiles(mergedContextConfiguration.getActiveProfiles());
  prepareContext(context);
  customizeBeanFactory(context.getDefaultListableBeanFactory());
  loadBeanDefinitions(context,mergedContextConfiguration);
  AnnotationConfigUtils.registerAnnotationConfigProcessors(context);
  customizeContext(context);
  context.refresh();
  context.registerShutdownHook();
  return context;
}
