{
  Object arg;
  HttpServletRequest servletRequest=webRequest.getNativeRequest(HttpServletRequest.class);
  MultipartHttpServletRequest multipartRequest=WebUtils.getNativeRequest(servletRequest,MultipartHttpServletRequest.class);
  if (MultipartFile.class.equals(parameter.getParameterType())) {
    assertIsMultipartRequest(servletRequest);
    Assert.notNull(multipartRequest,"Expected MultipartHttpServletRequest: is a MultipartResolver configured?");
    arg=multipartRequest.getFile(name);
  }
 else   if (isMultipartFileCollection(parameter)) {
    assertIsMultipartRequest(servletRequest);
    Assert.notNull(multipartRequest,"Expected MultipartHttpServletRequest: is a MultipartResolver configured?");
    arg=multipartRequest.getFiles(name);
  }
 else   if ("javax.servlet.http.Part".equals(parameter.getParameterType().getName())) {
    assertIsMultipartRequest(servletRequest);
    arg=servletRequest.getPart(name);
  }
 else {
    arg=null;
    if (multipartRequest != null) {
      List<MultipartFile> files=multipartRequest.getFiles(name);
      if (!files.isEmpty()) {
        arg=(files.size() == 1 ? files.get(0) : files);
      }
    }
    if (arg == null) {
      String[] paramValues=webRequest.getParameterValues(name);
      if (paramValues != null) {
        arg=paramValues.length == 1 ? paramValues[0] : paramValues;
      }
    }
  }
  return arg;
}
