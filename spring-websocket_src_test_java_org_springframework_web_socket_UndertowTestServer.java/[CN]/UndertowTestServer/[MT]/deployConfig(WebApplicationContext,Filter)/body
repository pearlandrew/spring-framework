{
  DispatcherServletInstanceFactory servletFactory=new DispatcherServletInstanceFactory(cxt);
  DeploymentInfo servletBuilder=deployment().setClassLoader(UndertowTestServer.class.getClassLoader()).setDeploymentName("undertow-websocket-test").setContextPath("/").addServlet(servlet("DispatcherServlet",DispatcherServlet.class,servletFactory).addMapping("/")).addServletContextAttribute(WebSocketDeploymentInfo.ATTRIBUTE_NAME,new WebSocketDeploymentInfo());
  for (  final Filter filter : filters) {
    String filterName=filter.getClass().getName();
    servletBuilder.addFilter(new FilterInfo(filterName,filter.getClass(),new FilterInstanceFactory(filter)));
    for (    DispatcherType type : DispatcherType.values()) {
      servletBuilder.addFilterUrlMapping(filterName,"/*",type);
    }
  }
  this.manager=defaultContainer().addDeployment(servletBuilder);
  this.manager.deploy();
  try {
    this.server=Undertow.builder().addHttpListener(this.port,"localhost").setHandler(this.manager.start()).build();
  }
 catch (  ServletException ex) {
    throw new IllegalStateException(ex);
  }
}
