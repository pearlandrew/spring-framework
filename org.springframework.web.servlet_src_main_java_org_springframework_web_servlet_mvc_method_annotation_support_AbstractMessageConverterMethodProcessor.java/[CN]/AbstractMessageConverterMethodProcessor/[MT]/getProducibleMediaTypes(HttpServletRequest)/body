{
  Set<MediaType> mediaTypes=(Set<MediaType>)request.getAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE);
  if (!CollectionUtils.isEmpty(mediaTypes)) {
    return mediaTypes;
  }
 else   if (!allSupportedMediaTypes.isEmpty()) {
    return new HashSet<MediaType>(allSupportedMediaTypes);
  }
 else {
    return Collections.singleton(MediaType.ALL);
  }
}
