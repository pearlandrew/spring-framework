{
  List<MediaType> acceptedMediaTypes=getAcceptedMediaTypes(inputMessage);
  List<MediaType> allSupportedMediaTypes=new ArrayList<MediaType>();
  if (this.messageConverters != null) {
    for (    MediaType acceptedMediaType : acceptedMediaTypes) {
      for (      HttpMessageConverter<?> messageConverter : this.messageConverters) {
        if (!messageConverter.canWrite(returnValue.getClass(),acceptedMediaType)) {
          continue;
        }
        ((HttpMessageConverter<T>)messageConverter).write(returnValue,acceptedMediaType,outputMessage);
        if (logger.isDebugEnabled()) {
          MediaType contentType=outputMessage.getHeaders().getContentType();
          if (contentType == null) {
            contentType=acceptedMediaType;
          }
          logger.debug("Written [" + returnValue + "] as \""+ contentType+ "\" using ["+ messageConverter+ "]");
        }
        return;
      }
    }
    for (    HttpMessageConverter<?> messageConverter : messageConverters) {
      allSupportedMediaTypes.addAll(messageConverter.getSupportedMediaTypes());
    }
  }
  throw new HttpMediaTypeNotAcceptableException(allSupportedMediaTypes);
}
