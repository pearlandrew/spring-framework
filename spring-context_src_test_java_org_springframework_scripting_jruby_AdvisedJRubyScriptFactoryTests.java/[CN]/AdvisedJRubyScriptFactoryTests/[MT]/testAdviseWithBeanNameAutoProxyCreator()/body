{
  ClassPathXmlApplicationContext ctx=new ClassPathXmlApplicationContext(APC_CONTEXT,CLASS);
  try {
    Messenger bean=(Messenger)ctx.getBean("messenger");
    assertTrue("Bean is not a proxy",AopUtils.isAopProxy(bean));
    assertTrue("Bean is not an Advised object",bean instanceof Advised);
    CountingBeforeAdvice advice=(CountingBeforeAdvice)ctx.getBean("advice");
    assertEquals(0,advice.getCalls());
    bean.getMessage();
    assertEquals(1,advice.getCalls());
  }
  finally {
    ctx.close();
  }
}
