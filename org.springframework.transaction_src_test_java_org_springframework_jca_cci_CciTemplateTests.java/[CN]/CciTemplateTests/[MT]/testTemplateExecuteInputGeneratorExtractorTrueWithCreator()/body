{
  ConnectionFactory connectionFactory=createMock(ConnectionFactory.class);
  RecordFactory recordFactory=createMock(RecordFactory.class);
  Connection connection=createMock(Connection.class);
  Interaction interaction=createMock(Interaction.class);
  RecordCreator generator=createMock(RecordCreator.class);
  RecordExtractor<?> extractor=createMock(RecordExtractor.class);
  RecordCreator creator=createMock(RecordCreator.class);
  Record inputRecord=createMock(Record.class);
  Record outputRecord=createMock(Record.class);
  Object obj=new Object();
  InteractionSpec interactionSpec=createMock(InteractionSpec.class);
  expect(connectionFactory.getRecordFactory()).andReturn(recordFactory);
  expect(connectionFactory.getConnection()).andReturn(connection);
  expect(connection.createInteraction()).andReturn(interaction);
  expect(creator.createRecord(recordFactory)).andReturn(outputRecord);
  expect(connectionFactory.getRecordFactory()).andReturn(recordFactory);
  expect(generator.createRecord(recordFactory)).andReturn(inputRecord);
  expect(interaction.execute(interactionSpec,inputRecord,outputRecord)).andReturn(true);
  expect(extractor.extractData(outputRecord)).andStubReturn(obj);
  interaction.close();
  connection.close();
  replay(connectionFactory,connection,interaction,generator,creator,extractor);
  CciTemplate ct=new CciTemplate(connectionFactory);
  ct.setOutputRecordCreator(creator);
  assertEquals(obj,ct.execute(interactionSpec,generator,extractor));
  verify(connectionFactory,connection,interaction,generator,creator,extractor);
}
