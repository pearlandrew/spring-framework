{
  ConnectionFactory connectionFactory=createMock(ConnectionFactory.class);
  ConnectionSpec connectionSpec=createMock(ConnectionSpec.class);
  Connection connection=createMock(Connection.class);
  Interaction interaction=createMock(Interaction.class);
  Record inputRecord=createMock(Record.class);
  Record outputRecord=createMock(Record.class);
  InteractionSpec interactionSpec=createMock(InteractionSpec.class);
  expect(connectionFactory.getConnection(connectionSpec)).andReturn(connection);
  expect(connection.createInteraction()).andReturn(interaction);
  expect(interaction.execute(interactionSpec,inputRecord,outputRecord)).andReturn(true);
  interaction.close();
  connection.close();
  replay(connectionFactory,connection,interaction);
  ConnectionSpecConnectionFactoryAdapter adapter=new ConnectionSpecConnectionFactoryAdapter();
  adapter.setTargetConnectionFactory(connectionFactory);
  adapter.setConnectionSpec(connectionSpec);
  CciTemplate ct=new CciTemplate(adapter);
  ct.execute(interactionSpec,inputRecord,outputRecord);
  verify(connectionFactory,connection,interaction);
}
