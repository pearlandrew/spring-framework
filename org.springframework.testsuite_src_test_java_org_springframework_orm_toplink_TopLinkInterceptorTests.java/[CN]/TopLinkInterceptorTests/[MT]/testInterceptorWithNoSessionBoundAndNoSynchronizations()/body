{
  MockControl sessionControl=MockControl.createControl(Session.class);
  Session session=(Session)sessionControl.getMock();
  MockControl methodInvocationControl=MockControl.createControl(MethodInvocation.class);
  MethodInvocation methodInvocation=(MethodInvocation)methodInvocationControl.getMock();
  SessionFactory factory=new SingleSessionFactory(session);
  TopLinkInterceptor interceptor=new TopLinkInterceptor();
  interceptor.setSessionFactory(factory);
  methodInvocation.proceed();
  methodInvocationControl.setReturnValue(null,1);
  session.release();
  sessionControl.setVoidCallable(1);
  methodInvocationControl.replay();
  sessionControl.replay();
  try {
    interceptor.invoke(methodInvocation);
  }
 catch (  Throwable t) {
    System.out.println(t);
    t.printStackTrace();
    fail();
  }
  assertFalse(TransactionSynchronizationManager.hasResource(factory));
  sessionControl.verify();
  methodInvocationControl.verify();
  sessionControl.verify();
}
