{
  SimpleHash freeMarkerModel=getTemplateModel(renderAttributes,exchange);
  if (logger.isDebugEnabled()) {
    logger.debug("Rendering FreeMarker template [" + getUrl() + "].");
  }
  Locale locale=Locale.getDefault();
  DataBuffer dataBuffer=getBufferAllocator().allocateBuffer();
  try {
    Writer writer=new OutputStreamWriter(dataBuffer.asOutputStream());
    getTemplate(locale).process(freeMarkerModel,writer);
  }
 catch (  IOException ex) {
    String message="Could not load FreeMarker template for URL [" + getUrl() + "]";
    return Flux.error(new IllegalStateException(message,ex));
  }
catch (  Throwable ex) {
    return Flux.error(ex);
  }
  return Flux.just(dataBuffer);
}
