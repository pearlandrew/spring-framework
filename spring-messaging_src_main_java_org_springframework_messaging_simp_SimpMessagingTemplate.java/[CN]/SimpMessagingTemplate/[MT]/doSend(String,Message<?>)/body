{
  Assert.notNull(destination,"Destination must not be null");
  SimpMessageHeaderAccessor headerAccessor=SimpMessageHeaderAccessor.wrap(message);
  headerAccessor.setDestination(destination);
  headerAccessor.setMessageTypeIfNotSet(SimpMessageType.MESSAGE);
  message=MessageBuilder.createMessage(message.getPayload(),headerAccessor.getMessageHeaders());
  long timeout=this.sendTimeout;
  boolean sent=(timeout >= 0) ? this.messageChannel.send(message,timeout) : this.messageChannel.send(message);
  if (!sent) {
    throw new MessageDeliveryException(message,"failed to send message to destination '" + destination + "' within timeout: "+ timeout);
  }
}
