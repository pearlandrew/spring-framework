{
  if (this.beanFactory != null) {
    String qualifier=txAttr != null ? txAttr.getQualifier() : null;
    if (StringUtils.hasText(qualifier)) {
      return determineQualifiedTransactionManager(qualifier);
    }
 else     if (StringUtils.hasText(this.transactionManagerBeanName)) {
      return determineQualifiedTransactionManager(this.transactionManagerBeanName);
    }
 else     if (txAttr != null) {
      PlatformTransactionManager defaultTransactionManager=getTransactionManager();
      if (defaultTransactionManager == null) {
        defaultTransactionManager=this.beanFactory.getBean(PlatformTransactionManager.class);
        this.transactionManagerCache.putIfAbsent(DEFAULT_TRANSACTION_MANAGER_KEY,defaultTransactionManager);
      }
      return defaultTransactionManager;
    }
  }
  return getTransactionManager();
}
