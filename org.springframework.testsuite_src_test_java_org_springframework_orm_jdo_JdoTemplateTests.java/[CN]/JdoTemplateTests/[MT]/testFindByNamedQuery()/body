{
  MockControl queryControl=MockControl.createControl(Query.class);
  Query query=(Query)queryControl.getMock();
  pmf.getPersistenceManager();
  pmfControl.setReturnValue(pm);
  pm.newNamedQuery(String.class,"some query name");
  pmControl.setReturnValue(query);
  Collection coll=new HashSet();
  query.execute();
  queryControl.setReturnValue(coll);
  pm.close();
  pmControl.setVoidCallable(1);
  pmfControl.replay();
  pmControl.replay();
  queryControl.replay();
  JdoTemplate jt=new JdoTemplate(pmf);
  assertEquals(coll,jt.findByNamedQuery(String.class,"some query name"));
  queryControl.verify();
}
