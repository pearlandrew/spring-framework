{
  Assert.notNull(session,"session must not be null");
  this.session=session;
  if (this.protocol == null) {
    UpgradeResponse response=session.getUpgradeResponse();
    if ((response != null) && response.getAcceptedSubProtocol() != null) {
      this.protocol=response.getAcceptedSubProtocol();
    }
  }
}
