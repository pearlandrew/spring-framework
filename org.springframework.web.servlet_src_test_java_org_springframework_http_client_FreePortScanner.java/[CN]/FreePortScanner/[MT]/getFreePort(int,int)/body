{
  Assert.isTrue(minPort > 0,"'minPort' must be larger than 0");
  Assert.isTrue(maxPort > minPort,"'maxPort' must be larger than minPort");
  int portRange=maxPort - minPort;
  int candidatePort;
  int searchCounter=0;
  do {
    if (++searchCounter > portRange) {
      throw new IllegalStateException(String.format("There were no ports available in the range %d to %d",minPort,maxPort));
    }
    candidatePort=getRandomPort(minPort,portRange);
  }
 while (!isPortAvailable(candidatePort));
  return candidatePort;
}
