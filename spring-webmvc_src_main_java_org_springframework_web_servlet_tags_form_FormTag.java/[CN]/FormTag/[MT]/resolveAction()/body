{
  String action=getAction();
  if (StringUtils.hasText(action)) {
    String pathToServlet=getRequestContext().getPathToServlet();
    if (action.startsWith("/") && !action.startsWith(getRequestContext().getContextPath())) {
      action=pathToServlet + action;
    }
    action=getDisplayString(evaluate(ACTION_ATTRIBUTE,action));
    return processAction(action);
  }
 else {
    String requestUri=getRequestContext().getRequestUri();
    ServletResponse response=this.pageContext.getResponse();
    if (response instanceof HttpServletResponse) {
      requestUri=((HttpServletResponse)response).encodeURL(requestUri);
      String queryString=getRequestContext().getQueryString();
      if (StringUtils.hasText(queryString)) {
        requestUri+="?" + HtmlUtils.htmlEscape(queryString);
      }
    }
    if (StringUtils.hasText(requestUri)) {
      return processAction(requestUri);
    }
 else {
      throw new IllegalArgumentException("Attribute 'action' is required. " + "Attempted to resolve against current request URI but request URI was null.");
    }
  }
}
