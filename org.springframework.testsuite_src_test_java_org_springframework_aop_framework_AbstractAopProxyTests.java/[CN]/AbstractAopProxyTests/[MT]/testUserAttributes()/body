{
class MapAwareMethodInterceptor implements MethodInterceptor {
    private final Map expectedValues;
    private final Map valuesToAdd;
    public MapAwareMethodInterceptor(    Map expectedValues,    Map valuesToAdd){
      this.expectedValues=expectedValues;
      this.valuesToAdd=valuesToAdd;
    }
    public Object invoke(    MethodInvocation invocation) throws Throwable {
      ReflectiveMethodInvocation rmi=(ReflectiveMethodInvocation)invocation;
      for (Iterator it=rmi.getUserAttributes().keySet().iterator(); it.hasNext(); ) {
        Object key=it.next();
        assertEquals(expectedValues.get(key),rmi.getUserAttributes().get(key));
      }
      rmi.getUserAttributes().putAll(valuesToAdd);
      return invocation.proceed();
    }
  }
  ;
  AdvisedSupport pc=new AdvisedSupport(new Class[]{ITestBean.class});
  MapAwareMethodInterceptor mami1=new MapAwareMethodInterceptor(new HashMap(),new HashMap());
  Map firstValuesToAdd=new HashMap();
  firstValuesToAdd.put("test","");
  MapAwareMethodInterceptor mami2=new MapAwareMethodInterceptor(new HashMap(),firstValuesToAdd);
  MapAwareMethodInterceptor mami3=new MapAwareMethodInterceptor(firstValuesToAdd,new HashMap());
  MapAwareMethodInterceptor mami4=new MapAwareMethodInterceptor(firstValuesToAdd,new HashMap());
  Map secondValuesToAdd=new HashMap();
  secondValuesToAdd.put("foo","bar");
  secondValuesToAdd.put("cat","dog");
  MapAwareMethodInterceptor mami5=new MapAwareMethodInterceptor(firstValuesToAdd,secondValuesToAdd);
  Map finalExpected=new HashMap(firstValuesToAdd);
  finalExpected.putAll(secondValuesToAdd);
  MapAwareMethodInterceptor mami6=new MapAwareMethodInterceptor(finalExpected,secondValuesToAdd);
  pc.addAdvice(mami1);
  pc.addAdvice(mami2);
  pc.addAdvice(mami3);
  pc.addAdvice(mami4);
  pc.addAdvice(mami5);
  pc.addAdvice(mami6);
  pc.setTarget(new TestBean());
  AopProxy aop=createAopProxy(pc);
  ITestBean tb=(ITestBean)aop.getProxy();
  String newName="foo";
  tb.setName(newName);
  assertEquals(newName,tb.getName());
}
