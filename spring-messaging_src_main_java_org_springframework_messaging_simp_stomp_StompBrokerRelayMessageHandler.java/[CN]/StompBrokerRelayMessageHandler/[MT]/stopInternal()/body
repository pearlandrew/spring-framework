{
  this.clientInboundChannel.unsubscribe(this);
  this.brokerChannel.unsubscribe(this);
  for (  StompConnectionHandler handler : this.connectionHandlers.values()) {
    try {
      handler.clearConnection();
    }
 catch (    Throwable t) {
      logger.error("Failed to close connection in session " + handler.getSessionId() + ": "+ t.getMessage());
    }
  }
  try {
    this.tcpClient.shutdown();
  }
 catch (  Throwable t) {
    logger.error("Error while shutting down TCP client",t);
  }
}
