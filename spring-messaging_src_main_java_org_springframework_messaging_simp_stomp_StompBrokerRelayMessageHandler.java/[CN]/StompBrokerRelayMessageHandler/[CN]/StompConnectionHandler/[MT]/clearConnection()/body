{
  if (logger.isDebugEnabled()) {
    logger.debug("Cleaning up connection state for session " + sessionId + " ("+ (getConnectionCount() - 1)+ " remaining connections).");
  }
  if (this.isRemoteClientSession) {
    StompBrokerRelayMessageHandler.this.connectionHandlers.remove(this.sessionId);
  }
  this.isStompConnected=false;
  TcpConnection<byte[]> conn=this.tcpConnection;
  this.tcpConnection=null;
  if (conn != null) {
    if (logger.isInfoEnabled()) {
      logger.info("Closing TCP connection in session " + this.sessionId);
    }
    conn.close();
  }
}
