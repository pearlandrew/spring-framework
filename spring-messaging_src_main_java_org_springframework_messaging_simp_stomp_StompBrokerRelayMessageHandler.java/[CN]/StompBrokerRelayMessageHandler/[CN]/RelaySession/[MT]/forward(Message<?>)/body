{
  if (!this.isConnected) {
synchronized (this.monitor) {
      if (!this.isConnected) {
        this.messageQueue.add(message);
        if (logger.isTraceEnabled()) {
          logger.trace("Not connected, message queued. Queue size=" + this.messageQueue.size());
        }
        return;
      }
    }
  }
  if (this.messageQueue.isEmpty()) {
    forwardInternal(message);
  }
 else {
    this.messageQueue.add(message);
    flushMessages();
  }
}
