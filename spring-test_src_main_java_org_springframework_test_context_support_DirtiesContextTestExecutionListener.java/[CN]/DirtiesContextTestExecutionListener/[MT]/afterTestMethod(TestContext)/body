{
  Class<?> testClass=testContext.getTestClass();
  Assert.notNull(testClass,"The test class of the supplied TestContext must not be null");
  Method testMethod=testContext.getTestMethod();
  Assert.notNull(testMethod,"The test method of the supplied TestContext must not be null");
  final Class<DirtiesContext> annotationType=DirtiesContext.class;
  boolean methodDirtiesContext=testMethod.isAnnotationPresent(annotationType);
  boolean classDirtiesContext=testClass.isAnnotationPresent(annotationType);
  DirtiesContext classDirtiesContextAnnotation=testClass.getAnnotation(annotationType);
  ClassMode classMode=classDirtiesContext ? classDirtiesContextAnnotation.classMode() : null;
  if (logger.isDebugEnabled()) {
    logger.debug("After test method: context [" + testContext + "], class dirties context ["+ classDirtiesContext+ "], class mode ["+ classMode+ "], method dirties context ["+ methodDirtiesContext+ "].");
  }
  if (methodDirtiesContext || (classDirtiesContext && classMode == ClassMode.AFTER_EACH_TEST_METHOD)) {
    dirtyContext(testContext);
  }
}
