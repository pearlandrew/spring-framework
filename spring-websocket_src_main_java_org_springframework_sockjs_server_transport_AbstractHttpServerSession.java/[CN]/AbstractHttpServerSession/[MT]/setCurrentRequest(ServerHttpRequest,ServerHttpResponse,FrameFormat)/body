{
  if (isClosed()) {
    logger.debug("connection already closed");
    writeFrame(response,SockJsFrame.closeFrameGoAway());
    return;
  }
  Assert.isInstanceOf(AsyncServerHttpRequest.class,request,"Expected AsyncServerHttpRequest");
  this.asyncRequest=(AsyncServerHttpRequest)request;
  this.asyncRequest.setTimeout(-1);
  this.asyncRequest.startAsync();
  this.response=response;
  this.frameFormat=frameFormat;
  scheduleHeartbeat();
  tryFlushCache();
}
