{
  String virtualHost="ABC";
  this.brokerRelay.setVirtualHost(virtualHost);
  this.brokerRelay.start();
  String sessionId="sess1";
  StompHeaderAccessor headers=StompHeaderAccessor.create(StompCommand.CONNECT);
  headers.setSessionId(sessionId);
  this.brokerRelay.handleMessage(MessageBuilder.createMessage(new byte[0],headers.getMessageHeaders()));
  List<Message<byte[]>> sent=this.tcpClient.connection.messages;
  assertEquals(2,sent.size());
  StompHeaderAccessor headers1=StompHeaderAccessor.wrap(sent.get(0));
  assertEquals(virtualHost,headers1.getHost());
  assertNotNull("The prepared message does not have an accessor",MessageHeaderAccessor.getAccessor(sent.get(0),MessageHeaderAccessor.class));
  StompHeaderAccessor headers2=StompHeaderAccessor.wrap(sent.get(1));
  assertEquals(sessionId,headers2.getSessionId());
  assertEquals(virtualHost,headers2.getHost());
  assertNotNull("The prepared message does not have an accessor",MessageHeaderAccessor.getAccessor(sent.get(1),MessageHeaderAccessor.class));
}
