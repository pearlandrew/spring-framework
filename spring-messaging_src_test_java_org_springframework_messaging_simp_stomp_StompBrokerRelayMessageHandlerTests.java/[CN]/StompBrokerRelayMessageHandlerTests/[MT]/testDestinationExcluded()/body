{
  this.brokerRelay.start();
  SimpMessageHeaderAccessor headers=SimpMessageHeaderAccessor.create(SimpMessageType.MESSAGE);
  headers.setSessionId("sess1");
  headers.setDestination("/user/daisy/foo");
  this.brokerRelay.handleMessage(MessageBuilder.createMessage(new byte[0],headers.getMessageHeaders()));
  List<Message<byte[]>> sent=this.tcpClient.connection.messages;
  assertEquals(1,sent.size());
  assertEquals(StompCommand.CONNECT,StompHeaderAccessor.wrap(sent.get(0)).getCommand());
  assertNotNull("The prepared message does not have an accessor",MessageHeaderAccessor.getAccessor(sent.get(0),MessageHeaderAccessor.class));
}
