{
  String className;
  if (tomcatWebSocketPresent) {
    className="org.springframework.websocket.server.endpoint.support.TomcatRequestUpgradeStrategy";
  }
 else   if (glassfishWebSocketPresent) {
    className="org.springframework.websocket.server.endpoint.support.GlassfishRequestUpgradeStrategy";
  }
 else {
    throw new IllegalStateException("No suitable EndpointRequestUpgradeStrategy");
  }
  try {
    Class<?> clazz=ClassUtils.forName(className,EndpointHandshakeHandler.class.getClassLoader());
    return (EndpointRequestUpgradeStrategy)BeanUtils.instantiateClass(clazz.getConstructor());
  }
 catch (  Throwable t) {
    throw new IllegalStateException("Failed to instantiate " + className,t);
  }
}
