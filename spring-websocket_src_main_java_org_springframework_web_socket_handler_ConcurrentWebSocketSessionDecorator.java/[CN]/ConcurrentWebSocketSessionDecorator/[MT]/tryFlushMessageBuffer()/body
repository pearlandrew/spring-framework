{
  if (this.flushLock.tryLock() && !this.limitExceeded) {
    try {
      while (true) {
        WebSocketMessage<?> messageToSend=this.buffer.poll();
        if (messageToSend == null) {
          break;
        }
        this.bufferSize.addAndGet(messageToSend.getPayloadLength() * -1);
        this.sendStartTime=System.currentTimeMillis();
        getDelegate().sendMessage(messageToSend);
        this.sendStartTime=0;
      }
    }
  finally {
      this.sendStartTime=0;
      flushLock.unlock();
    }
    return true;
  }
  return false;
}
