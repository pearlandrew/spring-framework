{
  this.buffer.add(message);
  this.bufferSize.addAndGet(message.getPayloadLength());
  do {
    if (!tryFlushMessageBuffer()) {
      checkSessionLimits();
      break;
    }
  }
 while (!this.buffer.isEmpty());
}
