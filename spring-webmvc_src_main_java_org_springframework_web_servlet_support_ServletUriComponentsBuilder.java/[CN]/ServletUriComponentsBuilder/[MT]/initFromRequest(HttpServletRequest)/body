{
  HttpRequest httpRequest=new ServletServerHttpRequest(request);
  UriComponents uriComponents=UriComponentsBuilder.fromHttpRequest(httpRequest).build();
  String scheme=uriComponents.getScheme();
  String host=uriComponents.getHost();
  int port=uriComponents.getPort();
  ServletUriComponentsBuilder builder=new ServletUriComponentsBuilder();
  builder.scheme(scheme);
  builder.host(host);
  if (scheme.equals("http") && port != 80 || scheme.equals("https") && port != 443) {
    builder.port(port);
  }
  return builder;
}
