{
  MockControl mockRequest=MockControl.createControl(HttpServletRequest.class);
  HttpServletRequest request=(HttpServletRequest)mockRequest.getMock();
  request.getCharacterEncoding();
  mockRequest.setReturnValue(ENCODING);
  request.getAttribute(FILTER_NAME + OncePerRequestFilter.ALREADY_FILTERED_SUFFIX);
  mockRequest.setReturnValue(null);
  request.setAttribute(FILTER_NAME + OncePerRequestFilter.ALREADY_FILTERED_SUFFIX,Boolean.TRUE);
  mockRequest.setVoidCallable();
  request.removeAttribute(FILTER_NAME + OncePerRequestFilter.ALREADY_FILTERED_SUFFIX);
  mockRequest.setVoidCallable();
  mockRequest.replay();
  MockHttpServletResponse response=new MockHttpServletResponse();
  MockControl mockFilter=MockControl.createControl(FilterChain.class);
  FilterChain filterChain=(FilterChain)mockFilter.getMock();
  filterChain.doFilter(request,response);
  mockFilter.replay();
  CharacterEncodingFilter filter=new CharacterEncodingFilter();
  filter.setEncoding(ENCODING);
  filter.init(new MockFilterConfig(FILTER_NAME));
  filter.doFilter(request,response,filterChain);
  mockRequest.verify();
  mockFilter.verify();
}
