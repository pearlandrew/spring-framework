{
  Class<?> formattedObjectType=getFormattedObjectType(formatter.getClass());
  if (!conversionService.canConvert(formattedObjectType,type)) {
    throw new IllegalArgumentException("Unable to register formatter " + formatter + " for type ["+ type.getName()+ "]; not able to convert from ["+ formattedObjectType.getName()+ "] to parse");
  }
  if (!conversionService.canConvert(type,formattedObjectType)) {
    throw new IllegalArgumentException("Unable to register formatter " + formatter + " for type ["+ type.getName()+ "]; not able to convert to ["+ formattedObjectType.getName()+ "] to format");
  }
  typeFormatters.put(type,formatter);
}
