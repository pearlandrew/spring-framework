{
  MultiValueMap<String,String> subscriptions=this.subscriptionRegistry.findSubscriptions(message);
  for (  String sessionId : subscriptions.keySet()) {
    for (    String subscriptionId : subscriptions.get(sessionId)) {
      SimpMessageHeaderAccessor headers=SimpMessageHeaderAccessor.wrap(message);
      headers.setSessionId(sessionId);
      headers.setSubscriptionId(subscriptionId);
      Object payload=message.getPayload();
      Message<?> clientMessage=MessageBuilder.withPayload(payload).setHeaders(headers).build();
      try {
        this.messageChannel.send(clientMessage);
      }
 catch (      Throwable ex) {
        logger.error("Failed to send message to destination=" + destination + ", sessionId="+ sessionId+ ", subscriptionId="+ subscriptionId,ex);
      }
    }
  }
}
