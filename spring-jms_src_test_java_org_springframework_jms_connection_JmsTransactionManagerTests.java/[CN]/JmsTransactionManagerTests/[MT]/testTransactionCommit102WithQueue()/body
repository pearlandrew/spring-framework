{
  QueueConnectionFactory cf=mock(QueueConnectionFactory.class);
  QueueConnection con=mock(QueueConnection.class);
  final QueueSession session=mock(QueueSession.class);
  given(cf.createQueueConnection()).willReturn(con);
  given(con.createQueueSession(true,Session.AUTO_ACKNOWLEDGE)).willReturn(session);
  JmsTransactionManager tm=new JmsTransactionManager102(cf,false);
  TransactionStatus ts=tm.getTransaction(new DefaultTransactionDefinition());
  JmsTemplate jt=new JmsTemplate102(cf,false);
  jt.execute(new SessionCallback(){
    @Override public Object doInJms(    Session sess){
      assertTrue(sess == session);
      return null;
    }
  }
);
  tm.commit(ts);
  verify(session).commit();
  verify(session).close();
  verify(con).close();
}
