{
  TopicConnectionFactory cf=mock(TopicConnectionFactory.class);
  TopicConnection con=mock(TopicConnection.class);
  final TopicSession session=mock(TopicSession.class);
  given(cf.createTopicConnection()).willReturn(con);
  given(con.createTopicSession(true,Session.AUTO_ACKNOWLEDGE)).willReturn(session);
  JmsTransactionManager tm=new JmsTransactionManager102(cf,true);
  TransactionStatus ts=tm.getTransaction(new DefaultTransactionDefinition());
  JmsTemplate jt=new JmsTemplate102(cf,true);
  jt.execute(new SessionCallback(){
    @Override public Object doInJms(    Session sess){
      assertTrue(sess == session);
      return null;
    }
  }
);
  tm.commit(ts);
  verify(session).commit();
  verify(session).close();
  verify(con).close();
}
