{
  try {
    WebSocketServerSockJsSession sockJsSession=(WebSocketServerSockJsSession)wsSession;
    WebSocketHandler sockJsHandler=new SockJsWebSocketHandler(getSockJsServiceConfig(),wsHandler,sockJsSession);
    this.handshakeHandler.doHandshake(request,response,sockJsHandler);
  }
 catch (  Throwable t) {
    throw new SockJsProcessingException("Failed to start handshake request",t,wsSession.getId());
  }
}
