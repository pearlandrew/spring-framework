{
  HttpServletRequest servletRequest=request.getNativeRequest(HttpServletRequest.class);
  assertIsMultipartRequest(servletRequest);
  MultipartHttpServletRequest multipartRequest=WebUtils.getNativeRequest(servletRequest,MultipartHttpServletRequest.class);
  String partName=getPartName(parameter);
  Object arg;
  if (MultipartFile.class.equals(parameter.getParameterType())) {
    Assert.notNull(multipartRequest,"Expected MultipartHttpServletRequest: is a MultipartResolver configured?");
    arg=multipartRequest.getFile(partName);
  }
 else   if (isMultipartFileCollection(parameter)) {
    Assert.notNull(multipartRequest,"Expected MultipartHttpServletRequest: is a MultipartResolver configured?");
    arg=multipartRequest.getFiles(partName);
  }
 else   if ("javax.servlet.http.Part".equals(parameter.getParameterType().getName())) {
    assertIsMultipartRequest(servletRequest);
    arg=servletRequest.getPart(partName);
  }
 else   if (isPartCollection(parameter)) {
    assertIsMultipartRequest(servletRequest);
    arg=new ArrayList(servletRequest.getParts());
  }
 else {
    try {
      HttpInputMessage inputMessage=new RequestPartServletServerHttpRequest(servletRequest,partName);
      arg=readWithMessageConverters(inputMessage,parameter,parameter.getParameterType());
      WebDataBinder binder=binderFactory.createBinder(request,arg,partName);
      if (arg != null) {
        validate(binder,parameter);
      }
      mavContainer.addAttribute(BindingResult.MODEL_KEY_PREFIX + partName,binder.getBindingResult());
    }
 catch (    MissingServletRequestPartException ex) {
      arg=null;
    }
  }
  RequestPart annot=parameter.getParameterAnnotation(RequestPart.class);
  boolean isRequired=(annot == null || annot.required());
  if (arg == null && isRequired) {
    throw new MissingServletRequestPartException(partName);
  }
  return arg;
}
