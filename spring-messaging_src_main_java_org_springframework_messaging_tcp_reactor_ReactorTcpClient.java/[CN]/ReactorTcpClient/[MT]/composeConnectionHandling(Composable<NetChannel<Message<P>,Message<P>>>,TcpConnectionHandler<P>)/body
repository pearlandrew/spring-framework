{
  composable.when(Throwable.class,new Consumer<Throwable>(){
    @Override public void accept(    Throwable ex){
      connectionHandler.afterConnectFailure(ex);
    }
  }
).consume(new Consumer<NetChannel<Message<P>,Message<P>>>(){
    @Override public void accept(    NetChannel<Message<P>,Message<P>> connection){
      connection.when(Throwable.class,new Consumer<Throwable>(){
        @Override public void accept(        Throwable t){
          connectionHandler.handleFailure(t);
        }
      }
).consume(new Consumer<Message<P>>(){
        @Override public void accept(        Message<P> message){
          connectionHandler.handleMessage(message);
        }
      }
).on().close(new Runnable(){
        @Override public void run(){
          connectionHandler.afterConnectionClosed();
        }
      }
);
      connectionHandler.afterConnected(new ReactorTcpConnection<P>(connection));
    }
  }
);
}
