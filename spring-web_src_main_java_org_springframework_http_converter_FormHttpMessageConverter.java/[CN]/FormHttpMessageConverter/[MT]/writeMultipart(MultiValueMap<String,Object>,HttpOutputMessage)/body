{
  byte[] boundary=generateMultipartBoundary();
  Map<String,String> parameters=Collections.singletonMap("boundary",new String(boundary,"US-ASCII"));
  MediaType contentType=new MediaType(MediaType.MULTIPART_FORM_DATA,parameters);
  outputMessage.getHeaders().setContentType(contentType);
  writeParts(outputMessage.getBody(),parts,boundary);
  writeEnd(boundary,outputMessage.getBody());
}
