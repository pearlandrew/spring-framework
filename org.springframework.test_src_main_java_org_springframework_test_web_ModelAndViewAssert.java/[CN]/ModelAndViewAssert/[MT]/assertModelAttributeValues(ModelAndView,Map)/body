{
  assertCondition(mav != null,"ModelAndView is null");
  assertCondition(mav.getModel() != null,"Model is null");
  if (!mav.getModel().keySet().equals(expectedModel.keySet())) {
    StringBuffer buf=new StringBuffer("Keyset of expected model does not match.\n");
    appendNonMatchingSetsErrorMessage(expectedModel.keySet(),mav.getModel().keySet(),buf);
    fail(buf.toString());
  }
  StringBuffer buf=new StringBuffer();
  Iterator it=mav.getModel().keySet().iterator();
  while (it.hasNext()) {
    Object modelName=it.next();
    Object assertionValue=expectedModel.get(modelName);
    Object mavValue=mav.getModel().get(modelName);
    if (!assertionValue.equals(mavValue)) {
      buf.append("Value under name '" + modelName + "' differs, should have been '"+ assertionValue+ "' but was '"+ mavValue+ "'\n");
    }
  }
  if (buf.length() != 0) {
    buf.insert(0,"Values of expected model do not match.\n");
    fail(buf.toString());
  }
}
