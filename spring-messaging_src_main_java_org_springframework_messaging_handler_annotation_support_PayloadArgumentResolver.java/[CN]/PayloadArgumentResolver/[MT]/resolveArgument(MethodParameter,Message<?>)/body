{
  Payload ann=param.getParameterAnnotation(Payload.class);
  if (ann != null && StringUtils.hasText(ann.expression())) {
    throw new IllegalStateException("@Payload SpEL expressions not supported by this resolver");
  }
  Object payload=message.getPayload();
  if (isEmptyPayload(payload)) {
    if (ann == null || ann.required()) {
      String paramName=getParameterName(param);
      BindingResult bindingResult=new BeanPropertyBindingResult(payload,paramName);
      bindingResult.addError(new ObjectError(paramName,"@Payload param is required"));
      throw new MethodArgumentNotValidException(message,param,bindingResult);
    }
 else {
      return null;
    }
  }
  Class<?> targetClass=param.getParameterType();
  if (ClassUtils.isAssignable(targetClass,payload.getClass())) {
    validate(message,param,payload);
    return payload;
  }
 else {
    payload=this.converter.fromMessage(message,targetClass);
    if (payload == null) {
      throw new MessageConversionException(message,"No converter found to convert to " + targetClass + ", message="+ message);
    }
    validate(message,param,payload);
    return payload;
  }
}
