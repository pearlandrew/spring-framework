{
  if (value instanceof Model) {
    result.getModel().addAllAttributes(((Model)value).asMap());
  }
 else   if (value instanceof Map) {
    result.getModel().addAllAttributes((Map<String,?>)value);
  }
 else   if (result.getHandler() instanceof HandlerMethod) {
    MethodParameter returnType=((HandlerMethod)result.getHandler()).getReturnType();
    String name=getNameForReturnValue(value,returnType);
    result.getModel().addAttribute(name,value);
  }
 else {
    result.getModel().addAttribute(value);
  }
  return value;
}
