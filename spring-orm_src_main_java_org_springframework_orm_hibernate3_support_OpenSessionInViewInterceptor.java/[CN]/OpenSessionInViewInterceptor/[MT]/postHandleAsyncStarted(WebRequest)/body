{
  String attributeName=getParticipateAttributeName();
  if (request.getAttribute(attributeName,WebRequest.SCOPE_REQUEST) == null) {
    if (isSingleSession()) {
      TransactionSynchronizationManager.unbindResource(getSessionFactory());
    }
 else {
      throw new IllegalStateException("Deferred close is not supported with async requests.");
    }
  }
}
