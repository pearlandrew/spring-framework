{
  if (!decrementParticipateCount(request)) {
    if (isSingleSession()) {
      TransactionSynchronizationManager.unbindResource(getSessionFactory());
    }
 else {
      throw new IllegalStateException("Deferred close mode is not supported with async requests.");
    }
  }
}
