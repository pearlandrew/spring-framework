{
  MockControl invCtrl=MockControl.createControl(MethodInvocation.class);
  MethodInvocation invocation=(MethodInvocation)invCtrl.getMock();
  MockControl ctxCtrl=MockControl.createControl(ApplicationContext.class);
  ApplicationContext ctx=(ApplicationContext)ctxCtrl.getMock();
  EventPublicationInterceptor interceptor=new EventPublicationInterceptor();
  interceptor.setApplicationEventClass(MyEvent.class);
  interceptor.setApplicationEventPublisher(ctx);
  interceptor.afterPropertiesSet();
  invocation.proceed();
  invCtrl.setReturnValue(new Object());
  invocation.getThis();
  invCtrl.setReturnValue(new Object());
  ctx.publishEvent(new MyEvent(new Object()));
  ctxCtrl.setDefaultMatcher(new AlwaysMatcher());
  ctxCtrl.replay();
  invCtrl.replay();
  interceptor.invoke(invocation);
  ctxCtrl.verify();
  invCtrl.verify();
}
