{
  if (logger.isDebugEnabled()) {
    logger.debug("Message received: " + message);
  }
  String destination=WebMessageHeaderAccesssor.wrap(message).getDestination();
  Set<SessionSubscriptionRegistration> registrations=this.subscriptionRegistry.getRegistrationsByDestination(destination);
  if (registrations == null) {
    return;
  }
  for (  SessionSubscriptionRegistration registration : registrations) {
    for (    String subscriptionId : registration.getSubscriptionsByDestination(destination)) {
      WebMessageHeaderAccesssor headers=WebMessageHeaderAccesssor.wrap(message);
      headers.setSessionId(registration.getSessionId());
      headers.setSubscriptionId(subscriptionId);
      Message<?> clientMessage=MessageBuilder.withPayload(message.getPayload()).copyHeaders(headers.toMap()).build();
      try {
        this.clientChannel.send(clientMessage);
      }
 catch (      Throwable ex) {
        logger.error("Failed to send message to destination=" + destination + ", sessionId="+ registration.getSessionId()+ ", subscriptionId="+ subscriptionId,ex);
      }
    }
  }
}
