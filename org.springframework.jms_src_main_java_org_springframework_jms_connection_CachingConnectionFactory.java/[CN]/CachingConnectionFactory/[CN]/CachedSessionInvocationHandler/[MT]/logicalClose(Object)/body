{
  if (this.transactionOpen && this.target.getTransacted()) {
    this.transactionOpen=false;
    this.target.rollback();
  }
  for (Iterator it=this.cachedConsumers.entrySet().iterator(); it.hasNext(); ) {
    Map.Entry entry=(Map.Entry)it.next();
    ConsumerCacheKey key=(ConsumerCacheKey)entry.getKey();
    if (key.subscription != null) {
      ((MessageConsumer)entry.getValue()).close();
      it.remove();
    }
  }
  if (!this.sessionList.contains(proxy)) {
    if (logger.isTraceEnabled()) {
      logger.trace("Returning cached Session: " + this.target);
    }
    this.sessionList.addLast(proxy);
  }
}
