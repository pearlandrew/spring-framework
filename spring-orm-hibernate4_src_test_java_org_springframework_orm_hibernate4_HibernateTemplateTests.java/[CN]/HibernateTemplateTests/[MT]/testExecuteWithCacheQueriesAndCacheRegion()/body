{
  Query query1=mock(Query.class);
  Query query2=mock(Query.class);
  Criteria criteria=mock(Criteria.class);
  given(session.createQuery("some query")).willReturn(query1);
  given(query1.setCacheable(true)).willReturn(query1);
  given(query1.setCacheRegion("myRegion")).willReturn(query1);
  given(session.getNamedQuery("some query name")).willReturn(query2);
  given(query2.setCacheable(true)).willReturn(query2);
  given(query2.setCacheRegion("myRegion")).willReturn(query2);
  given(session.createCriteria(TestBean.class)).willReturn(criteria);
  given(criteria.setCacheable(true)).willReturn(criteria);
  given(criteria.setCacheRegion("myRegion")).willReturn(criteria);
  hibernateTemplate.setCacheQueries(true);
  hibernateTemplate.setQueryCacheRegion("myRegion");
  hibernateTemplate.execute(new HibernateCallback<Object>(){
    @Override public Object doInHibernate(    Session sess){
      assertNotSame(session,sess);
      assertTrue(Proxy.isProxyClass(sess.getClass()));
      sess.createQuery("some query");
      sess.getNamedQuery("some query name");
      sess.createCriteria(TestBean.class);
      sess.close();
      return null;
    }
  }
);
}
