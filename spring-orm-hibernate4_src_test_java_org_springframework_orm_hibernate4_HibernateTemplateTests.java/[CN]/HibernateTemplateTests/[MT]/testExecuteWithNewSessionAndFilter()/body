{
  given(sessionFactory.getCurrentSession()).willThrow(new HibernateException("no current session"));
  given(sessionFactory.openSession()).willReturn(session);
  hibernateTemplate.setFilterNames("myFilter");
  final List l=new ArrayList();
  l.add("test");
  List result=hibernateTemplate.execute(new HibernateCallback<List>(){
    @Override public List doInHibernate(    Session session){
      return l;
    }
  }
);
  assertTrue("Correct result list",result == l);
  verify(session).enableFilter("myFilter");
  verify(session).close();
}
