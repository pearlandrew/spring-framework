{
  logger.debug(request.getMethod() + " [" + sockJsPath+ "]");
  try {
    request.getHeaders();
  }
 catch (  IllegalArgumentException ex) {
  }
  try {
    if (sockJsPath.equals("") || sockJsPath.equals("/")) {
      response.getHeaders().setContentType(new MediaType("text","plain",Charset.forName("UTF-8")));
      response.getBody().write("Welcome to SockJS!\n".getBytes("UTF-8"));
      return;
    }
 else     if (sockJsPath.equals("/info")) {
      this.infoHandler.handle(request,response);
      return;
    }
 else     if (sockJsPath.matches("/iframe[0-9-.a-z_]*.html")) {
      this.iframeHandler.handle(request,response);
      return;
    }
 else     if (sockJsPath.equals("/websocket")) {
      handleRawWebSocketRequest(request,response,sockJsHandler);
      return;
    }
    String[] pathSegments=StringUtils.tokenizeToStringArray(sockJsPath.substring(1),"/");
    if (pathSegments.length != 3) {
      logger.debug("Expected /{server}/{session}/{transport} but got " + sockJsPath);
      response.setStatusCode(HttpStatus.NOT_FOUND);
      return;
    }
    String serverId=pathSegments[0];
    String sessionId=pathSegments[1];
    String transport=pathSegments[2];
    if (!validateRequest(serverId,sessionId,transport)) {
      response.setStatusCode(HttpStatus.NOT_FOUND);
      return;
    }
    handleTransportRequest(request,response,sessionId,TransportType.fromValue(transport),sockJsHandler);
  }
  finally {
    response.flush();
  }
}
