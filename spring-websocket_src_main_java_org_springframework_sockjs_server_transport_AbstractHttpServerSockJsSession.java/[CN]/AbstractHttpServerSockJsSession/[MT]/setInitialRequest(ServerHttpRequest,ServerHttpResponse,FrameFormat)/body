{
  try {
    udpateRequest(request,response,frameFormat);
    writePrelude();
    writeFrame(SockJsFrame.openFrame());
  }
 catch (  Throwable t) {
    tryCloseWithSockJsTransportError(t,null);
    throw new TransportErrorException("Failed open SockJS session",t,getId());
  }
  delegateConnectionEstablished();
}
