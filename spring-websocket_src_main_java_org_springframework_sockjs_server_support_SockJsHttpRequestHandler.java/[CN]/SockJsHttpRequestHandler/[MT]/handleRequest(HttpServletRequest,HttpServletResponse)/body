{
  String lookupPath=this.urlPathHelper.getLookupPathForRequest(request);
  Assert.isTrue(lookupPath.startsWith(this.prefix),"Request path does not match the prefix of the SockJsService " + this.prefix);
  String sockJsPath=lookupPath.substring(prefix.length());
  ServerHttpRequest httpRequest=new AsyncServletServerHttpRequest(request,response);
  ServerHttpResponse httpResponse=new ServletServerHttpResponse(response);
  try {
    WebSocketHandler webSocketHandler=this.handlerProvider.getHandler();
    this.sockJsService.handleRequest(httpRequest,httpResponse,sockJsPath,webSocketHandler);
  }
 catch (  Exception ex) {
    throw new NestedServletException("SockJS service failure",ex);
  }
}
