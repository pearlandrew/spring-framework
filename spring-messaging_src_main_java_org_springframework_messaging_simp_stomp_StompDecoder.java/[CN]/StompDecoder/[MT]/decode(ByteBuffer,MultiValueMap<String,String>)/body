{
  Assert.notNull(headers,"headers is required");
  List<Message<byte[]>> messages=new ArrayList<Message<byte[]>>();
  while (buffer.hasRemaining()) {
    Message<byte[]> m=decodeMessage(buffer,headers);
    if (m != null) {
      messages.add(m);
      headers.clear();
    }
 else {
      break;
    }
  }
  return messages;
}
