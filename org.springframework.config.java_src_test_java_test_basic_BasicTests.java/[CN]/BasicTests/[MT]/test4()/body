{
  DefaultListableBeanFactory factory=new DefaultListableBeanFactory();
  factory.registerBeanDefinition("config",rootBeanDefinition(Config2.class).getBeanDefinition());
  new ConfigurationPostProcessor().postProcessBeanFactory(factory);
  TestBean foo=factory.getBean("foo",TestBean.class);
  ITestBean bar=factory.getBean("bar",ITestBean.class);
  ITestBean baz=factory.getBean("baz",ITestBean.class);
  assertThat(foo.getSpouse(),sameInstance(bar));
  assertThat(bar.getSpouse(),not(sameInstance(baz)));
}
