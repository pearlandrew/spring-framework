{
  String format=(String)model.get(this.formatKey);
  if (format == null) {
    throw new IllegalArgumentException("No format found in model");
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Rendering report using format mapping key [" + format + "]");
  }
  Class<? extends AbstractJasperReportsView> viewClass=this.formatMappings.get(format);
  if (viewClass == null) {
    throw new IllegalArgumentException("Format discriminator [" + format + "] is not a configured mapping");
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Rendering report using view class [" + viewClass.getName() + "]");
  }
  AbstractJasperReportsView view=BeanUtils.instantiateClass(viewClass);
  view.setExporterParameters(getExporterParameters());
  view.setConvertedExporterParameters(getConvertedExporterParameters());
  populateContentDispositionIfNecessary(response,format);
  view.renderReport(populatedReport,model,response);
}
