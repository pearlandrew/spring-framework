{
  final Class<?> targetClass=AopUtils.getTargetClass(bean);
  ReflectionUtils.doWithMethods(targetClass,new MethodCallback(){
    public void doWith(    Method method) throws IllegalArgumentException, IllegalAccessException {
      Scheduled annotation=AnnotationUtils.getAnnotation(method,Scheduled.class);
      if (annotation != null) {
        Assert.isTrue(void.class.equals(method.getReturnType()),"Only void-returning methods may be annotated with @Scheduled.");
        Assert.isTrue(method.getParameterTypes().length == 0,"Only no-arg methods may be annotated with @Scheduled.");
        if (AopUtils.isJdkDynamicProxy(bean)) {
          try {
            method=bean.getClass().getMethod(method.getName(),method.getParameterTypes());
          }
 catch (          SecurityException ex) {
            ReflectionUtils.handleReflectionException(ex);
          }
catch (          NoSuchMethodException ex) {
            throw new IllegalStateException(String.format("@Scheduled method '%s' found on bean target class '%s', " + "but not found in any interface(s) for bean JDK proxy. Either " + "pull the method up to an interface or switch to subclass (CGLIB) "+ "proxies by setting proxy-target-class/proxyTargetClass "+ "attribute to 'true'",method.getName(),targetClass.getSimpleName()));
          }
        }
        Runnable runnable=new ScheduledMethodRunnable(bean,method);
        boolean processedSchedule=false;
        String errorMessage="Exactly one of the 'cron', 'fixedDelay', or 'fixedRate' attributes is required.";
        String cron=annotation.cron();
        if (!"".equals(cron)) {
          processedSchedule=true;
          if (embeddedValueResolver != null) {
            cron=embeddedValueResolver.resolveStringValue(cron);
          }
          registrar.addCronTask(new CronTask(runnable,cron));
        }
        long initialDelay=annotation.initialDelay();
        long fixedDelay=annotation.fixedDelay();
        if (fixedDelay >= 0) {
          Assert.isTrue(!processedSchedule,errorMessage);
          processedSchedule=true;
          registrar.addFixedDelayTask(new IntervalTask(runnable,fixedDelay,initialDelay));
        }
        long fixedRate=annotation.fixedRate();
        if (fixedRate >= 0) {
          Assert.isTrue(!processedSchedule,errorMessage);
          processedSchedule=true;
          registrar.addFixedRateTask(new IntervalTask(runnable,fixedRate,initialDelay));
        }
        Assert.isTrue(processedSchedule,errorMessage);
      }
    }
  }
);
  return bean;
}
