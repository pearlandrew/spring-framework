{
  MediaType mediaType=getMediaType(resource);
  if (mediaType != null) {
    return mediaType;
  }
  Class<PathExtensionContentNegotiationStrategy> clazz=PathExtensionContentNegotiationStrategy.class;
  PathExtensionContentNegotiationStrategy strategy=this.contentNegotiationManager.getStrategy(clazz);
  if (strategy != null) {
    mediaType=strategy.getMediaTypeForResource(resource);
  }
  if (mediaType == null) {
    ServletWebRequest webRequest=new ServletWebRequest(request);
    try {
      List<MediaType> mediaTypes=getContentNegotiationManager().resolveMediaTypes(webRequest);
      if (!mediaTypes.isEmpty()) {
        mediaType=mediaTypes.get(0);
      }
    }
 catch (    HttpMediaTypeNotAcceptableException ex) {
    }
  }
  return mediaType;
}
