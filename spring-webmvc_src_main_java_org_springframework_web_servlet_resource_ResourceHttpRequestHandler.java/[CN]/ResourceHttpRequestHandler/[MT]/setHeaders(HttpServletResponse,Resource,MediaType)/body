{
  long length=resource.contentLength();
  if (length > Integer.MAX_VALUE) {
    throw new IOException("Resource content too long (beyond Integer.MAX_VALUE): " + resource);
  }
  response.setContentLength((int)length);
  if (mediaType != null) {
    response.setContentType(mediaType.toString());
  }
  if (resource instanceof EncodedResource) {
    response.setHeader(HttpHeaders.CONTENT_ENCODING,((EncodedResource)resource).getContentEncoding());
  }
  if (resource instanceof VersionedResource) {
    response.setHeader(HttpHeaders.ETAG,"\"" + ((VersionedResource)resource).getVersion() + "\"");
  }
  response.setHeader(HttpHeaders.ACCEPT_RANGES,"bytes");
}
