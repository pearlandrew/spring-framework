{
  Set candidates=portletContext.getResourcePaths(dir);
  if (candidates != null) {
    boolean dirDepthNotFixed=(fullPattern.indexOf("**") != -1);
    for (Iterator it=candidates.iterator(); it.hasNext(); ) {
      String currPath=(String)it.next();
      if (currPath.endsWith("/") && (dirDepthNotFixed || StringUtils.countOccurrencesOf(currPath,"/") <= StringUtils.countOccurrencesOf(fullPattern,"/"))) {
        doRetrieveMatchingPortletContextResources(portletContext,fullPattern,currPath,result);
      }
      if (getPathMatcher().match(fullPattern,currPath)) {
        result.add(new PortletContextResource(portletContext,currPath));
      }
    }
  }
}
