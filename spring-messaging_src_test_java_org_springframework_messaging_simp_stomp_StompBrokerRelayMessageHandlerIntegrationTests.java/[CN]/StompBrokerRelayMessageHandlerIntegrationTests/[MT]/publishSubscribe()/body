{
  String sess1="sess1";
  MessageExchange conn1=MessageExchangeBuilder.connect(sess1).build();
  this.relay.handleMessage(conn1.message);
  this.responseHandler.expect(conn1);
  String sess2="sess2";
  MessageExchange conn2=MessageExchangeBuilder.connect(sess2).build();
  this.relay.handleMessage(conn2.message);
  this.responseHandler.expect(conn2);
  this.responseHandler.awaitAndAssert();
  String subs1="subs1";
  String destination="/topic/test";
  MessageExchange subscribe=MessageExchangeBuilder.subscribeWithReceipt(sess1,subs1,destination,"r1").build();
  this.relay.handleMessage(subscribe.message);
  this.responseHandler.expect(subscribe);
  this.responseHandler.awaitAndAssert();
  MessageExchange send=MessageExchangeBuilder.send(destination,"foo").andExpectMessage(sess1,subs1).build();
  this.responseHandler.expect(send);
  this.relay.handleMessage(send.message);
  this.responseHandler.awaitAndAssert();
}
