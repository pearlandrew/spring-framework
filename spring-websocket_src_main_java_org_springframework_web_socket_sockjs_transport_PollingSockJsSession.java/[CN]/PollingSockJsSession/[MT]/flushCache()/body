{
  cancelHeartbeat();
  String[] messages=getMessageCache().toArray(new String[getMessageCache().size()]);
  getMessageCache().clear();
  SockJsMessageCodec messageCodec=getSockJsConfig().getMessageCodecRequired();
  SockJsFrame frame=SockJsFrame.messageFrame(messageCodec,messages);
  writeFrame(frame);
}
