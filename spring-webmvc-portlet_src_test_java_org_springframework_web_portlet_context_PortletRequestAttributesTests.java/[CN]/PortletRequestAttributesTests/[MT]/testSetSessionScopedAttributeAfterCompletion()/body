{
  MockPortletSession session=new MockPortletSession();
  session.setAttribute(KEY,VALUE,PortletSession.PORTLET_SCOPE);
  MockPortletRequest request=new MockPortletRequest();
  request.setSession(session);
  PortletRequestAttributes attrs=new PortletRequestAttributes(request);
  assertSame(VALUE,attrs.getAttribute(KEY,RequestAttributes.SCOPE_SESSION));
  attrs.requestCompleted();
  request.close();
  attrs.setAttribute(KEY,VALUE,RequestAttributes.SCOPE_SESSION);
  assertSame(VALUE,session.getAttribute(KEY,PortletSession.PORTLET_SCOPE));
}
