{
  expect(converter.supports(String.class)).andReturn(true).times(2);
  expect(converter.supports(Integer.class)).andReturn(true).times(2);
  MediaType textPlain=new MediaType("text","plain");
  expect(converter.getSupportedMediaTypes()).andReturn(Collections.singletonList(textPlain)).times(2);
  expect(requestFactory.createRequest(new URI("http://example.com"),HttpMethod.POST)).andReturn(this.request);
  HttpHeaders requestHeaders=new HttpHeaders();
  expect(this.request.getHeaders()).andReturn(requestHeaders);
  String request="Hello World";
  converter.write(request,this.request);
  expect(this.request.execute()).andReturn(response);
  expect(errorHandler.hasError(response)).andReturn(false);
  HttpHeaders responseHeaders=new HttpHeaders();
  responseHeaders.setContentType(textPlain);
  expect(response.getHeaders()).andReturn(responseHeaders);
  Integer expected=42;
  expect(converter.read(Integer.class,response)).andReturn(expected);
  response.close();
  replayMocks();
  Integer result=template.postForObject("http://example.com",request,Integer.class);
  assertEquals("Invalid POST result",expected,result);
  assertEquals("Invalid Accept header",textPlain.toString(),requestHeaders.getFirst("Accept"));
  verifyMocks();
}
