{
  expect(requestFactory.createRequest(new URI("http://example.com"),HttpMethod.GET)).andReturn(request);
  expect(request.execute()).andReturn(response);
  expect(errorHandler.hasError(response)).andReturn(true);
  errorHandler.handleError(response);
  expectLastCall().andThrow(new HttpServerErrorException(HttpStatus.INTERNAL_SERVER_ERROR));
  response.close();
  replayMocks();
  try {
    template.execute("http://example.com",HttpMethod.GET,null,null);
    fail("HttpServerErrorException expected");
  }
 catch (  HttpServerErrorException ex) {
  }
  verifyMocks();
}
