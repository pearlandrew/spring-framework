{
  builder.logger.info("Closing Hibernate SessionFactory");
  DataSource dataSource=builder.getDataSource();
  if (dataSource != null) {
    SessionFactoryBuilderSupport.configTimeDataSourceHolder.set(dataSource);
  }
  try {
    builder.beforeSessionFactoryDestruction();
  }
  finally {
    this.sessionFactory.close();
    if (dataSource != null) {
      SessionFactoryBuilderSupport.configTimeDataSourceHolder.remove();
    }
  }
}
