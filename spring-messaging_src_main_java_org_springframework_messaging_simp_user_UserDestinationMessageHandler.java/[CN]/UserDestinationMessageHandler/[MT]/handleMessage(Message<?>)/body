{
  UserDestinationResult result=this.destinationResolver.resolveDestination(message);
  if (result == null) {
    return;
  }
  Set<String> destinations=result.getTargetDestinations();
  if (destinations.isEmpty()) {
    if (logger.isTraceEnabled()) {
      logger.trace("No user destinations found for " + result.getSourceDestination());
    }
    return;
  }
  if (SimpMessageType.MESSAGE.equals(SimpMessageHeaderAccessor.getMessageType(message.getHeaders()))) {
    SimpMessageHeaderAccessor accessor=SimpMessageHeaderAccessor.wrap(message);
    initHeaders(accessor);
    String header=SimpMessageHeaderAccessor.ORIGINAL_DESTINATION;
    accessor.setNativeHeader(header,result.getSubscribeDestination());
    message=MessageBuilder.createMessage(message.getPayload(),accessor.getMessageHeaders());
  }
  if (logger.isDebugEnabled()) {
    logger.debug("Translated " + result.getSourceDestination() + " -> "+ destinations);
  }
  for (  String destination : destinations) {
    this.messagingTemplate.send(destination,message);
  }
}
