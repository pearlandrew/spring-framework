{
  MediaType mediaType=null;
  String mimeType=getServletContext().getMimeType(resource.getFilename());
  if (StringUtils.hasText(mimeType)) {
    mediaType=MediaType.parseMediaType(mimeType);
  }
  if (jafPresent && (mediaType == null || MediaType.APPLICATION_OCTET_STREAM.equals(mediaType))) {
    MediaType jafMediaType=ActivationMediaTypeFactory.getMediaType(resource.getFilename());
    if (jafMediaType != null && !MediaType.APPLICATION_OCTET_STREAM.equals(jafMediaType)) {
      mediaType=jafMediaType;
    }
  }
  return mediaType;
}
