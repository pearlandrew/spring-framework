{
  GenericApplicationContext ctx=new GenericApplicationContext();
  new XmlBeanDefinitionReader(ctx).loadBeanDefinitions(new ClassPathResource("autodetectLazyMBeans.xml",getClass()));
  ctx.refresh();
  try {
    ctx.getBean("exporter");
    MBeanServer server=(MBeanServer)ctx.getBean("server");
    ObjectName oname=ObjectNameManager.getInstance("spring:mbean=true");
    assertNotNull(server.getObjectInstance(oname));
    String name=(String)server.getAttribute(oname,"Name");
    assertEquals("Invalid name returned","Rob Harrop",name);
    oname=ObjectNameManager.getInstance("spring:mbean=another");
    assertNotNull(server.getObjectInstance(oname));
    name=(String)server.getAttribute(oname,"Name");
    assertEquals("Invalid name returned","Juergen Hoeller",name);
  }
  finally {
    ctx.destroy();
  }
}
