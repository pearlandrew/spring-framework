{
  GenericApplicationContext ctx=new GenericApplicationContext();
  new XmlBeanDefinitionReader(ctx).loadBeanDefinitions(new ClassPathResource("autodetectMBeans.xml",getClass()));
  ctx.refresh();
  try {
    ctx.getBean("exporter");
    MBeanServer server=(MBeanServer)ctx.getBean("server");
    ObjectInstance instance=server.getObjectInstance(ObjectNameManager.getInstance("spring:mbean=true"));
    assertNotNull(instance);
    instance=server.getObjectInstance(ObjectNameManager.getInstance("spring:mbean2=true"));
    assertNotNull(instance);
    instance=server.getObjectInstance(ObjectNameManager.getInstance("spring:mbean3=true"));
    assertNotNull(instance);
  }
  finally {
    ctx.destroy();
  }
}
