{
  final String sqlToUse="UPDATE NOSUCHTABLE SET DATE_DISPATCHED = SYSDATE WHERE ID = ?";
  final String sql="UPDATE NOSUCHTABLE SET DATE_DISPATCHED = SYSDATE WHERE ID = :id";
  final SqlParameterSource[] ids=new SqlParameterSource[2];
  ids[0]=new MapSqlParameterSource("id",100);
  ids[1]=new MapSqlParameterSource("id",200);
  final int[] rowsAffected=new int[]{1,2};
  MockControl ctrlDataSource=MockControl.createControl(DataSource.class);
  DataSource mockDataSource=(DataSource)ctrlDataSource.getMock();
  MockControl ctrlConnection=MockControl.createControl(Connection.class);
  Connection mockConnection=(Connection)ctrlConnection.getMock();
  MockControl ctrlPreparedStatement=MockControl.createControl(PreparedStatement.class);
  PreparedStatement mockPreparedStatement=(PreparedStatement)ctrlPreparedStatement.getMock();
  MockControl ctrlDatabaseMetaData=MockControl.createControl(DatabaseMetaData.class);
  DatabaseMetaData mockDatabaseMetaData=(DatabaseMetaData)ctrlDatabaseMetaData.getMock();
  BatchUpdateTestHelper.prepareBatchUpdateMocks(sqlToUse,ids,null,rowsAffected,ctrlDataSource,mockDataSource,ctrlConnection,mockConnection,ctrlPreparedStatement,mockPreparedStatement,ctrlDatabaseMetaData,mockDatabaseMetaData);
  BatchUpdateTestHelper.replayBatchUpdateMocks(ctrlDataSource,ctrlConnection,ctrlPreparedStatement,ctrlDatabaseMetaData);
  JdbcTemplate template=new JdbcTemplate(mockDataSource,false);
  NamedParameterJdbcTemplate namedParameterJdbcTemplate=new NamedParameterJdbcTemplate(template);
  int[] actualRowsAffected=namedParameterJdbcTemplate.batchUpdate(sql,ids);
  assertTrue("executed 2 updates",actualRowsAffected.length == 2);
  assertEquals(rowsAffected[0],actualRowsAffected[0]);
  assertEquals(rowsAffected[1],actualRowsAffected[1]);
  BatchUpdateTestHelper.verifyBatchUpdateMocks(ctrlPreparedStatement,ctrlDatabaseMetaData);
}
