{
  this.messageHandler.start();
  this.messageHandler.handleMessage(createSubscriptionMessage("sess1","sub1","/foo"));
  this.messageHandler.handleMessage(createSubscriptionMessage("sess1","sub2","/foo"));
  this.messageHandler.handleMessage(createSubscriptionMessage("sess1","sub3","/bar"));
  this.messageHandler.handleMessage(createSubscriptionMessage("sess2","sub1","/foo"));
  this.messageHandler.handleMessage(createSubscriptionMessage("sess2","sub2","/foo"));
  this.messageHandler.handleMessage(createSubscriptionMessage("sess2","sub3","/bar"));
  this.messageHandler.handleMessage(createMessage("/foo","message1"));
  this.messageHandler.handleMessage(createMessage("/bar","message2"));
  verify(this.clientOutboundChannel,times(6)).send(this.messageCaptor.capture());
  assertCapturedMessage("sess1","sub1","/foo");
  assertCapturedMessage("sess1","sub2","/foo");
  assertCapturedMessage("sess2","sub1","/foo");
  assertCapturedMessage("sess2","sub2","/foo");
  assertCapturedMessage("sess1","sub3","/bar");
  assertCapturedMessage("sess2","sub3","/bar");
}
