{
  HttpHeaders requestHeaders=request.getHeaders();
  HttpHeaders responseHeaders=response.getHeaders();
  try {
    if (!CollectionUtils.isEmpty(responseHeaders.get("Access-Control-Allow-Origin"))) {
      logger.trace("Skip adding CORS headers, response already contains \"Access-Control-Allow-Origin\"");
      return;
    }
  }
 catch (  NullPointerException npe) {
  }
  String origin=requestHeaders.getFirst("origin");
  origin=((origin == null) || origin.equals("null")) ? "*" : origin;
  responseHeaders.add("Access-Control-Allow-Origin",origin);
  responseHeaders.add("Access-Control-Allow-Credentials","true");
  List<String> accessControllerHeaders=requestHeaders.get("Access-Control-Request-Headers");
  if (accessControllerHeaders != null) {
    for (    String header : accessControllerHeaders) {
      responseHeaders.add("Access-Control-Allow-Headers",header);
    }
  }
  if (!ObjectUtils.isEmpty(httpMethods)) {
    responseHeaders.add("Access-Control-Allow-Methods",StringUtils.arrayToDelimitedString(httpMethods,", "));
    responseHeaders.add("Access-Control-Max-Age",String.valueOf(ONE_YEAR));
  }
}
