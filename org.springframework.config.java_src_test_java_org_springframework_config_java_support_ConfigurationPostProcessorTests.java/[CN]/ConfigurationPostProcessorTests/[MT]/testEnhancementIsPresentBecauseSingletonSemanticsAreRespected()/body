{
  DefaultListableBeanFactory beanFactory=new DefaultListableBeanFactory();
  beanFactory.registerBeanDefinition("config",rootBeanDefinition(SingletonBeanConfig.class).getBeanDefinition());
  new ConfigurationClassPostProcessor().postProcessBeanFactory(beanFactory);
  Foo foo=(Foo)beanFactory.getBean("foo");
  Bar bar=(Bar)beanFactory.getBean("bar");
  assertThat(foo,sameInstance(bar.foo));
}
