{
  DataBuffer dataBuffer=subscriber.currentBuffer;
  try {
    boolean writeCompleted=subscriber.write(dataBuffer);
    if (writeCompleted) {
      if (dataBuffer instanceof FlushingDataBuffer) {
        subscriber.flush();
      }
      subscriber.releaseBuffer();
      boolean subscriptionCompleted=subscriber.subscriptionCompleted;
      if (!subscriptionCompleted) {
        if (subscriber.changeState(this,REQUESTED)) {
          subscriber.subscription.request(1);
        }
      }
 else {
        if (subscriber.changeState(this,COMPLETED)) {
          subscriber.close();
        }
      }
    }
  }
 catch (  IOException ex) {
    subscriber.onError(ex);
  }
}
