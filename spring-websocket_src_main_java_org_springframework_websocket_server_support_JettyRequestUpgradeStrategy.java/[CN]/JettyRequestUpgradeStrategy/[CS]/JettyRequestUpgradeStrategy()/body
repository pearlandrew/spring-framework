{
  this.factory=new WebSocketServerFactory();
  this.factory.setCreator(new WebSocketCreator(){
    @Override public Object createWebSocket(    UpgradeRequest request,    UpgradeResponse response){
      Assert.isInstanceOf(ServletWebSocketRequest.class,request);
      ServletWebSocketRequest servletRequest=(ServletWebSocketRequest)request;
      WebSocketHandler<?> webSocketHandler=(WebSocketHandler<?>)servletRequest.getServletAttributes().get(HANDLER_PROVIDER_ATTR_NAME);
      return new JettyWebSocketListenerAdapter(webSocketHandler);
    }
  }
);
  try {
    this.factory.init();
  }
 catch (  Exception ex) {
    throw new IllegalStateException(ex);
  }
}
