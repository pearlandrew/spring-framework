{
  Assert.state(this.factory.isUpgradeRequest(request,response),"Expected websocket upgrade request");
  request.setAttribute(HANDLER_PROVIDER_ATTR_NAME,webSocketHandler);
  if (!this.factory.acceptWebSocket(request,response)) {
    throw new HandshakeFailureException("WebSocket request not accepted by Jetty");
  }
}
