{
  EntityManagerHolder emHolder=(EntityManagerHolder)TransactionSynchronizationManager.getResource(emf);
  if (emHolder != null && emHolder.hasTimeout()) {
    int timeoutValue=(int)emHolder.getTimeToLiveInMillis();
    query.setHint("javax.persistence.lock.timeout",timeoutValue);
    query.setHint("javax.persistence.query.timeout",timeoutValue);
  }
}
