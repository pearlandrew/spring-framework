{
  ConnectionFactory connectionFactory=createMock(ConnectionFactory.class);
  Connection connection=createMock(Connection.class);
  Interaction interaction=createMock(Interaction.class);
  RecordFactory recordFactory=createMock(RecordFactory.class);
  Record inputRecord=createMock(Record.class);
  Record outputRecord=createMock(Record.class);
  InteractionSpec interactionSpec=createMock(InteractionSpec.class);
  QueryCallDetector callDetector=createMock(QueryCallDetector.class);
  MappingRecordOperationImpl query=new MappingRecordOperationImpl(connectionFactory,interactionSpec);
  query.setCallDetector(callDetector);
  Object inObj=new Object();
  Object outObj=new Object();
  expect(connectionFactory.getRecordFactory()).andReturn(recordFactory);
  expect(callDetector.callCreateInputRecord(recordFactory,inObj)).andReturn(inputRecord);
  expect(connectionFactory.getConnection()).andReturn(connection);
  expect(connection.createInteraction()).andReturn(interaction);
  expect(interaction.execute(interactionSpec,inputRecord)).andReturn(outputRecord);
  expect(callDetector.callExtractOutputData(outputRecord)).andReturn(outObj);
  interaction.close();
  connection.close();
  replay(connectionFactory,connection,interaction,callDetector);
  assertSame(outObj,query.execute(inObj));
  verify(connectionFactory,connection,interaction,callDetector);
}
