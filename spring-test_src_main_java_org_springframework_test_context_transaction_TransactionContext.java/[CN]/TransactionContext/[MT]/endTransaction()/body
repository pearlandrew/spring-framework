{
  if (logger.isTraceEnabled()) {
    logger.trace(String.format("Ending transaction for test context %s; transaction status [%s]; rollback [%s]",this.testContext,this.transactionStatus,flaggedForRollback));
  }
  if (this.transactionStatus == null) {
    throw new IllegalStateException(String.format("Failed to end transaction for test context %s: transaction does not exist.",this.testContext));
  }
  try {
    if (flaggedForRollback) {
      this.transactionManager.rollback(this.transactionStatus);
    }
 else {
      this.transactionManager.commit(this.transactionStatus);
    }
  }
  finally {
    this.transactionStatus=null;
  }
  if (logger.isInfoEnabled()) {
    logger.info(String.format("%s transaction after test execution for test context %s.",(flaggedForRollback ? "Rolled back" : "Committed"),this.testContext));
  }
}
