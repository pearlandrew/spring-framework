{
  ConnectionFactory cf=getTargetConnectionFactory();
  if (cf instanceof QueueConnectionFactory) {
    return ((QueueConnectionFactory)cf).createQueueConnection();
  }
 else {
    Connection con=cf.createConnection();
    if (!(con instanceof QueueConnection)) {
      throw new javax.jms.IllegalStateException("'targetConnectionFactory' is not a QueueConnectionFactory");
    }
    return (QueueConnection)con;
  }
}
