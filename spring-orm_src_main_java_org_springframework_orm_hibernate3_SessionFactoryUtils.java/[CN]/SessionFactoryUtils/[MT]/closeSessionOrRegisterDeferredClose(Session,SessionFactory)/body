{
  Map<SessionFactory,Set<Session>> holderMap=deferredCloseHolder.get();
  if (holderMap != null && sessionFactory != null && holderMap.containsKey(sessionFactory)) {
    logger.debug("Registering Hibernate Session for deferred close");
    session.setFlushMode(FlushMode.MANUAL);
    Set<Session> sessions=holderMap.get(sessionFactory);
    sessions.add(session);
  }
 else {
    closeSession(session);
  }
}
