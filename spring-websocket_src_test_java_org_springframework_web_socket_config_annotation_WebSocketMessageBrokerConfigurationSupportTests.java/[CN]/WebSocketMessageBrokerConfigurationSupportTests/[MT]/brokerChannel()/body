{
  ApplicationContext config=createConfig(TestChannelConfig.class,TestConfigurer.class);
  TestChannel channel=config.getBean("brokerChannel",TestChannel.class);
  Iterator<MessageHandler> handlers=channel.getSubscribers().iterator();
  List<ChannelInterceptor> interceptors=channel.getInterceptors();
  assertEquals(ImmutableMessageChannelInterceptor.class,interceptors.get(interceptors.size() - 1).getClass());
  assertEquals(SimpleBrokerMessageHandler.class,handlers.next().getClass());
  assertEquals(UserDestinationMessageHandler.class,handlers.next().getClass());
  assertFalse(handlers.hasNext());
}
