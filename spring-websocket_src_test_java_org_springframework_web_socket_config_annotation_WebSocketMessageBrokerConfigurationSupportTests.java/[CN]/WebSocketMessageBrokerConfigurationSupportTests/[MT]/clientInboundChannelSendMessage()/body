{
  ApplicationContext config=createConfig(TestChannelConfig.class,TestConfigurer.class);
  TestChannel channel=config.getBean("clientInboundChannel",TestChannel.class);
  SubProtocolWebSocketHandler webSocketHandler=config.getBean(SubProtocolWebSocketHandler.class);
  WebSocketSession session=new TestWebSocketSession("s1");
  webSocketHandler.afterConnectionEstablished(session);
  TextMessage textMessage=StompTextMessageBuilder.create(StompCommand.SEND).headers("destination:/foo").build();
  webSocketHandler.handleMessage(session,textMessage);
  Message<?> message=channel.messages.get(0);
  StompHeaderAccessor headers=StompHeaderAccessor.wrap(message);
  assertEquals(SimpMessageType.MESSAGE,headers.getMessageType());
  assertEquals("/foo",headers.getDestination());
}
