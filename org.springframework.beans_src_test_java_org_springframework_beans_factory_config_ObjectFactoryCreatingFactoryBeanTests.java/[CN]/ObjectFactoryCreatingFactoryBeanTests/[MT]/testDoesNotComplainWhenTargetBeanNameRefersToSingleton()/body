{
  final String targetBeanName="singleton";
  final String expectedSingleton="Alicia Keys";
  BeanFactory beanFactory=createMock(BeanFactory.class);
  expect(beanFactory.getBean(targetBeanName)).andReturn(expectedSingleton);
  replay(beanFactory);
  ObjectFactoryCreatingFactoryBean factory=new ObjectFactoryCreatingFactoryBean();
  factory.setTargetBeanName(targetBeanName);
  factory.setBeanFactory(beanFactory);
  factory.afterPropertiesSet();
  ObjectFactory<?> objectFactory=(ObjectFactory<?>)factory.getObject();
  Object actualSingleton=objectFactory.getObject();
  assertSame(expectedSingleton,actualSingleton);
  verify(beanFactory);
}
