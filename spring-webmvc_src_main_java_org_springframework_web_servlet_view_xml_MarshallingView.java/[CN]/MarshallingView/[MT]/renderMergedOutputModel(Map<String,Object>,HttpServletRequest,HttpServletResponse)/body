{
  Object toBeMarshalled=locateToBeMarshalled(model);
  if (toBeMarshalled == null) {
    throw new IllegalStateException("Unable to locate object to be marshalled in model: " + model);
  }
  ByteArrayOutputStream bos=new ByteArrayOutputStream(2048);
  this.marshaller.marshal(toBeMarshalled,new StreamResult(bos));
  setResponseContentType(request,response);
  response.setContentLength(bos.size());
  StreamUtils.copy(bos.toByteArray(),response.getOutputStream());
}
