{
  if (this.modelKey != null) {
    Object obj=model.get(this.modelKey);
    if (obj == null) {
      throw new IllegalStateException("Model contains no object with key [" + this.modelKey + "]");
    }
    if (!this.marshaller.supports(obj.getClass())) {
      throw new IllegalStateException("Model object [" + obj + "] retrieved via key ["+ this.modelKey+ "] is not supported by the Marshaller");
    }
    return obj;
  }
  for (  Object obj : model.values()) {
    if (obj != null && (model.size() == 1 || !(obj instanceof BindingResult)) && this.marshaller.supports(obj.getClass())) {
      return obj;
    }
  }
  return null;
}
