{
  if (this.encoder == null) {
    return Mono.error(new IllegalStateException("No decoder set"));
  }
  HttpHeaders headers=outputMessage.getHeaders();
  if (headers.getContentType() == null) {
    headers.setContentType(contentType);
  }
  DataBufferAllocator allocator=outputMessage.allocator();
  Flux<DataBuffer> body=this.encoder.encode(inputStream,allocator,type,contentType);
  return outputMessage.setBody(body);
}
