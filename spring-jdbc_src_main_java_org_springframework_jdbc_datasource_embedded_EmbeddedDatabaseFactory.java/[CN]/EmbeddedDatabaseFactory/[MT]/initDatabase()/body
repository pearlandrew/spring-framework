{
  if (this.generateUniqueDatabaseName) {
    setDatabaseName(UUID.randomUUID().toString());
  }
  if (logger.isInfoEnabled()) {
    logger.info("Creating embedded database '" + this.databaseName + "'");
  }
  if (this.databaseConfigurer == null) {
    this.databaseConfigurer=EmbeddedDatabaseConfigurerFactory.getConfigurer(EmbeddedDatabaseType.HSQL);
  }
  this.databaseConfigurer.configureConnectionProperties(this.dataSourceFactory.getConnectionProperties(),this.databaseName);
  this.dataSource=this.dataSourceFactory.getDataSource();
  if (this.databasePopulator != null) {
    try {
      DatabasePopulatorUtils.execute(this.databasePopulator,this.dataSource);
    }
 catch (    RuntimeException ex) {
      shutdownDatabase();
      throw ex;
    }
  }
}
