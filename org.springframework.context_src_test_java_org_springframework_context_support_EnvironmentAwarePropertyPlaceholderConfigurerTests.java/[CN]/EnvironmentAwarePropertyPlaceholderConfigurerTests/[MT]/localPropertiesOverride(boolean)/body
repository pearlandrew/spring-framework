{
  DefaultListableBeanFactory bf=new DefaultListableBeanFactory();
  bf.registerBeanDefinition("testBean",genericBeanDefinition(TestBean.class).addPropertyValue("name","${foo}").getBeanDefinition());
  EnvironmentAwarePropertyPlaceholderConfigurer ppc=new EnvironmentAwarePropertyPlaceholderConfigurer();
  ppc.setLocalOverride(override);
  ppc.setProperties(MockEnvironment.withProperty("foo","local").asProperties());
  ppc.setEnvironment(MockEnvironment.withProperty("foo","enclosing"));
  ppc.postProcessBeanFactory(bf);
  if (override) {
    assertThat(bf.getBean(TestBean.class).getName(),equalTo("local"));
  }
 else {
    assertThat(bf.getBean(TestBean.class).getName(),equalTo("enclosing"));
  }
}
