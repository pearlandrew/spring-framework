{
  Endpoint endpoint=this.webSocketHandlers.get(webSocketHandler);
  if (endpoint == null) {
    endpoint=adaptWebSocketHandler(webSocketHandler);
  }
  if (logger.isTraceEnabled()) {
    logger.trace("Upgrading with " + endpoint);
  }
  upgradeInternal(request,response,protocol,endpoint);
}
