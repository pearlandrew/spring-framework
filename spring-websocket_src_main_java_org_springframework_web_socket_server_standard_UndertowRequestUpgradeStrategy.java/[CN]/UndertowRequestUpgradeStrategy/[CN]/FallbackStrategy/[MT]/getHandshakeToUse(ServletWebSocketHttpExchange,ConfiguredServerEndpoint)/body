{
  Handshake handshake=new JsrHybi13Handshake(endpoint);
  if (handshake.matches(exchange)) {
    return handshake;
  }
  handshake=new JsrHybi08Handshake(endpoint);
  if (handshake.matches(exchange)) {
    return handshake;
  }
  handshake=new JsrHybi07Handshake(endpoint);
  if (handshake.matches(exchange)) {
    return handshake;
  }
  throw new HandshakeFailureException("No matching Undertow Handshake found: " + exchange.getRequestHeaders());
}
