{
  beanFactory.setBeanClassLoader(getClassLoader());
  beanFactory.setBeanExpressionResolver(new StandardBeanExpressionResolver());
  beanFactory.addPropertyEditorRegistrar(new ResourceEditorRegistrar(this));
  beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this));
  beanFactory.ignoreDependencyInterface(ResourceLoaderAware.class);
  beanFactory.ignoreDependencyInterface(ApplicationEventPublisherAware.class);
  beanFactory.ignoreDependencyInterface(MessageSourceAware.class);
  beanFactory.ignoreDependencyInterface(ApplicationContextAware.class);
  beanFactory.registerResolvableDependency(BeanFactory.class,beanFactory);
  beanFactory.registerResolvableDependency(ResourceLoader.class,this);
  beanFactory.registerResolvableDependency(ApplicationEventPublisher.class,this);
  beanFactory.registerResolvableDependency(ApplicationContext.class,this);
  if (beanFactory.containsBean(LOAD_TIME_WEAVER_BEAN_NAME)) {
    beanFactory.addBeanPostProcessor(new LoadTimeWeaverAwareProcessor(beanFactory));
    beanFactory.setTempClassLoader(new ContextTypeMatchClassLoader(beanFactory.getBeanClassLoader()));
  }
  if (!beanFactory.containsBean(SYSTEM_PROPERTIES_BEAN_NAME)) {
    Properties systemProperties;
    try {
      systemProperties=System.getProperties();
    }
 catch (    AccessControlException ex) {
      if (logger.isInfoEnabled()) {
        logger.info("Not allowed to obtain system properties: " + ex.getMessage());
      }
      systemProperties=new Properties();
    }
    beanFactory.registerSingleton(SYSTEM_PROPERTIES_BEAN_NAME,systemProperties);
  }
  if (!beanFactory.containsBean(SYSTEM_ENVIRONMENT_BEAN_NAME)) {
    Map<String,String> systemEnvironment;
    try {
      systemEnvironment=System.getenv();
    }
 catch (    AccessControlException ex) {
      if (logger.isInfoEnabled()) {
        logger.info("Not allowed to obtain system environment: " + ex.getMessage());
      }
      systemEnvironment=Collections.emptyMap();
    }
    beanFactory.registerSingleton(SYSTEM_ENVIRONMENT_BEAN_NAME,systemEnvironment);
  }
}
