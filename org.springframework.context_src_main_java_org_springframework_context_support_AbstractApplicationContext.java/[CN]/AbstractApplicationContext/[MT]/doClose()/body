{
  if (isActive()) {
    if (logger.isInfoEnabled()) {
      logger.info("Closing " + this);
    }
    try {
      publishEvent(new ContextClosedEvent(this));
    }
 catch (    Throwable ex) {
      logger.error("Exception thrown from ApplicationListener handling ContextClosedEvent",ex);
    }
    Map<String,Lifecycle> lifecycleBeans=getLifecycleBeans();
    for (    String beanName : new LinkedHashSet<String>(lifecycleBeans.keySet())) {
      doStop(lifecycleBeans,beanName);
    }
    destroyBeans();
    closeBeanFactory();
    onClose();
synchronized (this.activeMonitor) {
      this.active=false;
    }
  }
}
