{
  if (outputMessage instanceof StreamingHttpOutputMessage) {
    StreamingHttpOutputMessage streamingOutputMessage=(StreamingHttpOutputMessage)outputMessage;
    streamingOutputMessage.setBody(new StreamingHttpOutputMessage.Body(){
      @Override public void writeTo(      OutputStream outputStream) throws IOException {
        writeInternal(image,contentType,outputMessage.getHeaders(),outputStream);
      }
    }
);
  }
 else {
    writeInternal(image,contentType,outputMessage.getHeaders(),outputMessage.getBody());
  }
}
