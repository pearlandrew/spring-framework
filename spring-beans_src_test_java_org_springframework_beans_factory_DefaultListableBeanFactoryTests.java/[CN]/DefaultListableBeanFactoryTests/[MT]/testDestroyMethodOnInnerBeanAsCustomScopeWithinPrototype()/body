{
  DefaultListableBeanFactory lbf=new DefaultListableBeanFactory();
  RootBeanDefinition innerBd=new RootBeanDefinition(BeanWithDestroyMethod.class);
  innerBd.setScope("custom");
  innerBd.setDestroyMethodName("close");
  RootBeanDefinition bd=new RootBeanDefinition(BeanWithDestroyMethod.class);
  bd.setScope(RootBeanDefinition.SCOPE_PROTOTYPE);
  bd.setDestroyMethodName("close");
  bd.getPropertyValues().add("inner",innerBd);
  lbf.registerBeanDefinition("test",bd);
  BeanWithDestroyMethod.closeCount=0;
  Object prototypeInstance=lbf.getBean("test");
  lbf.destroyBean("test",prototypeInstance);
  assertEquals("Destroy methods not invoked",1,BeanWithDestroyMethod.closeCount);
}
