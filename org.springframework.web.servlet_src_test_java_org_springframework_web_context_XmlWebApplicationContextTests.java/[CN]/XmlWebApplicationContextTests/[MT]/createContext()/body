{
  InitAndIB.constructed=false;
  root=new XmlWebApplicationContext();
  MockServletContext sc=new MockServletContext("");
  root.setServletContext(sc);
  root.setConfigLocations(new String[]{"/org/springframework/web/context/WEB-INF/applicationContext.xml"});
  root.addBeanFactoryPostProcessor(new BeanFactoryPostProcessor(){
    public void postProcessBeanFactory(    ConfigurableListableBeanFactory beanFactory){
      beanFactory.addBeanPostProcessor(new BeanPostProcessor(){
        public Object postProcessBeforeInitialization(        Object bean,        String name) throws BeansException {
          if (bean instanceof TestBean) {
            ((TestBean)bean).getFriends().add("myFriend");
          }
          return bean;
        }
        public Object postProcessAfterInitialization(        Object bean,        String name) throws BeansException {
          return bean;
        }
      }
);
    }
  }
);
  root.refresh();
  XmlWebApplicationContext wac=new XmlWebApplicationContext();
  wac.setParent(root);
  wac.setServletContext(sc);
  wac.setNamespace("test-servlet");
  wac.setConfigLocations(new String[]{"/org/springframework/web/context/WEB-INF/test-servlet.xml"});
  wac.refresh();
  return wac;
}
