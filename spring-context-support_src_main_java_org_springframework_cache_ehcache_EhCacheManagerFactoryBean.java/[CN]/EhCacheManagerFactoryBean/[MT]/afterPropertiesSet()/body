{
  logger.info("Initializing EhCache CacheManager");
  InputStream is=(this.configLocation != null ? this.configLocation.getInputStream() : null);
  try {
    if (this.cacheManagerName != null) {
      if (this.shared && createWithConfiguration == null) {
        this.cacheManager=(is != null ? CacheManager.create(is) : CacheManager.create());
        this.cacheManager.setName(this.cacheManagerName);
      }
 else {
        Configuration configuration=(is != null ? ConfigurationFactory.parseConfiguration(is) : ConfigurationFactory.parseConfiguration());
        configuration.setName(this.cacheManagerName);
        if (this.shared) {
          this.cacheManager=(CacheManager)ReflectionUtils.invokeMethod(createWithConfiguration,null,configuration);
        }
 else {
          this.cacheManager=new CacheManager(configuration);
        }
      }
    }
 else     if (this.shared) {
      this.cacheManager=(is != null ? CacheManager.create(is) : CacheManager.create());
    }
 else {
      this.cacheManager=(is != null ? new CacheManager(is) : new CacheManager());
    }
  }
  finally {
    if (is != null) {
      is.close();
    }
  }
}
