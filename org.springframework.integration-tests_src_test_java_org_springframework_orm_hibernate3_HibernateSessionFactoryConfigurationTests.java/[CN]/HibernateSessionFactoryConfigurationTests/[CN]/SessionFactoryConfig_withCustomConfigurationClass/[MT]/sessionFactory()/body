{
  SessionFactoryBuilder sfb=new SessionFactoryBuilder(dataSource()).setSchemaUpdate(true).setConfigurationClass(CustomHibernateConfiguration.class).doWithConfiguration(new HibernateConfigurationCallback<org.hibernate.cfg.Configuration>(){
    public void configure(    org.hibernate.cfg.Configuration configuration) throws Exception {
      configuration.addFile(new File(this.getClass().getClassLoader().getResource("org/springframework/orm/hibernate3/scannable/FooMapping.hbm.xml").toURI()));
    }
  }
);
  assertThat(sfb.getConfiguration(),instanceOf(CustomHibernateConfiguration.class));
  return sfb.buildSessionFactory();
}
