{
  Assert.notNull(factory,"WebSocketServerFactory is required");
  this.factory=factory;
  this.factory.setCreator(new WebSocketCreator(){
    @Override public Object createWebSocket(    UpgradeRequest request,    UpgradeResponse response){
      WebSocketHandlerContainer container=wsContainerHolder.get();
      Assert.state(container != null,"Expected WebSocketHandlerContainer");
      response.setAcceptedSubProtocol(container.getSelectedProtocol());
      response.setExtensions(container.getExtensionConfigs());
      return container.getHandler();
    }
  }
);
  try {
    this.factory.init();
  }
 catch (  Exception ex) {
    throw new IllegalStateException("Unable to initialize Jetty WebSocketServerFactory",ex);
  }
}
