{
  Map<String,Lifecycle> beans=new LinkedHashMap<String,Lifecycle>();
  Map<String,SmartLifecycle> smartLifecycles=this.beanFactory.getBeansOfType(SmartLifecycle.class,false,true);
  beans.putAll(smartLifecycles);
  String[] singletonNames=this.beanFactory.getSingletonNames();
  for (  String beanName : singletonNames) {
    if (!beans.containsKey(beanName)) {
      Object bean=this.beanFactory.getSingleton(beanName);
      if (bean instanceof Lifecycle && !this.equals(bean)) {
        beans.put(beanName,(Lifecycle)bean);
      }
    }
  }
  return beans;
}
