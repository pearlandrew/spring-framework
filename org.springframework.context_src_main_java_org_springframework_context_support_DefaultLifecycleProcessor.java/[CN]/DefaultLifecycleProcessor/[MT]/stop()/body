{
  Map<String,Lifecycle> lifecycleBeans=getLifecycleBeans();
  Map<Integer,ShutdownGroup> shutdownGroups=new HashMap<Integer,ShutdownGroup>();
  for (  Map.Entry<String,Lifecycle> entry : lifecycleBeans.entrySet()) {
    Lifecycle lifecycle=entry.getValue();
    int shutdownOrder=getShutdownOrder(lifecycle);
    ShutdownGroup group=shutdownGroups.get(shutdownOrder);
    if (group == null) {
      group=new ShutdownGroup(shutdownOrder,this.shutdownGroupTimeout,lifecycleBeans);
      shutdownGroups.put(shutdownOrder,group);
    }
    group.add(entry.getKey(),lifecycle);
  }
  if (shutdownGroups.size() > 0) {
    List<Integer> keys=new ArrayList<Integer>(shutdownGroups.keySet());
    Collections.sort(keys);
    for (    Integer key : keys) {
      shutdownGroups.get(key).shutdown();
    }
  }
  this.running=false;
}
