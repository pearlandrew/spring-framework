{
  Lifecycle bean=lifecycleBeans.get(beanName);
  if (bean != null) {
    String[] dependentBeans=this.beanFactory.getDependentBeans(beanName);
    for (    String dependentBean : dependentBeans) {
      doStop(lifecycleBeans,dependentBean,latch);
    }
    if (bean.isRunning()) {
      if (bean instanceof SmartLifecycle) {
        ((SmartLifecycle)bean).stop(new Runnable(){
          public void run(){
            latch.countDown();
          }
        }
);
      }
 else {
        bean.stop();
      }
    }
 else     if (bean instanceof SmartLifecycle) {
      latch.countDown();
    }
    lifecycleBeans.remove(beanName);
  }
}
