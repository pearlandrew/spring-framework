{
  Ruby ruby=initializeRuntime();
  Node scriptRootNode=ruby.parseEval(scriptSource,"",null,0);
  IRubyObject rubyObject=ruby.runNormally(scriptRootNode,false);
  if (rubyObject instanceof RubyNil) {
    String className=findClassName(scriptRootNode);
    rubyObject=ruby.evalScriptlet("\n" + className + ".new");
  }
  if (rubyObject instanceof RubyNil) {
    throw new IllegalStateException("Compilation of JRuby script returned RubyNil: " + rubyObject);
  }
  return Proxy.newProxyInstance(classLoader,interfaces,new RubyObjectInvocationHandler(rubyObject,ruby));
}
