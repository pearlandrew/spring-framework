{
  final SimpleMessageConsumer messageConsumer=new SimpleMessageConsumer();
  MockControl mockSession=MockControl.createControl(Session.class);
  Session session=(Session)mockSession.getMock();
  session.createQueue(DESTINATION_NAME);
  mockSession.setReturnValue(QUEUE_DESTINATION);
  session.createConsumer(QUEUE_DESTINATION,null);
  mockSession.setReturnValue(messageConsumer);
  session.getTransacted();
  mockSession.setReturnValue(false);
  mockSession.replay();
  MockControl mockConnection=MockControl.createControl(Connection.class);
  Connection connection=(Connection)mockConnection.getMock();
  connection.setExceptionListener(this.container);
  mockConnection.setVoidCallable();
  connection.createSession(this.container.isSessionTransacted(),this.container.getSessionAcknowledgeMode());
  mockConnection.setReturnValue(session);
  connection.start();
  mockConnection.setVoidCallable();
  mockConnection.replay();
  MockControl mockConnectionFactory=MockControl.createControl(ConnectionFactory.class);
  ConnectionFactory connectionFactory=(ConnectionFactory)mockConnectionFactory.getMock();
  connectionFactory.createConnection();
  mockConnectionFactory.setReturnValue(connection);
  mockConnectionFactory.replay();
  final JMSException theException=new JMSException(EXCEPTION_MESSAGE);
  this.container.setConnectionFactory(connectionFactory);
  this.container.setDestinationName(DESTINATION_NAME);
  this.container.setMessageListener(new SessionAwareMessageListener(){
    public void onMessage(    Message message,    Session session) throws JMSException {
      throw theException;
    }
  }
);
  MockControl mockExceptionListener=MockControl.createControl(ExceptionListener.class);
  ExceptionListener exceptionListener=(ExceptionListener)mockExceptionListener.getMock();
  exceptionListener.onException(theException);
  mockExceptionListener.setVoidCallable();
  mockExceptionListener.replay();
  this.container.setExceptionListener(exceptionListener);
  this.container.afterPropertiesSet();
  MockControl mockMessage=MockControl.createControl(Message.class);
  final Message message=(Message)mockMessage.getMock();
  mockMessage.replay();
  messageConsumer.sendMessage(message);
  mockExceptionListener.verify();
  mockMessage.verify();
  mockSession.verify();
  mockConnection.verify();
  mockConnectionFactory.verify();
}
