{
  MockHttpSession session=new MockHttpSession();
  session.setAttribute(KEY,VALUE);
  MockHttpServletRequest request=new MockHttpServletRequest();
  request.setSession(session);
  ServletRequestAttributes attrs=new ServletRequestAttributes(request);
  attrs.requestCompleted();
  request.close();
  attrs.setAttribute(KEY,VALUE,RequestAttributes.SCOPE_GLOBAL_SESSION);
  Object value=session.getAttribute(KEY);
  assertSame(VALUE,value);
}
