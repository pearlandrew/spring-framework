{
  TransactionAttribute txatt=new DefaultTransactionAttribute();
  Method m=setNameMethod;
  MapTransactionAttributeSource tas=new MapTransactionAttributeSource();
  tas.register(m,txatt);
  Method m2=getNameMethod;
  MockControl ptmControl=MockControl.createControl(PlatformTransactionManager.class);
  PlatformTransactionManager ptm=(PlatformTransactionManager)ptmControl.getMock();
  TransactionStatus status=transactionStatusForNewTransaction();
  ptm.getTransaction(txatt);
  ptmControl.setReturnValue(status);
  UnexpectedRollbackException ex=new UnexpectedRollbackException("foobar",null);
  ptm.commit(status);
  ptmControl.setThrowable(ex);
  ptmControl.replay();
  TestBean tb=new TestBean();
  ITestBean itb=(ITestBean)advised(tb,ptm,tas);
  String name="new name";
  try {
    itb.setName(name);
    fail("Shouldn't have succeeded");
  }
 catch (  UnexpectedRollbackException thrown) {
    assertTrue(thrown == ex);
  }
  assertTrue(itb.getName() == name);
  ptmControl.verify();
}
