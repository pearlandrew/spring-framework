{
  MessageDigest messageDigest=getDigest(algorithm);
  if (inputStream instanceof UpdateMessageDigestInputStream) {
    ((UpdateMessageDigestInputStream)inputStream).updateMessageDigest(messageDigest);
    return messageDigest.digest();
  }
 else {
    return messageDigest.digest(StreamUtils.copyToByteArray(inputStream));
  }
}
