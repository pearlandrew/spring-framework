{
  MessageConverter converter=getMessageConverter();
  if (converter != null) {
    if (result instanceof org.springframework.messaging.Message) {
      return messagingMessageConverter.toMessage(result,session);
    }
 else {
      return converter.toMessage(result,session);
    }
  }
 else {
    if (!(result instanceof Message)) {
      throw new MessageConversionException("No MessageConverter specified - cannot handle message [" + result + "]");
    }
    return (Message)result;
  }
}
