{
  Object content=(result instanceof JmsResponse ? ((JmsResponse)result).getResponse() : result);
  MessageConverter converter=getMessageConverter();
  if (converter != null) {
    if (content instanceof org.springframework.messaging.Message) {
      return this.messagingMessageConverter.toMessage(content,session);
    }
 else {
      return converter.toMessage(content,session);
    }
  }
 else {
    if (!(content instanceof Message)) {
      throw new MessageConversionException("No MessageConverter specified - cannot handle message [" + content + "]");
    }
    return (Message)content;
  }
}
