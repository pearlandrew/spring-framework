{
  Method handler=getExceptionHandler(ex);
  if (handler != null) {
    if (logger.isDebugEnabled()) {
      logger.debug("Invoking exception handler [" + handler + "] for exception: "+ ex);
    }
    try {
      Object returnValue=handler.invoke(this.delegate,request,response,ex);
      return massageReturnValueIfNecessary(returnValue);
    }
 catch (    InvocationTargetException ex2) {
      logger.error("Original exception overridden by exception handling failure",ex);
      ReflectionUtils.rethrowException(ex2.getTargetException());
    }
catch (    Exception ex2) {
      logger.error("Failed to invoke exception handler method",ex2);
    }
  }
 else {
    ReflectionUtils.rethrowException(ex);
  }
  throw new IllegalStateException("Should never get here");
}
