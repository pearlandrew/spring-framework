{
  EmbeddedDatabaseBuilder builder=new EmbeddedDatabaseBuilder();
  EmbeddedDatabase db=builder.build();
  ResourceDatabasePopulator databasePopulator=new ResourceDatabasePopulator();
  ClassRelativeResourceLoader resourceLoader=new ClassRelativeResourceLoader(getClass());
  databasePopulator.addScript(resourceLoader.getResource("db-schema-failed-drop-comments.sql"));
  databasePopulator.addScript(resourceLoader.getResource("db-test-data.sql"));
  databasePopulator.setIgnoreFailedDrops(true);
  Connection connection=db.getConnection();
  try {
    databasePopulator.populate(connection);
  }
  finally {
    connection.close();
  }
  assertDatabaseCreated(db);
  db.shutdown();
}
