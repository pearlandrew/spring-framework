{
  if (getDefaultUriVariables().isEmpty() && !isStrictEncoding()) {
    return builder.build().expand(uriVariables).encode();
  }
  Map<String,Object> variablesToUse=new HashMap<String,Object>();
  variablesToUse.putAll(getDefaultUriVariables());
  variablesToUse.putAll(uriVariables);
  if (!isStrictEncoding()) {
    return builder.build().expand(variablesToUse).encode();
  }
 else {
    for (    Map.Entry<String,?> entry : variablesToUse.entrySet()) {
      variablesToUse.put(entry.getKey(),applyStrictEncoding(entry.getValue()));
    }
    return builder.build().expand(variablesToUse);
  }
}
