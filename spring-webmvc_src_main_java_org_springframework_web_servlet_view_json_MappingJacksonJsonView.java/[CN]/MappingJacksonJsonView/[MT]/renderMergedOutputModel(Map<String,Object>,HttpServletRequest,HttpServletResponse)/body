{
  OutputStream stream=this.updateContentLength ? createTemporaryOutputStream() : response.getOutputStream();
  Object value=filterModel(model);
  JsonGenerator generator=this.objectMapper.getJsonFactory().createJsonGenerator(stream,this.encoding);
  if (this.objectMapper.getSerializationConfig().isEnabled(SerializationConfig.Feature.INDENT_OUTPUT)) {
    generator.useDefaultPrettyPrinter();
  }
  if (this.prefixJson) {
    generator.writeRaw("{} && ");
  }
  this.objectMapper.writeValue(generator,value);
  if (this.updateContentLength) {
    writeToResponse(response,(ByteArrayOutputStream)stream);
  }
}
