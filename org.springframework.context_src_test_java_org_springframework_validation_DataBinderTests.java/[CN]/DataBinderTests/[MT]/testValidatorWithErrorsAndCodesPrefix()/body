{
  TestBean tb=new TestBean();
  tb.setSpouse(new TestBean());
  BeanPropertyBindingResult errors=new BeanPropertyBindingResult(tb,"tb");
  DefaultMessageCodesResolver codesResolver=new DefaultMessageCodesResolver();
  codesResolver.setPrefix("validation.");
  errors.setMessageCodesResolver(codesResolver);
  Validator testValidator=new TestBeanValidator();
  testValidator.validate(tb,errors);
  errors.setNestedPath("spouse.");
  assertEquals("spouse.",errors.getNestedPath());
  Validator spouseValidator=new SpouseValidator();
  spouseValidator.validate(tb.getSpouse(),errors);
  errors.setNestedPath("");
  assertTrue(errors.hasErrors());
  assertEquals(6,errors.getErrorCount());
  assertEquals(2,errors.getGlobalErrorCount());
  assertEquals("validation.NAME_TOUCHY_MISMATCH",errors.getGlobalError().getCode());
  assertEquals("validation.NAME_TOUCHY_MISMATCH",(errors.getGlobalErrors().get(0)).getCode());
  assertEquals("validation.NAME_TOUCHY_MISMATCH.tb",(errors.getGlobalErrors().get(0)).getCodes()[0]);
  assertEquals("validation.NAME_TOUCHY_MISMATCH",(errors.getGlobalErrors().get(0)).getCodes()[1]);
  assertEquals("tb",(errors.getGlobalErrors().get(0)).getObjectName());
  assertEquals("validation.GENERAL_ERROR",(errors.getGlobalErrors().get(1)).getCode());
  assertEquals("validation.GENERAL_ERROR.tb",(errors.getGlobalErrors().get(1)).getCodes()[0]);
  assertEquals("validation.GENERAL_ERROR",(errors.getGlobalErrors().get(1)).getCodes()[1]);
  assertEquals("msg",(errors.getGlobalErrors().get(1)).getDefaultMessage());
  assertEquals("arg",(errors.getGlobalErrors().get(1)).getArguments()[0]);
  assertTrue(errors.hasFieldErrors());
  assertEquals(4,errors.getFieldErrorCount());
  assertEquals("validation.TOO_YOUNG",errors.getFieldError().getCode());
  assertEquals("validation.TOO_YOUNG",(errors.getFieldErrors().get(0)).getCode());
  assertEquals("age",(errors.getFieldErrors().get(0)).getField());
  assertEquals("validation.AGE_NOT_ODD",(errors.getFieldErrors().get(1)).getCode());
  assertEquals("age",(errors.getFieldErrors().get(1)).getField());
  assertEquals("validation.NOT_ROD",(errors.getFieldErrors().get(2)).getCode());
  assertEquals("name",(errors.getFieldErrors().get(2)).getField());
  assertEquals("validation.TOO_YOUNG",(errors.getFieldErrors().get(3)).getCode());
  assertEquals("spouse.age",(errors.getFieldErrors().get(3)).getField());
  assertTrue(errors.hasFieldErrors("age"));
  assertEquals(2,errors.getFieldErrorCount("age"));
  assertEquals("validation.TOO_YOUNG",errors.getFieldError("age").getCode());
  assertEquals("validation.TOO_YOUNG",(errors.getFieldErrors("age").get(0)).getCode());
  assertEquals("tb",(errors.getFieldErrors("age").get(0)).getObjectName());
  assertEquals("age",(errors.getFieldErrors("age").get(0)).getField());
  assertEquals(new Integer(0),(errors.getFieldErrors("age").get(0)).getRejectedValue());
  assertEquals("validation.AGE_NOT_ODD",(errors.getFieldErrors("age").get(1)).getCode());
  assertTrue(errors.hasFieldErrors("name"));
  assertEquals(1,errors.getFieldErrorCount("name"));
  assertEquals("validation.NOT_ROD",errors.getFieldError("name").getCode());
  assertEquals("validation.NOT_ROD.tb.name",errors.getFieldError("name").getCodes()[0]);
  assertEquals("validation.NOT_ROD.name",errors.getFieldError("name").getCodes()[1]);
  assertEquals("validation.NOT_ROD.java.lang.String",errors.getFieldError("name").getCodes()[2]);
  assertEquals("validation.NOT_ROD",errors.getFieldError("name").getCodes()[3]);
  assertEquals("name",(errors.getFieldErrors("name").get(0)).getField());
  assertEquals(null,(errors.getFieldErrors("name").get(0)).getRejectedValue());
  assertTrue(errors.hasFieldErrors("spouse.age"));
  assertEquals(1,errors.getFieldErrorCount("spouse.age"));
  assertEquals("validation.TOO_YOUNG",errors.getFieldError("spouse.age").getCode());
  assertEquals("tb",(errors.getFieldErrors("spouse.age").get(0)).getObjectName());
  assertEquals(new Integer(0),(errors.getFieldErrors("spouse.age").get(0)).getRejectedValue());
}
