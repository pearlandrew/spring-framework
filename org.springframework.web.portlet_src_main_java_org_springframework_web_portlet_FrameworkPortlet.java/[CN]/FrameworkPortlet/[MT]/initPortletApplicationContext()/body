{
  ApplicationContext parent=PortletApplicationContextUtils.getWebApplicationContext(getPortletContext());
  ApplicationContext pac=createPortletApplicationContext(parent);
  if (!this.refreshEventReceived) {
    onRefresh(pac);
  }
  if (isPublishContext()) {
    String attName=getPortletContextAttributeName();
    getPortletContext().setAttribute(attName,pac);
    if (logger.isDebugEnabled()) {
      logger.debug("Published ApplicationContext of portlet '" + getPortletName() + "' as PortletContext attribute with name ["+ attName+ "]");
    }
  }
  return pac;
}
