{
  if (formatted.length() == 0) {
    return null;
  }
  NumberFormat format=currencyFormatFactory.getNumberFormat(locale);
  ParsePosition position=new ParsePosition(0);
  BigDecimal decimal=(BigDecimal)format.parse(formatted,position);
  if (position.getErrorIndex() != -1) {
    throw new ParseException(formatted,position.getIndex());
  }
  if (!lenient) {
    if (formatted.length() != position.getIndex()) {
      throw new ParseException(formatted,position.getIndex());
    }
  }
  decimal=decimal.setScale(format.getMaximumFractionDigits(),format.getRoundingMode());
  return decimal;
}
