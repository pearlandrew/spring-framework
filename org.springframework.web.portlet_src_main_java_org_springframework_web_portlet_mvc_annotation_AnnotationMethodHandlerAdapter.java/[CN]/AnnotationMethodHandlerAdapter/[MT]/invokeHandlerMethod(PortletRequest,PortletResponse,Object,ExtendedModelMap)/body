{
  PortletWebRequest webRequest=new PortletWebRequest(request,response);
  PortletHandlerMethodResolver methodResolver=getMethodResolver(handler);
  Method handlerMethod=methodResolver.resolveHandlerMethod(request);
  PortletHandlerMethodInvoker methodInvoker=new PortletHandlerMethodInvoker(methodResolver);
  Object result=methodInvoker.invokeHandlerMethod(handlerMethod,handler,webRequest,implicitModel);
  ModelAndView mav=methodInvoker.getModelAndView(handlerMethod,handler.getClass(),result,implicitModel,webRequest);
  methodInvoker.updateModelAttributes(handler,(mav != null ? mav.getModel() : null),implicitModel,webRequest);
  if (response instanceof ActionResponse && !implicitModel.isEmpty()) {
    ActionResponse actionResponse=(ActionResponse)response;
    try {
      actionResponse.setRenderParameter(IMPLICIT_MODEL_ATTRIBUTE,Boolean.TRUE.toString());
      request.getPortletSession().setAttribute(IMPLICIT_MODEL_ATTRIBUTE,implicitModel);
    }
 catch (    IllegalStateException ex) {
    }
  }
  return mav;
}
