{
  Collection sourceCollection=(Collection)source;
  TypeDescriptor sourceElementType=sourceType.getElementTypeDescriptor();
  if (sourceElementType == TypeDescriptor.NULL) {
    sourceElementType=getElementType(sourceCollection);
  }
  TypeDescriptor targetElementType=targetType.getElementTypeDescriptor();
  if (sourceElementType == TypeDescriptor.NULL || sourceElementType.isAssignableTo(targetElementType)) {
    if (sourceType.isAssignableTo(targetType)) {
      return sourceCollection;
    }
 else {
      Collection target=CollectionFactory.createCollection(targetType.getType(),sourceCollection.size());
      target.addAll(sourceCollection);
      return target;
    }
  }
  Collection target=CollectionFactory.createCollection(targetType.getType(),sourceCollection.size());
  GenericConverter converter=this.conversionService.getConverter(sourceElementType,targetElementType);
  if (converter == null) {
    throw new ConverterNotFoundException(sourceElementType,targetElementType);
  }
  for (  Object element : sourceCollection) {
    target.add(invokeConverter(converter,element,sourceElementType,targetElementType));
  }
  return target;
}
