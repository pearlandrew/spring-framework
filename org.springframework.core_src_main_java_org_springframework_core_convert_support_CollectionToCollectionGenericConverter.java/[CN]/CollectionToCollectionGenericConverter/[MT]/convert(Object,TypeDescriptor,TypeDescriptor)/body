{
  Collection sourceCollection=(Collection)source;
  TypeDescriptor sourceElementType=sourceType.getElementTypeDescriptor();
  if (sourceElementType == TypeDescriptor.NULL) {
    sourceElementType=getElementType(sourceCollection);
  }
  TypeDescriptor targetElementType=targetType.getElementTypeDescriptor();
  if (sourceElementType == TypeDescriptor.NULL || sourceElementType.isAssignableTo(targetElementType)) {
    if (sourceType.isAssignableTo(targetType)) {
      return sourceCollection;
    }
 else {
      Collection targetCollection=CollectionFactory.createCollection(targetType.getType(),sourceCollection.size());
      targetCollection.addAll(sourceCollection);
      return targetCollection;
    }
  }
  Collection targetCollection=CollectionFactory.createCollection(targetType.getType(),sourceCollection.size());
  GenericConverter converter=conversionService.getConverter(sourceElementType,targetElementType);
  if (converter == null) {
    throw new ConverterNotFoundException(sourceType,targetType);
  }
  for (  Object element : sourceCollection) {
    targetCollection.add(converter.convert(element,sourceElementType,targetElementType));
  }
  return targetCollection;
}
