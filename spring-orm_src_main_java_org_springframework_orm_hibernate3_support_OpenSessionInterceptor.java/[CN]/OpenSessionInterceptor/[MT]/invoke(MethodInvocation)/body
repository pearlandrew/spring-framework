{
  SessionFactory sf=getSessionFactory();
  if (!TransactionSynchronizationManager.hasResource(sf)) {
    Session session=openSession();
    try {
      TransactionSynchronizationManager.bindResource(sf,new org.springframework.orm.hibernate3.SessionHolder(session));
      return invocation.proceed();
    }
  finally {
      org.springframework.orm.hibernate3.SessionFactoryUtils.closeSession(session);
      TransactionSynchronizationManager.unbindResource(sf);
    }
  }
 else {
    return invocation.proceed();
  }
}
