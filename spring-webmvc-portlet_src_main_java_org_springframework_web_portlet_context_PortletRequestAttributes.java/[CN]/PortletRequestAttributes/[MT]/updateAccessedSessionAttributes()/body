{
  this.session=this.request.getPortletSession(false);
  if (this.session != null) {
    try {
      for (      Map.Entry<String,Object> entry : this.sessionAttributesToUpdate.entrySet()) {
        String name=entry.getKey();
        Object newValue=entry.getValue();
        Object oldValue=this.session.getAttribute(name);
        if (oldValue == newValue) {
          this.session.setAttribute(name,newValue);
        }
      }
      for (      Map.Entry<String,Object> entry : this.globalSessionAttributesToUpdate.entrySet()) {
        String name=entry.getKey();
        Object newValue=entry.getValue();
        Object oldValue=this.session.getAttribute(name,PortletSession.APPLICATION_SCOPE);
        if (oldValue == newValue) {
          this.session.setAttribute(name,newValue,PortletSession.APPLICATION_SCOPE);
        }
      }
    }
 catch (    IllegalStateException ex) {
    }
  }
  this.sessionAttributesToUpdate.clear();
  this.globalSessionAttributesToUpdate.clear();
}
