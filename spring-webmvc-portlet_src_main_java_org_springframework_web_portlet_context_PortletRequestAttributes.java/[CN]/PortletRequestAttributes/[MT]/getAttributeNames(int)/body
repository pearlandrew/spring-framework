{
  if (scope == SCOPE_REQUEST) {
    if (!isRequestActive()) {
      throw new IllegalStateException("Cannot ask for request attributes - request is not active anymore!");
    }
    return StringUtils.toStringArray(this.request.getAttributeNames());
  }
 else {
    PortletSession session=getSession(false);
    if (session != null) {
      if (scope == SCOPE_GLOBAL_SESSION) {
        return StringUtils.toStringArray(session.getAttributeNames(PortletSession.APPLICATION_SCOPE));
      }
 else {
        return StringUtils.toStringArray(session.getAttributeNames());
      }
    }
    return new String[0];
  }
}
