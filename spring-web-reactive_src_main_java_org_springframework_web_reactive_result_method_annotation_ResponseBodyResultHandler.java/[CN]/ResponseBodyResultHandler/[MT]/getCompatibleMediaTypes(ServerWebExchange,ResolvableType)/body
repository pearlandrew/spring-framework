{
  List<MediaType> acceptableMediaTypes=getAcceptableMediaTypes(exchange);
  List<MediaType> producibleMediaTypes=getProducibleMediaTypes(elementType);
  Set<MediaType> compatibleMediaTypes=new LinkedHashSet<>();
  for (  MediaType acceptable : acceptableMediaTypes) {
    for (    MediaType producible : producibleMediaTypes) {
      if (acceptable.isCompatibleWith(producible)) {
        compatibleMediaTypes.add(getMostSpecificMediaType(acceptable,producible));
      }
    }
  }
  List<MediaType> result=new ArrayList<>(compatibleMediaTypes);
  MediaType.sortBySpecificityAndQuality(result);
  return result;
}
