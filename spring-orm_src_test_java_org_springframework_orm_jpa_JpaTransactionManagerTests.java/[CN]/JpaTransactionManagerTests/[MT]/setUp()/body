{
  factory=mock(EntityManagerFactory.class);
  manager=mock(EntityManager.class);
  tx=mock(EntityTransaction.class);
  transactionManager=new JpaTransactionManager(factory);
  template=new JpaTemplate(factory);
  template.afterPropertiesSet();
  tt=new TransactionTemplate(transactionManager);
  given(factory.createEntityManager()).willReturn(manager);
  given(manager.getTransaction()).willReturn(tx);
  given(manager.isOpen()).willReturn(true);
}
