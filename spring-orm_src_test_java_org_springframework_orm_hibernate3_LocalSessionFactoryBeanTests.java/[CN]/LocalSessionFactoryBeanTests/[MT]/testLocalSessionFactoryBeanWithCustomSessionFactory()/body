{
  final SessionFactory sessionFactory=mock(SessionFactory.class);
  LocalSessionFactoryBean sfb=new LocalSessionFactoryBean(){
    @Override protected SessionFactory newSessionFactory(    Configuration config){
      return sessionFactory;
    }
  }
;
  sfb.setMappingResources(new String[0]);
  sfb.setDataSource(new DriverManagerDataSource());
  sfb.setExposeTransactionAwareSessionFactory(false);
  sfb.afterPropertiesSet();
  assertTrue(sessionFactory == sfb.getObject());
  sfb.destroy();
  verify(sessionFactory).close();
}
