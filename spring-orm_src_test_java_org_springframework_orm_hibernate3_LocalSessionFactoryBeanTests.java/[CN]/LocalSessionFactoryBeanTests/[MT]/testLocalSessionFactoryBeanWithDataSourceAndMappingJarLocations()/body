{
  final DriverManagerDataSource ds=new DriverManagerDataSource();
  final Set invocations=new HashSet();
  LocalSessionFactoryBean sfb=new LocalSessionFactoryBean(){
    @Override protected Configuration newConfiguration(){
      return new Configuration(){
        @Override public Configuration addJar(        File file){
          invocations.add("addResource " + file.getPath());
          return this;
        }
      }
;
    }
    @Override protected SessionFactory newSessionFactory(    Configuration config){
      assertEquals(LocalDataSourceConnectionProvider.class.getName(),config.getProperty(Environment.CONNECTION_PROVIDER));
      assertEquals(ds,LocalSessionFactoryBean.getConfigTimeDataSource());
      invocations.add("newSessionFactory");
      return null;
    }
  }
;
  sfb.setMappingJarLocations(new Resource[]{new FileSystemResource("mapping.hbm.jar"),new FileSystemResource("mapping2.hbm.jar")});
  sfb.setDataSource(ds);
  sfb.afterPropertiesSet();
  assertTrue(sfb.getConfiguration() != null);
  assertTrue(invocations.contains("addResource mapping.hbm.jar"));
  assertTrue(invocations.contains("addResource mapping2.hbm.jar"));
  assertTrue(invocations.contains("newSessionFactory"));
}
