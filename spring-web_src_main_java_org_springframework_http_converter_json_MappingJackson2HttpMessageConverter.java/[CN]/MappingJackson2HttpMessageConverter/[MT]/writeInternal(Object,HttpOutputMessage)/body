{
  JsonEncoding encoding=getJsonEncoding(outputMessage.getHeaders().getContentType());
  JsonGenerator generator=this.objectMapper.getFactory().createGenerator(outputMessage.getBody(),encoding);
  try {
    if (this.jsonPrefix != null) {
      generator.writeRaw(this.jsonPrefix);
    }
    Class<?> serializationView=null;
    String jsonpFunction=null;
    if (object instanceof MappingJacksonValue) {
      MappingJacksonValue container=(MappingJacksonValue)object;
      object=container.getValue();
      serializationView=container.getSerializationView();
      jsonpFunction=container.getJsonpFunction();
    }
    if (jsonpFunction != null) {
      generator.writeRaw(jsonpFunction + "(");
    }
    if (serializationView != null) {
      this.objectMapper.writerWithView(serializationView).writeValue(generator,object);
    }
 else {
      this.objectMapper.writeValue(generator,object);
    }
    if (jsonpFunction != null) {
      generator.writeRaw(");");
      generator.flush();
    }
  }
 catch (  JsonProcessingException ex) {
    throw new HttpMessageNotWritableException("Could not write JSON: " + ex.getMessage(),ex);
  }
}
