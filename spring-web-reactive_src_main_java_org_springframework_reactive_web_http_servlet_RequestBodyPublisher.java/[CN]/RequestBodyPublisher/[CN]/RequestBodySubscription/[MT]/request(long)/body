{
  logger.debug("Updating demand " + demand + " by "+ n);
  boolean stalled=!demand.hasDemand();
  demand.increase(n);
  if (stalled) {
    try {
      onDataAvailable();
    }
 catch (    IOException ex) {
      onError(ex);
    }
  }
}
