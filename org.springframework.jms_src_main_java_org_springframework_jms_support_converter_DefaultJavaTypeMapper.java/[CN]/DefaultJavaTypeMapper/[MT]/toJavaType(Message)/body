{
  JavaType classType=getClassIdType(retrieveHeader(message,CLASSID_PROPERTY_NAME));
  if (!classType.isContainerType()) {
    return classType;
  }
  JavaType contentClassType=getClassIdType(retrieveHeader(message,CONTENT_CLASSID_PROPERTY_NAME));
  if (classType.getKeyType() == null) {
    return collectionType((Class<? extends Collection>)classType.getRawClass(),contentClassType);
  }
  JavaType keyClassType=getClassIdType(retrieveHeader(message,KEY_CLASSID_PROPERTY_NAME));
  JavaType mapType=mapType((Class<? extends Map>)classType.getRawClass(),keyClassType,contentClassType);
  return mapType;
}
