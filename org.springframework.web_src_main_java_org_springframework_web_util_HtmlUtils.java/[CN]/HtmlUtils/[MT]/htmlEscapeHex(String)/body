{
  if (input == null) {
    return null;
  }
  StringBuffer escaped=new StringBuffer(input.length() * 2);
  for (int i=0; i < input.length(); i++) {
    char character=input.charAt(i);
    if (characterEntityReferences.isMappedToReference(character)) {
      escaped.append(HtmlCharacterEntityReferences.HEX_REFERENCE_START);
      escaped.append(Integer.toString((int)character,16));
      escaped.append(HtmlCharacterEntityReferences.REFERENCE_END);
    }
 else {
      escaped.append(character);
    }
  }
  return escaped.toString();
}
