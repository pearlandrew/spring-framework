{
  if (logger.isDebugEnabled()) {
    logger.debug("Connection established, " + session + ", uri="+ session.getURI());
  }
  try {
    Assert.isTrue(this.sessionCount.compareAndSet(0,1),"Unexpected new session");
    this.handler=this.handlerProvider.getHandler();
    this.handler.afterConnectionEstablished(session);
  }
 catch (  Throwable ex) {
    tryCloseWithError(session,ex);
  }
}
