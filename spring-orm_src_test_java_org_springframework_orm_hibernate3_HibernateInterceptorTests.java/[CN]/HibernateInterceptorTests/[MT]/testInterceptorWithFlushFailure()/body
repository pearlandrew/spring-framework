{
  SQLException sqlEx=new SQLException("argh","27");
  ConstraintViolationException jdbcEx=new ConstraintViolationException("",sqlEx,null);
  willThrow(jdbcEx).given(session).flush();
  HibernateInterceptor interceptor=new HibernateInterceptor();
  interceptor.setSessionFactory(sessionFactory);
  try {
    interceptor.invoke(invocation);
    fail("Should have thrown DataIntegrityViolationException");
  }
 catch (  DataIntegrityViolationException ex) {
    assertEquals(jdbcEx,ex.getCause());
  }
  verify(session).close();
}
