{
  ClassPathXmlApplicationContext context=new ClassPathXmlApplicationContext("org/springframework/jdbc/config/jdbc-destroy-nested-config.xml");
  try {
    DataSource dataSource=context.getBean(DataSource.class);
    JdbcTemplate template=new JdbcTemplate(dataSource);
    assertEquals(1,template.queryForInt("select count(*) from T_TEST"));
    context.getBean(EmbeddedDatabaseFactoryBean.class).destroy();
    expected.expect(BadSqlGrammarException.class);
    assertEquals(1,template.queryForInt("select count(*) from T_TEST"));
  }
  finally {
    context.close();
  }
}
