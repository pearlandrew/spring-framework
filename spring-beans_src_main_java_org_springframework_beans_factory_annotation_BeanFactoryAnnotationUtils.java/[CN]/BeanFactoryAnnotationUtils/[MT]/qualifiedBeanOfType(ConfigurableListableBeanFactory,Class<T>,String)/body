{
  Map<String,T> candidateBeans=BeanFactoryUtils.beansOfTypeIncludingAncestors(bf,beanType);
  T matchingBean=null;
  for (  Map.Entry<String,T> entry : candidateBeans.entrySet()) {
    String beanName=entry.getKey();
    if (isQualifierMatch(qualifier,beanName,bf)) {
      if (matchingBean != null) {
        throw new NoSuchBeanDefinitionException(qualifier,"No unique " + beanType.getSimpleName() + " bean found for qualifier '"+ qualifier+ "'");
      }
      matchingBean=entry.getValue();
    }
  }
  if (matchingBean != null) {
    return matchingBean;
  }
 else   if (bf.containsBean(qualifier)) {
    return bf.getBean(qualifier,beanType);
  }
 else {
    throw new NoSuchBeanDefinitionException(qualifier,"No matching " + beanType.getSimpleName() + " bean found for qualifier '"+ qualifier+ "' - neither qualifier match nor bean name match!");
  }
}
