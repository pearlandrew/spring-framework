{
  Map<String,T> candidateBeans=BeanFactoryUtils.beansOfTypeIncludingAncestors(bf,beanType);
  T matchingBean=null;
  for (  String beanName : candidateBeans.keySet()) {
    if (isQualifierMatch(qualifier,beanName,bf)) {
      if (matchingBean != null) {
        throw new NoSuchBeanDefinitionException(qualifier,"No unique " + beanType.getSimpleName() + " bean found for qualifier '"+ qualifier+ "'");
      }
      matchingBean=candidateBeans.get(beanName);
    }
  }
  if (matchingBean != null) {
    return matchingBean;
  }
 else   if (bf.containsBean(qualifier)) {
    return bf.getBean(qualifier,beanType);
  }
 else {
    throw new NoSuchBeanDefinitionException(qualifier,"No matching " + beanType.getSimpleName() + " bean found for qualifier '"+ qualifier+ "' - neither qualifier match nor bean name match!");
  }
}
