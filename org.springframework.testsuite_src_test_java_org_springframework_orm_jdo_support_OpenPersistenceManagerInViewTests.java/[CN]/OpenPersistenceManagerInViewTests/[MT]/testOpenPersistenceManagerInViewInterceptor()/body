{
  MockControl pmfControl=MockControl.createControl(PersistenceManagerFactory.class);
  PersistenceManagerFactory pmf=(PersistenceManagerFactory)pmfControl.getMock();
  MockControl pmControl=MockControl.createControl(PersistenceManager.class);
  PersistenceManager pm=(PersistenceManager)pmControl.getMock();
  OpenPersistenceManagerInViewInterceptor rawInterceptor=new OpenPersistenceManagerInViewInterceptor();
  rawInterceptor.setPersistenceManagerFactory(pmf);
  HandlerInterceptor interceptor=new WebRequestHandlerInterceptorAdapter(rawInterceptor);
  MockServletContext sc=new MockServletContext();
  MockHttpServletRequest request=new MockHttpServletRequest(sc);
  MockHttpServletResponse response=new MockHttpServletResponse();
  pmf.getPersistenceManager();
  pmfControl.setReturnValue(pm,1);
  pmfControl.replay();
  pmControl.replay();
  interceptor.preHandle(request,response,"handler");
  assertTrue(TransactionSynchronizationManager.hasResource(pmf));
  interceptor.preHandle(request,response,"handler");
  interceptor.preHandle(request,response,"handler");
  interceptor.postHandle(request,response,"handler",null);
  interceptor.afterCompletion(request,response,"handler",null);
  interceptor.postHandle(request,response,"handler",null);
  interceptor.afterCompletion(request,response,"handler",null);
  interceptor.preHandle(request,response,"handler");
  interceptor.postHandle(request,response,"handler",null);
  interceptor.afterCompletion(request,response,"handler",null);
  pmfControl.verify();
  pmControl.verify();
  pmfControl.reset();
  pmControl.reset();
  pmfControl.replay();
  pmControl.replay();
  interceptor.postHandle(request,response,"handler",null);
  assertTrue(TransactionSynchronizationManager.hasResource(pmf));
  pmfControl.verify();
  pmControl.verify();
  pmfControl.reset();
  pmControl.reset();
  pm.close();
  pmControl.setVoidCallable(1);
  pmfControl.replay();
  pmControl.replay();
  interceptor.afterCompletion(request,response,"handler",null);
  assertFalse(TransactionSynchronizationManager.hasResource(pmf));
  pmfControl.verify();
  pmControl.verify();
}
