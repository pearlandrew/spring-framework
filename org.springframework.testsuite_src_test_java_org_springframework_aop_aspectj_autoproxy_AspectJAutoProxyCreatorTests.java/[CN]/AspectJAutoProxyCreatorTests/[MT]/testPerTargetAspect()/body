{
  ClassPathXmlApplicationContext bf=new ClassPathXmlApplicationContext("/org/springframework/aop/aspectj/autoproxy/pertarget.xml");
  ITestBean adrian1=(ITestBean)bf.getBean("adrian");
  assertTrue(AopUtils.isAopProxy(adrian1));
  int explicitlySetAge=25;
  adrian1.setAge(explicitlySetAge);
  assertEquals("Setter does not initiate advice",explicitlySetAge,adrian1.getAge());
  AspectMetadata am=new AspectMetadata(PerTargetAspect.class,"someBean");
  assertTrue(am.getPerClausePointcut().getMethodMatcher().matches(TestBean.class.getMethod("getSpouse"),null));
  adrian1.getSpouse();
  assertEquals("Advice has now been instantiated",0,adrian1.getAge());
  adrian1.setAge(11);
  assertEquals("Any int setter increments",2,adrian1.getAge());
  adrian1.setName("Adrian");
  ITestBean adrian2=(ITestBean)bf.getBean("adrian");
  assertNotSame(adrian1,adrian2);
  assertTrue(AopUtils.isAopProxy(adrian1));
  assertEquals(34,adrian2.getAge());
  adrian2.getSpouse();
  assertEquals("Aspect now fired",0,adrian2.getAge());
  assertEquals(1,adrian2.getAge());
  assertEquals(2,adrian2.getAge());
  assertEquals(3,adrian1.getAge());
}
