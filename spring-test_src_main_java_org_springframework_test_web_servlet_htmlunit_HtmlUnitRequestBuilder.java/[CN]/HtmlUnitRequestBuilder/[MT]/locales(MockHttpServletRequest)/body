{
  String locale=header("Accept-Language");
  if (locale == null) {
    request.addPreferredLocale(Locale.getDefault());
  }
 else {
    String[] locales=locale.split(", ");
    for (int i=locales.length - 1; i >= 0; i--) {
      request.addPreferredLocale(parseLocale(locales[i]));
    }
  }
}
