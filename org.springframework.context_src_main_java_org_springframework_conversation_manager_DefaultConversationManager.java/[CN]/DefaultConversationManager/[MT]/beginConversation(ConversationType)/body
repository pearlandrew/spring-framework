{
  ConversationRepository repository=getConversationRepository();
  ConversationResolver resolver=getConversationResolver();
  MutableConversation newConversation=null;
switch (conversationType) {
case NEW:
    endCurrentConversation(true);
  newConversation=repository.createNewConversation();
break;
case NESTED:
case ISOLATED:
MutableConversation parentConversation=getCurrentConversation(false);
if (parentConversation != null) {
newConversation=repository.createNewChildConversation(parentConversation,conversationType == ConversationType.ISOLATED);
}
 else {
newConversation=repository.createNewConversation();
}
break;
}
repository.storeConversation(newConversation);
resolver.setCurrentConversationId(newConversation.getId());
return newConversation;
}
