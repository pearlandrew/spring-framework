{
  K lookupKey=getLookupKey(request);
  Object handler=this.handlerMap.get(lookupKey);
  if (handler != null && logger.isDebugEnabled()) {
    logger.debug("Key [" + lookupKey + "] -> handler ["+ handler+ "]");
  }
  if (handler instanceof Map) {
    Map<PortletRequestMappingPredicate,Object> predicateMap=(Map<PortletRequestMappingPredicate,Object>)handler;
    List<PortletRequestMappingPredicate> predicates=new LinkedList<PortletRequestMappingPredicate>(predicateMap.keySet());
    Collections.sort(predicates);
    for (    PortletRequestMappingPredicate predicate : predicates) {
      if (predicate.match(request)) {
        return predicateMap.get(predicate);
      }
    }
    return null;
  }
  return handler;
}
