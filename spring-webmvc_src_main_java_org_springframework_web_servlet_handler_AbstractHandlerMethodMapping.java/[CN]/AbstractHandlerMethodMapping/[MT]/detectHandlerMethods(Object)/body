{
  Class<?> handlerType=(handler instanceof String ? getApplicationContext().getType((String)handler) : handler.getClass());
  final Map<Method,T> mappings=new IdentityHashMap<Method,T>();
  final Class<?> userType=ClassUtils.getUserClass(handlerType);
  Set<Method> methods=HandlerMethodSelector.selectMethods(userType,new MethodFilter(){
    @Override public boolean matches(    Method method){
      T mapping=getMappingForMethod(method,userType);
      if (mapping != null) {
        mappings.put(method,mapping);
        return true;
      }
 else {
        return false;
      }
    }
  }
);
  for (  Method method : methods) {
    registerHandlerMethod(handler,method,mappings.get(method));
  }
}
