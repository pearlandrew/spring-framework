{
  if (headers.getContentType() == null) {
    MediaType contentTypeToUse=contentType;
    if (contentType == null || contentType.isWildcardType() || contentType.isWildcardSubtype()) {
      contentTypeToUse=getDefaultContentType(t);
    }
 else     if (MediaType.APPLICATION_OCTET_STREAM.equals(contentType)) {
      MediaType mediaType=getDefaultContentType(t);
      contentTypeToUse=(mediaType != null ? mediaType : contentTypeToUse);
    }
    if (contentTypeToUse != null) {
      if (contentTypeToUse.getCharset() == null && this.defaultCharset != null) {
        contentTypeToUse=new MediaType(contentTypeToUse,this.defaultCharset);
      }
      headers.setContentType(contentTypeToUse);
    }
  }
  if (headers.getContentLength() < 0) {
    Long contentLength=getContentLength(t,headers.getContentType());
    if (contentLength != null) {
      headers.setContentLength(contentLength);
    }
  }
}
