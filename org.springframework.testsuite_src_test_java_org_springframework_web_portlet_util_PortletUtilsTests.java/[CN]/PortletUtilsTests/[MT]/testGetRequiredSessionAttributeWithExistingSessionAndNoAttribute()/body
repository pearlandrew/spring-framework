{
  MockControl mock=MockControl.createControl(PortletRequest.class);
  final PortletRequest request=(PortletRequest)mock.getMock();
  request.getPortletSession(false);
  MockPortletSession session=new MockPortletSession();
  mock.setReturnValue(session);
  mock.replay();
  new AssertThrows(IllegalStateException.class){
    public void test() throws Exception {
      PortletUtils.getRequiredSessionAttribute(request,"foo");
    }
  }
.runTest();
  mock.verify();
}
