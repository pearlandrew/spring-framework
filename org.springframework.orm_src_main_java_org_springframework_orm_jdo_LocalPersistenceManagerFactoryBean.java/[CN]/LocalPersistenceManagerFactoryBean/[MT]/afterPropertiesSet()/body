{
  if (this.persistenceManagerFactoryName != null) {
    if (this.configLocation != null || !this.jdoPropertyMap.isEmpty()) {
      throw new IllegalStateException("'configLocation'/'jdoProperties' not supported in " + "combination with 'persistenceManagerFactoryName' - specify one or the other, not both");
    }
    if (logger.isInfoEnabled()) {
      logger.info("Building new JDO PersistenceManagerFactory for name '" + this.persistenceManagerFactoryName + "'");
    }
    this.persistenceManagerFactory=newPersistenceManagerFactory(this.persistenceManagerFactoryName);
  }
 else {
    Map mergedProps=new HashMap();
    if (this.configLocation != null) {
      if (logger.isInfoEnabled()) {
        logger.info("Loading JDO config from [" + this.configLocation + "]");
      }
      mergedProps.putAll(PropertiesLoaderUtils.loadProperties(this.configLocation));
    }
    mergedProps.putAll(this.jdoPropertyMap);
    logger.info("Building new JDO PersistenceManagerFactory");
    this.persistenceManagerFactory=newPersistenceManagerFactory(mergedProps);
  }
  if (this.jdoDialect == null) {
    this.jdoDialect=new DefaultJdoDialect(this.persistenceManagerFactory.getConnectionFactory());
  }
}
