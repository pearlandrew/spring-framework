{
synchronized (this.cachedBundleMessageFormats) {
    Map<String,Map<Locale,MessageFormat>> codeMap=this.cachedBundleMessageFormats.get(bundle);
    Map<Locale,MessageFormat> localeMap=null;
    if (codeMap != null) {
      localeMap=codeMap.get(code);
      if (localeMap != null) {
        MessageFormat result=localeMap.get(locale);
        if (result != null) {
          return result;
        }
      }
    }
    String msg=getStringOrNull(bundle,code);
    if (msg != null) {
      if (codeMap == null) {
        codeMap=new HashMap<String,Map<Locale,MessageFormat>>();
        this.cachedBundleMessageFormats.put(bundle,codeMap);
      }
      if (localeMap == null) {
        localeMap=new HashMap<Locale,MessageFormat>();
        codeMap.put(code,localeMap);
      }
      MessageFormat result=createMessageFormat(msg,locale);
      localeMap.put(locale,result);
      return result;
    }
    return null;
  }
}
