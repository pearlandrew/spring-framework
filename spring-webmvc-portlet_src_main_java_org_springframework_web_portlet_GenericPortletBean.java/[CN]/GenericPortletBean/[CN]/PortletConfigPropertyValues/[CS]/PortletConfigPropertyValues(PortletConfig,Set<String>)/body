{
  Set<String> missingProps=(requiredProperties != null && !requiredProperties.isEmpty()) ? new HashSet<String>(requiredProperties) : null;
  Enumeration<String> en=config.getInitParameterNames();
  while (en.hasMoreElements()) {
    String property=en.nextElement();
    Object value=config.getInitParameter(property);
    addPropertyValue(new PropertyValue(property,value));
    if (missingProps != null) {
      missingProps.remove(property);
    }
  }
  if (missingProps != null && missingProps.size() > 0) {
    throw new PortletException("Initialization from PortletConfig for portlet '" + config.getPortletName() + "' failed; the following required properties were missing: "+ StringUtils.collectionToDelimitedString(missingProps,", "));
  }
}
