{
  Class targetClass=(invocation.getThis() != null ? invocation.getThis().getClass() : null);
  ConversationAttribute conversationAttribute=conversationAttributeSource.getConversationAttribute(invocation.getMethod(),targetClass);
  Object returnValue;
  try {
    if (conversationAttribute != null && conversationAttribute.shouldStartConversation()) {
      Conversation conversation=conversationManager.beginConversation(conversationAttribute.getConversationType());
      if (conversationAttribute.getTimeout() != ConversationAttribute.DEFAULT_TIMEOUT) {
        conversation.setTimeout(conversationAttribute.getTimeout());
      }
    }
    returnValue=invocation.proceed();
    if (conversationAttribute != null && conversationAttribute.shouldEndConversation()) {
      conversationManager.endCurrentConversation(conversationAttribute.shouldEndRoot());
    }
  }
 catch (  Throwable th) {
    if (conversationAttribute != null) {
      conversationManager.endCurrentConversation(conversationAttribute.shouldEndRoot());
    }
    throw th;
  }
  return returnValue;
}
