{
  try {
    StompCommand command=message.getCommand();
    if (StompCommand.CONNECT.equals(command) || StompCommand.STOMP.equals(command)) {
      registerConnectionClosedCallback(session);
      connect(session,message);
    }
 else     if (StompCommand.SUBSCRIBE.equals(command)) {
      subscribe(session,message);
    }
 else     if (StompCommand.UNSUBSCRIBE.equals(command)) {
      unsubscribe(session,message);
    }
 else     if (StompCommand.SEND.equals(command)) {
      send(session,message);
    }
 else     if (StompCommand.DISCONNECT.equals(command)) {
      disconnect(session,message);
    }
 else     if (StompCommand.ACK.equals(command) || StompCommand.NACK.equals(command)) {
      this.reactor.notify(command,Fn.event(message));
    }
 else     if (StompCommand.BEGIN.equals(command) || StompCommand.COMMIT.equals(command) || StompCommand.ABORT.equals(command)) {
      this.reactor.notify(command,Fn.event(message));
    }
 else {
      sendErrorMessage(session,"Invalid STOMP command " + command);
    }
  }
 catch (  Throwable t) {
    handleError(session,t);
  }
}
