{
  if (this.methodResolver.hasSessionAttributes() && this.sessionStatus.isComplete()) {
    for (    String attrName : this.methodResolver.getActualSessionAttributeNames()) {
      this.sessionAttributeStore.cleanupAttribute(webRequest,attrName);
    }
  }
  Map<String,Object> model=(mavModel != null ? mavModel : implicitModel);
  for (  String attrName : new HashSet<String>(model.keySet())) {
    Object attrValue=model.get(attrName);
    boolean isSessionAttr=this.methodResolver.isSessionAttribute(attrName,(attrValue != null ? attrValue.getClass() : null));
    if (isSessionAttr && !this.sessionStatus.isComplete()) {
      this.sessionAttributeStore.storeAttribute(webRequest,attrName,attrValue);
    }
    if (!attrName.startsWith(BindingResult.MODEL_KEY_PREFIX) && (isSessionAttr || isBindingCandidate(attrValue))) {
      String bindingResultKey=BindingResult.MODEL_KEY_PREFIX + attrName;
      if (mavModel != null && !model.containsKey(bindingResultKey)) {
        WebRequestDataBinder binder=new WebRequestDataBinder(attrValue,attrName);
        initBinder(handler,attrName,binder,webRequest);
        mavModel.put(bindingResultKey,binder.getBindingResult());
      }
    }
  }
}
