{
  WebSocketHandler handler=null;
  String protocol=session.getAcceptedProtocol();
  if (protocol != null) {
    handler=this.handlers.get(protocol.toLowerCase());
    Assert.state(handler != null,"No WebSocketHandler for sub-protocol '" + protocol + "', handlers="+ this.handlers);
  }
 else {
    handler=this.defaultHandler;
    Assert.state(handler != null,"No sub-protocol was requested and no default WebSocketHandler was configured");
  }
  return handler;
}
