{
  MockActionResponse response=new MockActionResponse(){
    @Override public void setRenderParameters(    Map<String,String[]> parameters){
      throw new IllegalStateException();
    }
  }
;
  response.setRenderParameter("William","Baskerville");
  response.setRenderParameter("Adso","Melk");
  PortletUtils.clearAllRenderParameters(response);
  assertEquals("The render parameters map must not be cleared if ActionResponse.sendRedirect() has been called (already).",2,response.getRenderParameterMap().size());
}
