{
  if (event.isStartDocument()) {
    StartDocument startDocument=(StartDocument)event;
    String xmlVersion=startDocument.getVersion();
    if (StringUtils.hasLength(xmlVersion)) {
      this.xmlVersion=xmlVersion;
    }
    if (startDocument.encodingSet()) {
      this.encoding=startDocument.getCharacterEncodingScheme();
    }
  }
  if (getContentHandler() != null) {
    final Location location=event.getLocation();
    getContentHandler().setDocumentLocator(new Locator2(){
      public int getColumnNumber(){
        return location != null ? location.getColumnNumber() : -1;
      }
      public int getLineNumber(){
        return location != null ? location.getLineNumber() : -1;
      }
      public String getPublicId(){
        return location != null ? location.getPublicId() : null;
      }
      public String getSystemId(){
        return location != null ? location.getSystemId() : null;
      }
      public String getXMLVersion(){
        return xmlVersion;
      }
      public String getEncoding(){
        return encoding;
      }
    }
);
    getContentHandler().startDocument();
  }
}
