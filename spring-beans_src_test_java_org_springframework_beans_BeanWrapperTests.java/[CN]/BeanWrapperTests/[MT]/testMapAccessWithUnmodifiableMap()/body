{
  IndexedTestBean bean=new IndexedTestBean();
  BeanWrapper bw=new BeanWrapperImpl(bean);
  bw.registerCustomEditor(TestBean.class,"map",new PropertyEditorSupport(){
    public void setAsText(    String text) throws IllegalArgumentException {
      if (!StringUtils.hasLength(text)) {
        throw new IllegalArgumentException();
      }
      setValue(new TestBean(text));
    }
  }
);
  Map<Integer,String> inputMap=new HashMap<Integer,String>();
  inputMap.put(new Integer(1),"rod");
  inputMap.put(new Integer(2),"rob");
  MutablePropertyValues pvs=new MutablePropertyValues();
  pvs.add("map",Collections.unmodifiableMap(inputMap));
  bw.setPropertyValues(pvs);
  assertEquals("rod",((TestBean)bean.getMap().get(new Integer(1))).getName());
  assertEquals("rob",((TestBean)bean.getMap().get(new Integer(2))).getName());
}
