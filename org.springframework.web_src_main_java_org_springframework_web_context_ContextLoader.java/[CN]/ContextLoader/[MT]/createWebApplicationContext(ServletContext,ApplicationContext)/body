{
  Class contextClass=determineContextClass(servletContext);
  if (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) {
    throw new ApplicationContextException("Custom context class [" + contextClass.getName() + "] is not of type ["+ ConfigurableWebApplicationContext.class.getName()+ "]");
  }
  ConfigurableWebApplicationContext wac=(ConfigurableWebApplicationContext)BeanUtils.instantiateClass(contextClass);
  wac.setParent(parent);
  wac.setServletContext(servletContext);
  wac.setConfigLocation(servletContext.getInitParameter(CONFIG_LOCATION_PARAM));
  customizeContext(servletContext,wac);
  wac.refresh();
  return wac;
}
