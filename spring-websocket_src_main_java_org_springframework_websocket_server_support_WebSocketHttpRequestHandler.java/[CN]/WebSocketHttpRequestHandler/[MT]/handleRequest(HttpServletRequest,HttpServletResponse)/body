{
  ServerHttpRequest httpRequest=new ServletServerHttpRequest(request);
  ServerHttpResponse httpResponse=new ServletServerHttpResponse(response);
  try {
    this.handshakeHandler.doHandshake(httpRequest,httpResponse,this.webSocketHandler);
  }
 catch (  Exception e) {
    throw new NestedServletException("HandshakeHandler failure",e);
  }
 finally {
    httpResponse.flush();
  }
}
