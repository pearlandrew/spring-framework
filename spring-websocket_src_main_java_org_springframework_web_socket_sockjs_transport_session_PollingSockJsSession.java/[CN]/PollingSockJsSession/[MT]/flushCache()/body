{
  cancelHeartbeat();
  BlockingQueue<String> messageCache=getMessageCache();
  String[] messages=messageCache.toArray(new String[messageCache.size()]);
  messageCache.clear();
  SockJsMessageCodec messageCodec=getSockJsServiceConfig().getMessageCodec();
  SockJsFrame frame=SockJsFrame.messageFrame(messageCodec,messages);
  writeFrame(frame);
}
