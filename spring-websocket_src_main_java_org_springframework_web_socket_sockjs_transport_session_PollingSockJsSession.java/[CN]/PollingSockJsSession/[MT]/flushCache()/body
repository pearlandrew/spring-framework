{
  cancelHeartbeat();
  String[] messages=getMessageCache().toArray(new String[getMessageCache().size()]);
  getMessageCache().clear();
  SockJsMessageCodec messageCodec=getSockJsServiceConfig().getMessageCodec();
  SockJsFrame frame=SockJsFrame.messageFrame(messageCodec,messages);
  writeFrame(frame);
}
