{
  if (initialRequest) {
    writeFrame(SockJsFrame.openFrame());
    resetRequest();
  }
 else   if (!getMessageCache().isEmpty()) {
    flushCache();
  }
 else {
    scheduleHeartbeat();
  }
}
