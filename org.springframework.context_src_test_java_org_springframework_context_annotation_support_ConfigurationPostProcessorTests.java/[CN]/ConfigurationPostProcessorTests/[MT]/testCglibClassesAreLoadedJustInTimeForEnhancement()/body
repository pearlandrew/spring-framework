{
  ClassLoader classLoader=ClassUtils.getDefaultClassLoader();
  Field classesField=ClassLoader.class.getDeclaredField("classes");
  classesField.setAccessible(true);
  @SuppressWarnings("unchecked") Vector<Class<?>> classes=(Vector<Class<?>>)classesField.get(classLoader);
  Vector<Class<?>> cglibClassesAlreadyLoaded=new Vector<Class<?>>();
  for (  Class<?> loadedClass : classes)   if (loadedClass.getName().startsWith("net.sf.cglib"))   cglibClassesAlreadyLoaded.add(loadedClass);
  for (  Class<?> cglibClass : cglibClassesAlreadyLoaded)   classes.remove(cglibClass);
  testFailFastIfCglibNotPresent();
  for (  Class<?> loadedClass : classes)   if (loadedClass.getName().startsWith("net.sf.cglib"))   fail("CGLIB class should not have been eagerly loaded: " + loadedClass.getName());
}
