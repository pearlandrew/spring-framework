{
  PreparingBean1.prepared=false;
  PreparingBean1.destroyed=false;
  PreparingBean2.prepared=false;
  PreparingBean2.destroyed=false;
  DependingBean.destroyCount=0;
  HoldingBean.destroyCount=0;
  XmlBeanFactory xbf=new XmlBeanFactory(new ClassPathResource(filename,getClass()));
  xbf.preInstantiateSingletons();
  xbf.destroySingletons();
  assertTrue(PreparingBean1.prepared);
  assertTrue(PreparingBean1.destroyed);
  assertTrue(PreparingBean2.prepared);
  assertTrue(PreparingBean2.destroyed);
  assertEquals(nrOfHoldingBeans,DependingBean.destroyCount);
  if (!xbf.getBeansOfType(HoldingBean.class,false,false).isEmpty()) {
    assertEquals(nrOfHoldingBeans,HoldingBean.destroyCount);
  }
}
