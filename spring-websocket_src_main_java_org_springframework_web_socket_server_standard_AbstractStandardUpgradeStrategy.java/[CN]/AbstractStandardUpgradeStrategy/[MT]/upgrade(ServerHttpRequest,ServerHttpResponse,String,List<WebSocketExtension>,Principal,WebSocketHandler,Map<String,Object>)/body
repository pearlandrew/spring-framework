{
  HttpHeaders headers=request.getHeaders();
  InetSocketAddress localAddr=request.getLocalAddress();
  InetSocketAddress remoteAddr=request.getRemoteAddress();
  StandardWebSocketSession session=new StandardWebSocketSession(headers,attrs,localAddr,remoteAddr,user);
  StandardWebSocketHandlerAdapter endpoint=new StandardWebSocketHandlerAdapter(wsHandler,session);
  List<Extension> extensions=new ArrayList<Extension>();
  for (  WebSocketExtension e : selectedExtensions) {
    extensions.add(new WebSocketToStandardExtensionAdapter(e));
  }
  upgradeInternal(request,response,selectedProtocol,extensions,endpoint);
}
