{
  if (logger.isDebugEnabled()) {
    logger.debug("Session closed: " + session + ", "+ closeReason);
  }
  try {
    WebSocketSession wsSession=this.sessions.remove(session.getId());
    if (wsSession != null) {
      int code=closeReason.getCloseCode().getCode();
      String reason=closeReason.getReasonPhrase();
      this.webSocketHandler.sessionClosed(wsSession,code,reason);
    }
 else {
      Assert.notNull(wsSession,"No WebSocket session");
    }
  }
 catch (  Throwable ex) {
    logger.error("Error while processing session closing",ex);
  }
}
