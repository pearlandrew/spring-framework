{
  if (logger.isDebugEnabled()) {
    logger.debug("Client disconnected, WebSocket session id=" + session.getId() + ", "+ reason);
  }
  try {
    WebSocketSession wsSession=this.sessions.remove(session.getId());
    if (wsSession != null) {
      CloseStatus closeStatus=new CloseStatus(reason.getCloseCode().getCode(),reason.getReasonPhrase());
      this.webSocketHandler.afterConnectionClosed(closeStatus,wsSession);
    }
 else {
      Assert.notNull(wsSession,"No WebSocket session");
    }
  }
 catch (  Throwable ex) {
    logger.error("Error while processing session closing",ex);
  }
}
