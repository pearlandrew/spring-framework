{
  for (int i=0; i < callbacks.length; i++) {
    if (!(callbacks[i] instanceof ConditionalCallback) || ((ConditionalCallback)callbacks[i]).isMatch(method)) {
      return i;
    }
  }
  throw new IllegalStateException("No callback available for method " + method.getName());
}
