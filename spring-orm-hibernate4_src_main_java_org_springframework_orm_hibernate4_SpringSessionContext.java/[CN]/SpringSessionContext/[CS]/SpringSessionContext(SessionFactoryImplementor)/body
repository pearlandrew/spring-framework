{
  this.sessionFactory=sessionFactory;
  try {
    Object jtaPlatform=sessionFactory.getServiceRegistry().getService(ConfigurableJtaPlatform.jtaPlatformClass);
    Method rtmMethod=ConfigurableJtaPlatform.jtaPlatformClass.getMethod("retrieveTransactionManager");
    this.transactionManager=(TransactionManager)ReflectionUtils.invokeMethod(rtmMethod,jtaPlatform);
    if (this.transactionManager != null) {
      this.jtaSessionContext=new SpringJtaSessionContext(sessionFactory);
    }
  }
 catch (  Exception ex) {
    LogFactory.getLog(SpringSessionContext.class).warn("Could not introspect Hibernate JtaPlatform for SpringJtaSessionContext",ex);
  }
}
