{
  if (this.locations != null) {
    for (    Resource location : this.locations) {
      if (logger.isInfoEnabled()) {
        logger.info("Loading properties file from " + location);
      }
      InputStream is=null;
      try {
        is=location.getInputStream();
        String filename=(location instanceof AbstractFileResolvingResource) ? location.getFilename() : null;
        if (filename != null && filename.endsWith(XML_FILE_EXTENSION)) {
          this.propertiesPersister.loadFromXml(props,is);
        }
 else {
          if (this.fileEncoding != null) {
            this.propertiesPersister.load(props,new InputStreamReader(is,this.fileEncoding));
          }
 else {
            this.propertiesPersister.load(props,is);
          }
        }
      }
 catch (      IOException ex) {
        if (this.ignoreResourceNotFound) {
          if (logger.isWarnEnabled()) {
            logger.warn("Could not load properties from " + location + ": "+ ex.getMessage());
          }
        }
 else {
          throw ex;
        }
      }
 finally {
        if (is != null) {
          is.close();
        }
      }
    }
  }
}
