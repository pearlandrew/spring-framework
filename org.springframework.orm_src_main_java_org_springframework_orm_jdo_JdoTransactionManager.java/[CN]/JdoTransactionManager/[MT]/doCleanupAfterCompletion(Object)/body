{
  JdoTransactionObject txObject=(JdoTransactionObject)transaction;
  if (txObject.isNewPersistenceManagerHolder()) {
    TransactionSynchronizationManager.unbindResource(getPersistenceManagerFactory());
  }
  txObject.getPersistenceManagerHolder().clear();
  if (txObject.hasConnectionHolder()) {
    TransactionSynchronizationManager.unbindResource(getDataSource());
    try {
      getJdoDialect().releaseJdbcConnection(txObject.getConnectionHolder().getConnectionHandle(),txObject.getPersistenceManagerHolder().getPersistenceManager());
    }
 catch (    Throwable ex) {
      logger.debug("Could not release JDBC connection after transaction",ex);
    }
  }
  getJdoDialect().cleanupTransaction(txObject.getTransactionData());
  if (txObject.isNewPersistenceManagerHolder()) {
    PersistenceManager pm=txObject.getPersistenceManagerHolder().getPersistenceManager();
    if (logger.isDebugEnabled()) {
      logger.debug("Closing JDO PersistenceManager [" + pm + "] after transaction");
    }
    PersistenceManagerFactoryUtils.releasePersistenceManager(pm,getPersistenceManagerFactory());
  }
 else {
    logger.debug("Not closing pre-bound JDO PersistenceManager after transaction");
  }
}
