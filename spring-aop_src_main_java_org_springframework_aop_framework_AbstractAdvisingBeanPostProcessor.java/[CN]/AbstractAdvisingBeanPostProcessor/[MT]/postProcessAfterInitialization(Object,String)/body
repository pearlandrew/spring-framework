{
  if (bean instanceof AopInfrastructureBean) {
    return bean;
  }
  if (isEligible(bean,beanName)) {
    if (bean instanceof Advised) {
      Advised advised=(Advised)bean;
      if (this.beforeExistingAdvisors) {
        advised.addAdvisor(0,this.advisor);
      }
 else {
        advised.addAdvisor(this.advisor);
      }
      return bean;
    }
 else {
      ProxyFactory proxyFactory=new ProxyFactory(bean);
      proxyFactory.copyFrom(this);
      proxyFactory.addAdvisor(this.advisor);
      return proxyFactory.getProxy(this.beanClassLoader);
    }
  }
 else {
    return bean;
  }
}
