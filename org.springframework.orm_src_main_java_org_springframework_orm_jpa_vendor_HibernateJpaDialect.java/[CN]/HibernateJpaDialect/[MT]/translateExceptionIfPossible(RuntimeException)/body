{
  if (ex instanceof HibernateException) {
    return SessionFactoryUtils.convertHibernateAccessException((HibernateException)ex);
  }
  if (ex instanceof PersistenceException && ex.getCause() instanceof HibernateException) {
    return SessionFactoryUtils.convertHibernateAccessException((HibernateException)ex.getCause());
  }
  return EntityManagerFactoryUtils.convertJpaAccessExceptionIfPossible(ex);
}
