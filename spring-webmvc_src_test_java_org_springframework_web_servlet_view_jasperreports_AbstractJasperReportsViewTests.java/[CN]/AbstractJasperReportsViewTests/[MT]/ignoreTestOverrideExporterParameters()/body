{
  AbstractJasperReportsView view=getView(COMPILED_REPORT);
  if (!(view instanceof AbstractJasperReportsSingleFormatView) || !((AbstractJasperReportsSingleFormatView)view).useWriter()) {
    return;
  }
  String characterEncoding="UTF-8";
  String overiddenCharacterEncoding="ASCII";
  Map<Object,Object> parameters=new HashMap<Object,Object>();
  parameters.put(JRExporterParameter.CHARACTER_ENCODING,characterEncoding);
  view.setExporterParameters(parameters);
  view.convertExporterParameters();
  Map<String,Object> model=getModel();
  model.put(JRExporterParameter.CHARACTER_ENCODING.toString(),overiddenCharacterEncoding);
  view.render(model,this.request,this.response);
  assertEquals(overiddenCharacterEncoding,this.response.getCharacterEncoding());
}
