{
  ConstructorArgumentValues cavs=new ConstructorArgumentValues();
  cavs.addIndexedArgumentValue(0,inChannel);
  cavs.addIndexedArgumentValue(1,outChannel);
  cavs.addIndexedArgumentValue(2,messagingTemplate);
  MutablePropertyValues values=new MutablePropertyValues();
  String prefixAttribute=messageBrokerElement.getAttribute("application-destination-prefix");
  values.add("destinationPrefixes",Arrays.asList(StringUtils.tokenizeToStringArray(prefixAttribute,",")));
  values.add("messageConverter",converter);
  RootBeanDefinition beanDef=new RootBeanDefinition(SimpAnnotationMethodMessageHandler.class,cavs,values);
  if (messageBrokerElement.hasAttribute("path-matcher")) {
    String pathMatcherRef=messageBrokerElement.getAttribute("path-matcher");
    beanDef.getPropertyValues().add("pathMatcher",new RuntimeBeanReference(pathMatcherRef));
  }
  registerBeanDef(beanDef,context,source);
}
