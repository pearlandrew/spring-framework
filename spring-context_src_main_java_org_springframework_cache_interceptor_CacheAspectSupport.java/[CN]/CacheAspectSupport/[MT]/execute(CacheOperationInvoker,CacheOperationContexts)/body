{
  processCacheEvicts(contexts.get(CacheEvictOperation.class),true,ExpressionEvaluator.NO_RESULT);
  Cache.ValueWrapper cacheHit=findCachedItem(contexts.get(CacheableOperation.class));
  List<CachePutRequest> cachePutRequests=new LinkedList<CachePutRequest>();
  if (cacheHit == null) {
    collectPutRequests(contexts.get(CacheableOperation.class),ExpressionEvaluator.NO_RESULT,cachePutRequests);
  }
  Cache.ValueWrapper result=null;
  if (cachePutRequests.isEmpty() && contexts.get(CachePutOperation.class).isEmpty()) {
    result=cacheHit;
  }
  if (result == null) {
    result=new SimpleValueWrapper(invoker.invoke());
  }
  collectPutRequests(contexts.get(CachePutOperation.class),result.get(),cachePutRequests);
  for (  CachePutRequest cachePutRequest : cachePutRequests) {
    cachePutRequest.apply(result.get());
  }
  processCacheEvicts(contexts.get(CacheEvictOperation.class),false,result.get());
  return result.get();
}
