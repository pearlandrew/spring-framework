{
  Properties props=new Properties();
  props.put("foo","bar");
  EntityManager em=mock(EntityManager.class);
  given(mockEmf.createEntityManager(props)).willReturn(em);
  given(em.getDelegate()).willReturn(new Object());
  given(em.isOpen()).willReturn(true);
  PersistenceAnnotationBeanPostProcessor babpp=new MockPersistenceAnnotationBeanPostProcessor();
  DefaultPrivatePersistenceContextFieldWithProperties transactionalField=new DefaultPrivatePersistenceContextFieldWithProperties();
  babpp.postProcessPropertyValues(null,null,transactionalField,null);
  assertNotNull(transactionalField.em);
  assertNotNull(transactionalField.em.getDelegate());
  verify(em).close();
}
