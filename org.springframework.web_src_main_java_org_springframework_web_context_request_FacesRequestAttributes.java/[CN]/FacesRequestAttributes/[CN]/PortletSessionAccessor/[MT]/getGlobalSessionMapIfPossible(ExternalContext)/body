{
  Object session=externalContext.getSession(true);
  if (session instanceof PortletSession) {
    return ((PortletSession)session).getAttributeMap(PortletSession.APPLICATION_SCOPE);
  }
 else {
    return externalContext.getSessionMap();
  }
}
